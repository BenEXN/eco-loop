<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Looop v1.6.0 ‚Äì Automatisation (ouvriers)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    /* ... (identique au code pr√©c√©dent pour tout le CSS, inclus responsive) ... */
    /* [Copie/colle tout le CSS de la version pr√©c√©dente ici, inchang√©] */
    body { background: #f3f3f3; font-family: sans-serif; margin:0; padding:0; }
    h1 { text-align: center; margin: 25px 0 10px; }
    .container {
      display: flex;
      justify-content: center;
      align-items: flex-start;
      margin: 0 auto 30px auto;
      max-width: 950px;
      gap: 24px;
    }
    .category {
      background: #fff;
      border-radius: 18px;
      box-shadow: 0 4px 24px #0001;
      flex: 1;
      padding: 32px 18px 18px 18px;
      margin: 0 6px;
      min-width: 250px;
      max-width: 320px;
      min-height: 250px;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    .cat-title {
      font-size: 1.25em;
      margin-bottom: 20px;
      font-weight: bold;
      letter-spacing: 1px;
    }
    .stock, .eco-msg, .exo-msg, .env-msg {
      font-size: 1.1em;
      margin-bottom: 10px;
    }
    .products-box {
      background: #f7f7fa;
      border: 2px solid #dde1eb;
      border-radius: 10px;
      color: #333;
      margin-bottom: 10px;
      padding: 10px 28px;
      font-size: 1.2em;
      font-weight: bold;
      letter-spacing: 1px;
      box-shadow: 0 1px 4px #ddd5;
      min-width: 110px;
      text-align: center;
    }
    .message-box {
      border-radius: 10px;
      margin: 8px 0 14px 0;
      padding: 11px 14px 11px 14px;
      font-weight: bold;
      font-size: 1.08em;
      box-shadow: 0 1px 4px #0002;
      text-align: center;
      min-width: 130px;
      max-width: 260px;
      word-break: break-word;
      line-height: 1.25em;
    }
    .msg-orange { background: #ffe9cf; color: #d2691e; border: 2px solid #f5c387; }
    .msg-blue { background: #e7f4ff; color: #0978c6; border: 2px solid #7cc8fa;}
    .msg-red { background: #ffe3e3; color: #c00; border: 2px solid #e48888;}
    .msg-brown { background: #fff4d6; color: #be8c00; border: 2px solid #e2c071;}
    .btn-row { margin: 18px 0 0 0; }
    button {
      font-size: 1em;
      padding: 10px 18px;
      margin: 5px 0;
      border-radius: 8px;
      border: none;
      background: #ececec;
      cursor: pointer;
      transition: background 0.2s;
    }
    button:disabled { opacity: 0.4; background: #f8f8f8; cursor: not-allowed; }
    .btn-primary { background: #2976d9; color: #fff; font-weight: bold;}
    .btn-yellow { background: #FFD600; color: #222; font-weight: bold;}
    .btn-green  { background: #4fd860; color: #fff; font-weight: bold;}
    .btn-annuler { background: #aaa; color: #fff; }
    .debug-row { margin: 0 0 32px 0; display: flex; justify-content: center; gap: 10px;}
    .message { font-weight: bold; min-height: 24px; margin: 10px 0;}
    #clics-container {
      text-align: center;
      margin: 25px 0 0 0;
      font-size: 1.2em;
      font-weight: bold;
      color: #333;
    }
    #revolution { color: #b10000; font-size: 1.1em; text-transform: uppercase; }
    #tech-level { font-size:1em; color:#2980b9; }
    #triche-sep { border: none; border-top: 3px solid #222; margin: 38px auto 12px auto; width: 94vw; max-width: 1000px;}
    #triche-label {
      text-align: left;
      font-size:1.13em;
      font-weight:normal;
      letter-spacing:1px;
      margin: 0 0 12px 0;
      color:#111;
      width: 95vw;
      max-width: 1000px;
      margin-left: auto;
      margin-right: auto;
    }
    #don-btn {
      margin-top: 10px;
      background: #FFD600;
      color: #222;
      font-weight: bold;
      border: none;
      border-radius: 8px;
      font-size: 1.1em;
      padding: 14px 20px;
      box-shadow: 0 1px 8px #fffdbe99;
    }
    .ouvrier-info {
      margin-bottom: 8px;
      color: #2980b9;
      font-size: 1.1em;
      font-weight: bold;
    }
    /* --- Responsive for mobile --- */
    @media (max-width: 700px) {
      .container {
        flex-direction: column;
        align-items: stretch;
        gap: 12px;
      }
      .category {
        max-width: none;
        min-width: 0;
        margin: 0 0 20px 0;
        padding: 18px 10px 12px 10px;
      }
      .products-box, .message-box {
        min-width: 0;
        font-size: 1.04em;
        padding: 8px 4px;
      }
      #clics-container {
        font-size: 1.05em;
      }
      button {
        width: 96%;
        max-width: 340px;
        font-size: 1em;
        margin-left: auto;
        margin-right: auto;
      }
      .debug-row {
        flex-direction: column;
        gap: 6px;
      }
      #triche-label {
        font-size:1em;
        margin-left: 4vw;
      }
      h1 {
        font-size: 1.16em;
      }
    }
  </style>
</head>
<body>
  <h1>üåç Looop <span style="font-size:0.7em;color:#777;">v1.6.0</span></h1>
  <div class="container">
    <!-- Colonne Environnement -->
    <div class="category">
      <div class="cat-title">üå± Environnement</div>
      <div class="stock">Ressources : <span id="nature">300</span></div>
      <div id="alert-crise" class="message-box msg-orange" style="display:none;"></div>
      <div class="btn-row">
        <button id="produce-btn" onclick="produce()">üõ†Ô∏è Produire</button>
      </div>
    </div>
    <!-- Colonne Exosomatisation -->
    <div class="category">
      <div class="cat-title">ü§ñ Exosomatisation</div>
      <div class="stock">Confort : <span id="confort">0</span></div>
      <div class="products-box">
        Produits cr√©√©s<br>
        <span id="production">0</span>
      </div>
      <div class="stock" id="tech-level"></div>
      <div id="ouvrier-info" class="ouvrier-info" style="display:none;"></div>
      <div id="social-crise" class="message-box msg-brown" style="display:none;"></div>
      <div class="btn-row">
        <button id="sell-btn" onclick="sell()">üí∂ Vente</button>
      </div>
    </div>
    <!-- Colonne √âconomie -->
    <div class="category">
      <div class="cat-title">üí∂ √âconomie</div>
      <div class="stock" id="money-row" style="display:none;">
        Monnaie (‚Ç¨) : <span id="money">10</span>
      </div>
      <button id="don-btn" onclick="receiveDon()">Recevoir mon don</button>
      <div id="eh-msg" class="message-box msg-blue" style="display:none;"></div>
      <div class="btn-row">
        <button id="upgrade-btn1" onclick="upgradeProd1()" style="display:none;">‚≠ê Am√©liorer la production (cr√©dit 1500)</button>
        <button id="upgrade-btn2" onclick="upgradeProd2()" style="display:none;">üí† Am√©liorer la production (2‚ÄØ000‚ÄØ‚Ç¨)</button>
        <button id="ouvrier-btn" onclick="acheterOuvrier()" style="display:none;">üë∑‚Äç‚ôÇÔ∏è Engager un ouvrier (500‚ÄØ‚Ç¨)</button>
        <button id="evolution-btn" onclick="evolution()" style="display:none;">üå± √âvolution √©conomique</button>
      </div>
    </div>
  </div>

  <!-- Messages globaux et r√©volution -->
  <div id="revolution" class="message-box msg-red" style="display:none;"></div>
  <div class="message" id="message"></div>

  <!-- Compteur centr√© -->
  <div id="clics-container">Clics/actions : <span id="clicks">0</span></div>

  <!-- Triche separator -->
  <hr id="triche-sep">
  <div id="triche-label">Triche</div>

  <!-- Pied de page : boutons de test et annuler -->
  <div class="debug-row">
    <button class="btn-yellow" id="test-btn" onclick="addMoney()">+1000 cr√©dits (test)</button>
    <button class="btn-yellow" id="plus1-btn" onclick="addOneNature()">+1 ressource</button>
    <button class="btn-annuler" id="undo-btn" onclick="undoAction()">‚è™ Annuler le clic pr√©c√©dent</button>
  </div>

  <script>
    let nature = 300, confort = 0, production = 0, money = 10, clicks = 0;
    let prodCost = 5, upgradeUsed1 = false, upgradeUsed2 = false, techLevel = 0;
    let lastCrisisResource = 20, criseSocialeActive = false, jeuBloque = false, lastState = null;
    let monnaieActive = false;

    // Automatisation
    let ouvriers = 0, prixOuvrier = 500;
    let ouvriersActive = false;
    let ouvriersTimer = null;

    function updateUI(message = "") {
      document.getElementById("nature").textContent = nature;
      document.getElementById("confort").textContent = confort;
      document.getElementById("production").textContent = production;
      document.getElementById("tech-level").textContent = techLevel > 0 ? "Niveau technologique : " + techLevel : "";
      document.getElementById("clicks").textContent = clicks;

      let disabled = (jeuBloque === true || !monnaieActive);

      document.getElementById("money-row").style.display = monnaieActive ? "block" : "none";
      document.getElementById("don-btn").style.display = monnaieActive ? "none" : "inline-block";
      if (monnaieActive) document.getElementById("money").textContent = money;

      document.getElementById("upgrade-btn1").style.display = (monnaieActive && clicks >= 100 && !upgradeUsed1) ? "inline-block" : "none";
      if (monnaieActive && clicks >= 101 && !upgradeUsed2) {
        document.getElementById("upgrade-btn2").style.display = "inline-block";
        document.getElementById("upgrade-btn2").disabled = (money < 2000) || disabled;
      } else {
        document.getElementById("upgrade-btn2").style.display = "none";
      }
      // --- Palier ouvrier, appara√Æt √† 250 clics
      if (monnaieActive && clicks >= 250) {
        document.getElementById("ouvrier-btn").style.display = "inline-block";
      } else {
        document.getElementById("ouvrier-btn").style.display = "none";
      }
      document.getElementById("evolution-btn").style.display = (monnaieActive && nature <= 5 && !disabled) ? "inline-block" : "none";

      document.getElementById("produce-btn").disabled = (!monnaieActive || nature < prodCost || (!upgradeUsed1 && !upgradeUsed2 && money < 1) || disabled);
      document.getElementById("sell-btn").disabled = (!monnaieActive || production < 1 || disabled);
      document.getElementById("test-btn").disabled = !monnaieActive || disabled;
      document.getElementById("plus1-btn").disabled = !monnaieActive || disabled;
      document.getElementById("upgrade-btn1").disabled = disabled;
      document.getElementById("evolution-btn").disabled = disabled;
      document.getElementById("undo-btn").disabled = disabled;
      document.getElementById("ouvrier-btn").disabled = (money < prixOuvrier || disabled);

      // Affichage du nombre d'ouvriers
      const ouvInfo = document.getElementById("ouvrier-info");
      if (ouvriers > 0) {
        ouvInfo.style.display = "block";
        ouvInfo.textContent = `Ouvriers‚ÄØ: ${ouvriers} (production automatique)`;
      } else {
        ouvInfo.style.display = "none";
      }

      document.getElementById("message").textContent = message;

      let criseBox = document.getElementById("alert-crise");
      if (nature < 20) {
        criseBox.style.display = "block";
        criseBox.textContent = "Crise √©cologique‚ÄØ: risque sur l'habitabilit√© humaine de la plan√®te ‚Äì perte de confort";
      } else {
        criseBox.style.display = "none";
      }

      let ehBox = document.getElementById("eh-msg");
      if (monnaieActive && nature <= 5) {
        ehBox.style.display = "block";
        ehBox.textContent = "Une √©volution est possible‚ÄØ: passer √† l‚Äô√©conomie hom√©ostatique (EH)";
      } else {
        ehBox.style.display = "none";
      }

      let socialBox = document.getElementById("social-crise");
      let revolutionBox = document.getElementById("revolution");
      if (confort > 5) criseSocialeActive = true;
      if (criseSocialeActive && !jeuBloque) {
        if (confort > 0 && confort < 5) {
          socialBox.style.display = "block";
          socialBox.textContent = "Crise sociale ‚Äì risque de r√©volution";
        } else {
          socialBox.style.display = "none";
        }
        if (confort === 0) {
          revolutionBox.style.display = "block";
          revolutionBox.textContent = "R√âVOLUTION ‚Äì FIN DE JEU";
          jeuBloque = true;
        } else {
          revolutionBox.style.display = "none";
        }
      } else {
        socialBox.style.display = "none";
        revolutionBox.style.display = "none";
      }
    }

    function saveState() {
      lastState = JSON.stringify({
        nature, confort, production, money, clicks, prodCost,
        upgradeUsed1, upgradeUsed2, techLevel, lastCrisisResource,
        criseSocialeActive, jeuBloque, monnaieActive, ouvriers
      });
    }
    function undoAction() {
      if (lastState) {
        let s = JSON.parse(lastState);
        nature = s.nature;
        confort = s.confort;
        production = s.production;
        money = s.money;
        clicks = s.clicks;
        prodCost = s.prodCost;
        upgradeUsed1 = s.upgradeUsed1;
        upgradeUsed2 = s.upgradeUsed2;
        techLevel = s.techLevel;
        lastCrisisResource = s.lastCrisisResource;
        criseSocialeActive = s.criseSocialeActive;
        jeuBloque = s.jeuBloque;
        monnaieActive = s.monnaieActive;
        ouvriers = s.ouvriers;
        updateUI("Derni√®re action annul√©e !");
      }
    }

    function produce() {
      if (jeuBloque || !monnaieActive) return;
      saveState();
      if (nature >= prodCost && (money >= 1 || upgradeUsed1 || upgradeUsed2)) {
        let previousNature = nature;
        nature -= prodCost;
        production += 1;
        money -= 1;
        clicks++;
        if (nature < 20 && previousNature >= 20) lastCrisisResource = previousNature;
        if (nature < 20 && Math.floor((lastCrisisResource - nature) / 3) > 0) {
          let palier = Math.floor((lastC
