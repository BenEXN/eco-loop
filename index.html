<!--
Changelog â€“ Looop

v1.9.0 (28/07/2025)
- Ajout d'un taux dâ€™intÃ©rÃªt de 5 % prÃ©levÃ© sur la dette toutes les 10 actions tant que monnaie < 0.
- Apparition d'une jauge violette "intÃ©rÃªts sur la dette" sous la jauge monnaie si dette.
- Affichage du taux dâ€™intÃ©rÃªt dans le cadre Ã©conomie (visible si dette).
- Ajout du bouton violet "NÃ©gocier son taux dâ€™intÃ©rÃªt" (inactif au dÃ©part, visible aprÃ¨s le 1er prÃ©lÃ¨vement d'intÃ©rÃªt, activable Ã  200 clics).
- Nettoyage automatique de l'UI si retour en positif.
-->

<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Looop v1.9.0 â€“ Taux d'intÃ©rÃªt & nÃ©gociation</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    /* ... [GARDE TOUT TON CSS PRÃ‰CÃ‰DENT] ... */

    /* Ajout style bouton nÃ©gociation */
    .btn-negociation {
      background: #6d28d9;
      color: #fff;
      font-weight: bold;
      border: none;
      border-radius: 14px;
      padding: 10px 18px;
      margin: 10px 0;
      font-size: 1em;
      cursor: not-allowed;
      opacity: 0.75;
      transition: opacity 0.2s;
      box-shadow: 0 1px 4px #6d28d955;
      letter-spacing: .03em;
      outline: none;
    }
    .btn-negociation.active {
      opacity: 1;
      cursor: pointer;
      box-shadow: 0 2px 8px #6d28d955;
    }
    /* Jauge violette d'intÃ©rÃªt */
    #jauge-interet .jauge-bottom-bar { background: #ede9fe !important;}
    #jauge-interet .jauge-bottom-fill { background: #6d28d9 !important;}
    #jauge-interet .jauge-bottom-val, #jauge-interet .jauge-bottom-label { color: #6d28d9 !important; }
  </style>
</head>
<body>
  <h1>ğŸŒ Looop <span style="font-size:0.7em;color:#777;">v1.9.0</span></h1>
  <div class="container">
    <div class="category">
      <div class="cat-title">ğŸŒ± Environnement</div>
      <div class="stock">Ressources : <span id="nature">300</span></div>
      <div id="alert-crise" class="message-box msg-orange" style="display:none;"></div>
      <div class="btn-row">
        <button id="produce-btn" onclick="produce()">ğŸ› ï¸ Produire</button>
      </div>
    </div>
    <div class="category">
      <div class="cat-title">ğŸ¤– Exosomatisation</div>
      <div class="stock">Confort : <span id="confort">0</span></div>
      <div class="products-box">
        Produits crÃ©Ã©s<br>
        <span id="production">0</span>
      </div>
      <div class="stock" id="tech-level"></div>
      <div class="stock" id="ia-info"></div>
      <div id="venteauto-info"></div>
      <div id="social-crise" class="message-box msg-brown" style="display:none;"></div>
      <div class="btn-row">
        <button id="sell-btn" onclick="sell()">ğŸ’¶ Vente</button>
      </div>
    </div>
    <div class="category">
      <div class="cat-title">ğŸ’¶ Ã‰conomie</div>
      <div class="stock" id="money-row" style="display:none;">
        Monnaie (â‚¬) : <span id="money">10</span>
        <div id="interet-row" style="display:none; font-weight:bold; color:#6d28d9; margin-top:6px;"></div>
        <button id="nego-btn" class="btn-negociation" style="display:none;" disabled>NÃ©gocier son taux dâ€™intÃ©rÃªt</button>
      </div>
      <button id="don-btn" onclick="receiveDon()">Recevoir mon don</button>
      <div id="eh-msg" class="message-box msg-blue" style="display:none;"></div>
      <div class="btn-row">
        <button id="ouvrier-btn" onclick="acheterIA()">ğŸ¤– Engager une IA (500 â‚¬)</button>
        <button id="trading-btn" class="btn-trading" onclick="acheterTrader()">ğŸª Acheter un trader auto (1000 â‚¬)</button>
        <button id="upgrade-btn2" onclick="upgradeProd2()">ğŸ’  AmÃ©liorer la production (2 000 â‚¬)</button>
        <button id="evolution-btn" onclick="evolution()" style="display:none;">ğŸŒ± Ã‰volution Ã©conomique</button>
      </div>
    </div>
  </div>

  <div id="prodauto-row">
    <div id="venteauto-wrapper" style="display:none;">
      <button id="venteauto-btn" class="btn-venteauto">Vente auto : ON</button>
    </div>
    <div id="prodauto-wrapper" style="display:none;">
      <button id="prodauto-btn" class="btn-prodauto on">Production auto : ON</button>
    </div>
  </div>

  <!-- Jauges sobres + JAUGE INTÃ‰RÃŠT -->
  <div style="margin: 0 auto 14px auto; max-width:620px;">
    <div class="jauge-bottom-barre">
      <div class="jauge-bottom-label">ğŸŒ± Ressources</div>
      <div class="jauge-bottom-bar"><div class="jauge-bottom-fill" id="jauge-nature"></div></div>
      <div class="jauge-bottom-val" id="jauge-nature-txt"></div>
    </div>
    <div class="jauge-bottom-barre" id="jauge-confort-container" style="display:none;">
      <div class="jauge-bottom-label">ğŸ¤– Confort</div>
      <div class="jauge-bottom-bar"><div class="jauge-bottom-fill" id="jauge-confort"></div></div>
      <div class="jauge-bottom-val" id="jauge-confort-txt"></div>
    </div>
    <div class="jauge-bottom-barre" id="jauge-money-container" style="display:none;">
      <div class="jauge-bottom-label">ğŸ’¶ Monnaie</div>
      <div class="jauge-bottom-bar"><div class="jauge-bottom-fill" id="jauge-money"></div></div>
      <div class="jauge-bottom-val" id="jauge-money-txt"></div>
    </div>
    <!-- JAUGE INTERÃŠT -->
    <div class="jauge-bottom-barre" id="jauge-interet" style="display:none;">
      <div class="jauge-bottom-label">ğŸ’³ IntÃ©rÃªts</div>
      <div class="jauge-bottom-bar">
        <div class="jauge-bottom-fill"></div>
      </div>
      <div class="jauge-bottom-val"></div>
    </div>
    <div class="jauge-bottom-barre" id="jauge-ia-container" style="display:none;">
      <div class="jauge-bottom-label">ğŸ¤– IA</div>
      <div class="jauge-bottom-bar"><div class="jauge-bottom-fill" id="jauge-ia"></div></div>
      <div class="jauge-bottom-val" id="jauge-ia-txt"></div>
    </div>
    <div class="jauge-bottom-barre" id="jauge-venteauto-container" style="display:none;">
      <div class="jauge-bottom-label">ğŸª Vente auto</div>
      <div class="jauge-bottom-bar"><div class="jauge-bottom-fill" id="jauge-venteauto"></div></div>
      <div class="jauge-bottom-val" id="jauge-venteauto-txt"></div>
    </div>
    <div class="jauge-bottom-barre" id="jauge-tech-container" style="display:none;">
      <div class="jauge-bottom-label">ğŸ§ª Technologie</div>
      <div class="jauge-bottom-bar"><div class="jauge-bottom-fill" id="jauge-tech"></div></div>
      <div class="jauge-bottom-val" id="jauge-tech-txt"></div>
    </div>
  </div>
  <div id="revolution" class="message-box msg-red" style="display:none;"></div>
  <div class="message" id="message"></div>
  <div id="clics-container">Clics/actions : <span id="clicks">0</span></div>
  <hr id="triche-sep">
  <div id="triche-label">Triche</div>
  <div class="debug-row">
    <button class="btn-yellow" id="test-btn" onclick="addMoney()">+1000 crÃ©dits (test)</button>
    <button class="btn-yellow" id="plus1-btn" onclick="addOneNature()">+1 ressource</button>
    <button class="btn-yellow" id="test-clics-btn" onclick="addClicks50()">Clics +50 (test)</button>
    <button class="btn-annuler" id="undo-btn" onclick="undoAction()">âª Annuler le clic prÃ©cÃ©dent</button>
  </div>

  <script>
    // ----- VARIABLES JEU -----
    let nature = 300, confort = 0, production = 0, money = 10, clicks = 0;
    let prodCost = 5, techLevel = 0;
    let upgradeCount = 0;
    let upgradeAvailable = false;
    let lastUpgradePalier = 0;
    let lastCrisisResource = 20, criseSocialeActive = false, jeuBloque = false, lastState = null;
    let monnaieActive = false;
    let ia = 0, prixIA = 500;
    let iaProdTimer = null, iaProdOn = true;
    let venteAutoActive = true;
    let venteAutoCount = 0;
    let venteAutoTimers = [];

    // --- NOUVELLES VARIABLES ---
    let tauxInteret = 5; // Pourcentage appliquÃ© Ã  la dette
    let detteActive = false; // true si en dette
    let compteurInteret = 0; // Nombre d'actions en dette depuis dernier prÃ©lÃ¨vement
    let boutonNegociationVisible = false; // Affichage bouton nÃ©gociation
    let boutonNegociationActif = false; // Clique possible Ã  200 clics

    // ----- MISE Ã€ JOUR DE L'INTERFACE -----
    function updateUI(message = "") {
      document.getElementById("nature").textContent = nature;
      document.getElementById("confort").textContent = confort;
      document.getElementById("production").textContent = production;
      document.getElementById("tech-level").textContent = techLevel > 0 ? "Niveau technologique : " + techLevel : "";
      document.getElementById("clicks").textContent = clicks;
      document.getElementById("ia-info").textContent = ia > 0 ? "IA : " + ia + " (production automatique)" : "";

      const venteautoInfo = document.getElementById("venteauto-info");
      if (venteAutoCount > 0) {
        venteautoInfo.textContent = `Vente : ${venteAutoCount} (vente automatique)`;
        venteautoInfo.style.display = "block";
      } else {
        venteautoInfo.textContent = "";
        venteautoInfo.style.display = "none";
      }

      document.getElementById("money-row").style.display = monnaieActive ? "block" : "none";
      document.getElementById("don-btn").style.display = monnaieActive ? "none" : "inline-block";
      if (monnaieActive) document.getElementById("money").textContent = money;

      // ---- GESTION TAUX D'INTÃ‰RÃŠT ET BOUTON NÃ‰GOCIATION ----
      const interetRow = document.getElementById("interet-row");
      const jaugeInteret = document.getElementById("jauge-interet");
      const negoBtn = document.getElementById("nego-btn");

      if (monnaieActive && money < 0) {
        detteActive = true;

        // Affiche taux d'intÃ©rÃªt sous le solde
        interetRow.style.display = "block";
        interetRow.textContent = "Taux dâ€™intÃ©rÃªt : " + tauxInteret + " %";

        // Jauge violette fixe Ã  5%
        jaugeInteret.style.display = "flex";
        jaugeInteret.querySelector(".jauge-bottom-fill").style.width = "100%";
        jaugeInteret.querySelector(".jauge-bottom-val").textContent = tauxInteret + " %";

        // Affiche ou non le bouton nÃ©gociation
        if (boutonNegociationVisible) {
          negoBtn.style.display = "inline-block";
          if (boutonNegociationActif) {
            negoBtn.disabled = false;
            negoBtn.classList.add("active");
            negoBtn.title = "Cliquez pour nÃ©gocier votre taux ! (fonctionnalitÃ© Ã  venir)";
          } else {
            negoBtn.disabled = true;
            negoBtn.classList.remove("active");
            negoBtn.title = "Disponible Ã  partir de 200 actions.";
          }
        } else {
          negoBtn.style.display = "none";
        }

      } else {
        // Sortie de dette : tout disparaÃ®t et reset
        detteActive = false;
        compteurInteret = 0;
        boutonNegociationVisible = false;
        boutonNegociationActif = false;
        interetRow.style.display = "none";
        jaugeInteret.style.display = "none";
        negoBtn.style.display = "none";
      }

      // ----- RESTE DE LA FONCTION updateUI (inchangÃ©) -----
      document.getElementById("produce-btn").disabled = (!monnaieActive || nature < prodCost || jeuBloque);
      document.getElementById("sell-btn").disabled = (!monnaieActive || production < 1 || jeuBloque);
      document.getElementById("test-btn").disabled = !monnaieActive || jeuBloque;
      document.getElementById("plus1-btn").disabled = !monnaieActive || jeuBloque;
      document.getElementById("test-clics-btn").disabled = !monnaieActive || jeuBloque;
      document.getElementById("undo-btn").disabled = jeuBloque;
      document.getElementById("message").textContent = message;

      const venteautoWrapper = document.getElementById("venteauto-wrapper");
      const venteautoBtn = document.getElementById("venteauto-btn");
      if (venteAutoCount > 0) {
        venteautoWrapper.style.display = "flex";
        venteautoBtn.textContent = "Vente auto : " + (venteAutoActive ? "ON" : "OFF");
        venteautoBtn.className = "btn-venteauto" + (venteAutoActive ? " on" : "");
      } else {
        venteautoWrapper.style.display = "none";
      }

      const prodautoWrapper = document.getElementById("prodauto-wrapper");
      const prodautoBtn = document.getElementById("prodauto-btn");
      if (ia > 0) {
        prodautoWrapper.style.display = "flex";
        prodautoBtn.textContent = "Production auto : " + (iaProdOn ? "ON" : "OFF");
        prodautoBtn.className = "btn-prodauto" + (iaProdOn ? " on" : "");
      } else {
        prodautoWrapper.style.display = "none";
      }

      const criseBox = document.getElementById("alert-crise");
      if (nature < 20) {
        criseBox.style.display = "block";
        criseBox.textContent = "Crise Ã©cologique : risque sur l'habitabilitÃ© humaine de la planÃ¨te â€“ perte de confort";
      } else {
        criseBox.style.display = "none";
      }

      const ehBox = document.getElementById("eh-msg");
      if (monnaieActive && nature <= 5) {
        ehBox.style.display = "block";
        ehBox.textContent = "Une Ã©volution est possible : passer Ã  l'Ã©conomie homÃ©ostatique (EH)";
      } else {
        ehBox.style.display = "none";
      }

      const socialBox = document.getElementById("social-crise");
      const revolutionBox = document.getElementById("revolution");
      if (confort > 5) criseSocialeActive = true;
      if (criseSocialeActive && !jeuBloque) {
        if (confort > 0 && confort < 5) {
          socialBox.style.display = "block";
          socialBox.textContent = "Crise sociale â€“ risque de rÃ©volution";
        } else {
          socialBox.style.display = "none";
        }
        if (confort === 0) {
          revolutionBox.style.display = "block";
          revolutionBox.textContent = "RÃ‰VOLUTION â€“ FIN DE JEU";
          jeuBloque = true;
        } else {
          revolutionBox.style.display = "none";
        }
      } else {
        socialBox.style.display = "none";
        revolutionBox.style.display = "none";
      }
      updateJauges();
      updateButtons();
    }

    // ------ AJOUT : TRAITEMENT DU TAUX D'INTÃ‰RÃŠT SUR LA DETTE ------
    function appliquerInteretSurDette() {
      if (money < 0) {
        const interetPonction = Math.ceil(Math.abs(money) * tauxInteret / 100);
        money -= interetPonction;
        updateUI(`Int

