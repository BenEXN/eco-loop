<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Looop v1.16.0 ‚Äì Corrections du plan</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body { background: #f3f3f3; font-family: sans-serif; margin:0; padding:0; }
    h1 { text-align: center; margin: 25px 0 10px; }
    .container { display: flex; justify-content: center; align-items: flex-start; margin: 0 auto 18px auto; max-width: 950px; gap: 24px;}
    .category { background: #fff; border-radius: 18px; box-shadow: 0 4px 24px #0001; flex: 1; padding: 32px 18px 18px 18px; margin: 0 6px; min-width: 250px; max-width: 320px; min-height: 250px; display: flex; flex-direction: column; align-items: center;}
    .cat-title { font-size: 1.25em; margin-bottom: 20px; font-weight: bold; letter-spacing: 1px;}
    .stock { font-size: 1.1em; margin-bottom: 10px;}
    .products-box { background: #f7f7fa; border: 2px solid #dde1eb; border-radius: 10px; color: #333; margin-bottom: 10px; padding: 10px 28px; font-size: 1.2em; font-weight: bold; letter-spacing: 1px; box-shadow: 0 1px 4px #ddd5; min-width: 110px; text-align: center;}
    .message-box { border-radius: 10px; margin: 8px 0 14px 0; padding: 11px 14px 11px 14px; font-weight: bold; font-size: 1.08em; box-shadow: 0 1px 4px #0002; text-align: center; min-width: 130px; max-width: 260px; word-break: break-word; line-height: 1.25em;}
    .msg-orange { background: #ffe9cf; color: #d2691e; border: 2px solid #f5c387;}
    .msg-blue { background: #e7f4ff; color: #0978c6; border: 2px solid #7cc8fa;}
    .msg-red { background: #ffe3e3; color: #c00; border: 2px solid #e48888;}
    .msg-brown { background: #fff4d6; color: #be8c00; border: 2px solid #e2c071;}
    .msg-purple { background: #f3e5f5; color: #7b1fa2; border: 2px solid #ce93d8;}
    .msg-green { background: #e8f5e8; color: #2e7d32; border: 2px solid #81c784;}
    .btn-row { margin: 18px 0 0 0;}
    button { font-size: 1em; padding: 10px 18px; margin: 5px 0; border-radius: 14px; border: none; background: #ededed; color: #111; cursor: pointer; transition: background 0.2s;}
    button:disabled { opacity: 0.5; background: #ededed; color: #bbb; cursor: not-allowed;}
    .btn-prodauto { background: #094075; color: #fff; font-weight: bold; border-radius: 8px;}
    .btn-prodauto.on { background: #094075; color: #fff; }
    .btn-venteauto { background: #f9c9e6; color: #a52b74; font-weight: bold; margin-right: 10px; border-radius: 8px;}
    .btn-venteauto.on { background: #ea6bbd; color: #fff;}
    .btn-confortauto { background: #86b6ea; color: #fff; font-weight: bold; margin-right: 10px; border-radius: 8px;}
    .btn-confortauto.on { background: #86b6ea; color: #fff;}
    .btn-trading { background: #ededed; color: #111; font-weight: normal; border: none; border-radius: 14px; font-size: 1.08em; padding: 10px 18px; margin: 5px 0; cursor: pointer; box-shadow: 0 1px 2px #0001; transition: background 0.2s; display: inline-block;}
    .btn-trading:disabled { background: #ededed; color: #bbb; cursor: not-allowed;}
    .btn-primary { background: #2976d9; color: #fff; font-weight: bold; }
    .btn-yellow { background: #FFD600; color: #222; font-weight: bold;}
    .btn-green  { background: #4fd860; color: #fff; font-weight: bold;}
    .btn-annuler { background: #aaa; color: #fff; }
    .debug-row { margin: 0 0 32px 0; display: flex; justify-content: center; gap: 10px;}
    .message { font-weight: bold; min-height: 24px; margin: 10px 0;}
    #prodauto-row { width:100%; display:flex; justify-content: center; align-items: center; gap:12px; margin: 26px 0 18px 0;}
    #prodauto-wrapper, #venteauto-wrapper, #confortauto-wrapper, #prixrelatif-wrapper { display: flex; }
    @media (max-width: 900px) { #prodauto-row { margin: 16px 0 10px 0;} }
    #clics-container { text-align: center; margin: 25px 0 0 0; font-size: 1.2em; font-weight: bold; color: #333;}
    #revolution { color: #b10000; font-size: 1.1em; text-transform: uppercase;}
    #tech-level, #ia-info { font-size:1em; color:#2980b9; margin-bottom: 0; font-weight: normal;}
    #venteauto-info { font-size: 1.03em; color: #ea6bbd; margin: 2px 0 0 0; font-weight: normal;}
    #confortauto-info { font-size: 1.03em; color: #86b6ea; margin: 2px 0 0 0; font-weight: normal;}
    #triche-sep { border: none; border-top: 3px solid #222; margin: 38px auto 12px auto; width: 94vw; max-width: 1000px;}
    #triche-label { text-align: left; font-size:1.13em; font-weight:normal; letter-spacing:1px; margin: 0 0 12px 0; color:#111; width: 95vw; max-width: 1000px; margin-left: auto; margin-right: auto;}
    #don-btn { margin-top: 10px; background: #FFD600; color: #222; font-weight: bold; border: none; border-radius: 8px; font-size: 1.1em; padding: 14px 20px; box-shadow: 0 1px 8px #fffdbe99;}
    .jauge-bottom-barre { margin: 0 auto 6px auto; display: flex; flex-direction: row; align-items: center; gap: 8px; max-width: 600px;}
    .jauge-bottom-label { min-width: 70px; font-size: .99em; color: #888; text-align: right;}
    .jauge-bottom-bar { background: #eee; border-radius: 8px; height: 13px; flex: 1; overflow: hidden; position: relative;}
    .jauge-bottom-fill { height: 100%; border-radius: 8px; transition: width 0.19s;}
    #jauge-nature { background: #86e08e;}
    #jauge-confort { background: #86b6ea;}
    #jauge-money { background: #ffb3b3;}
    #jauge-ia { background: #094075;}
    #jauge-tech { background: #ba9afc;}
    #jauge-venteauto { background: #fd90d9;}
    #jauge-confortauto { background: #86b6ea;}
    #jauge-taux { background: #9b59b6;}
    #jauge-budget { background: #f9e79f;}
    #jauge-usines { background: #ff5722;}
    #jauge-marches { background: #795548;}
    #jauge-centres { background: #86b6ea;}
    .btn-bercy { background: #f39c12; color: #fff; font-weight: bold; border-radius: 8px; margin-left: 10px; padding: 6px 12px; font-size: 0.9em;}
    .btn-bercy.on { background: #f39c12; color: #fff; }
    .btn-bercy.off { background: #bdc3c7; color: #7f8c8d; }
    .btn-negocier { background: #9b59b6; color: #fff; font-weight: bold; border-radius: 8px; opacity: 0.6; font-size: 1em; position: relative;}
    .btn-negocier.active { background: #9b59b6; color: #fff; opacity: 1;}
    #negocier-cost { display: block; font-size: 0.89em; opacity: 0.82; line-height: 1.1em; font-weight: normal; color: #e4d9fa;}
    #taux-info { font-size: 1.03em; color: #9b59b6; margin: 2px 0 0 0; font-weight: normal;}
    .jauge-bottom-val { font-size: .97em; color: #666; min-width: 60px; text-align: left; padding-left: 4px; }
    
    /* Nouvelles fonctionnalit√©s */
    .btn-factory { background: #ff5722; color: #fff; font-weight: bold; border-radius: 8px;}
    .btn-trading-market { background: #795548; color: #fff; font-weight: bold; border-radius: 8px;}
    .btn-price-indicator { background: #607d8b; color: #fff; font-weight: bold; border-radius: 8px;}
    .btn-auto-clicks { background: #9c27b0; color: #fff; font-weight: bold; border-radius: 8px;}
    .btn-prixrelatif { background: #607d8b; color: #fff; font-weight: bold; border-radius: 8px;}
    .btn-prixrelatif.on { background: #607d8b; color: #fff; }
    .btn-centre-commercial { background: #86b6ea; color: #fff; font-weight: bold; border-radius: 8px;}
    
    .price-indicator { background: #f7f7fa; border: 2px solid #dde1eb; border-radius: 10px; padding: 10px; margin: 10px 0; text-align: center;}
    .hidden { display: none; }
    
    /* √âv√©nements al√©atoires */
    #event-display { position: fixed; top: 20px; right: 20px; max-width: 300px; z-index: 1000; background: rgba(255,255,255,0.95); border-radius: 10px; padding: 15px; box-shadow: 0 4px 20px rgba(0,0,0,0.3); border-left: 5px solid #ff6b35; display: none; animation: slideIn 0.5s ease;}
    @keyframes slideIn { from { transform: translateX(100%); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
    #event-title { font-weight: bold; color: #333; margin-bottom: 8px; font-size: 1.1em;}
    #event-description { color: #666; font-size: 0.95em; line-height: 1.3;}
    
    @media (max-width: 700px) {
      .container { flex-direction: column; align-items: stretch; gap: 12px;}
      .category { max-width: none; min-width: 0; margin: 0 0 20px 0; padding: 18px 10px 12px 10px;}
      .products-box, .message-box { min-width: 0; font-size: 1.04em; padding: 8px 4px;}
      #clics-container { font-size: 1.05em;}
      button { width: 96%; max-width: 340px; font-size: 1em; margin-left: auto; margin-right: auto;}
      .debug-row { flex-direction: column; gap: 6px;}
      #triche-label { font-size:1em; margin-left: 4vw;}
      h1 { font-size: 1.16em;}
      .jauge-bottom-barre { max-width: 98vw; }
      .jauge-bottom-label, .jauge-bottom-val { font-size: 0.91em; }
      #prodauto-row { flex-direction:column; gap:8px;}
      #event-display { position: static; max-width: none; margin: 10px; }
    }
  </style>
</head>
<body>
  <!-- Affichage des √©v√©nements al√©atoires -->
  <div id="event-display">
    <div id="event-title"></div>
    <div id="event-description"></div>
  </div>

  <h1>üåç Looop <span style="font-size:0.7em;color:#777;">v1.16.0</span></h1>
  <div class="container">
    <!-- Colonne Environnement -->
    <div class="category">
      <div class="cat-title">üå± Environnement</div>
      <div class="stock">Ressources : <span id="nature">300</span></div>
      <div id="alert-crise" class="message-box msg-orange" style="display:none;"></div>
      <div class="btn-row">
        <button id="produce-btn" onclick="produce()">üõ†Ô∏è Produire</button>
      </div>
    </div>
    
    <!-- Colonne Exosomatisation -->
    <div class="category">
      <div class="cat-title">ü§ñ Exosomatisation</div>
      <div class="stock">Confort : <span id="confort">0</span></div>
      <div class="products-box">
        Produits cr√©√©s<br>
        <span id="production">0</span>
      </div>
      <div class="stock" id="tech-level" style="display:none;"></div>
      <div class="stock" id="ia-info" style="display:none;"></div>
      <div id="venteauto-info" style="display:none;"></div>
      <div id="confortauto-info" style="display:none;"></div>
      <div id="social-crise" class="message-box msg-brown" style="display:none;"></div>
      <div class="btn-row">
        <button id="comfort-btn" onclick="acheterConfort()" style="display:none;">üõãÔ∏è Acheter confort (+1) - 50‚Ç¨</button>
        <button id="sell-btn" onclick="sell()">üí∂ Vente</button>
      </div>
    </div>
    
    <!-- Colonne √âconomie -->
    <div class="category">
      <div class="cat-title">üí∂ √âconomie</div>
      <div class="stock" id="money-row" style="display:none;">
        Monnaie (‚Ç¨) : <span id="money">10</span>
      </div>
      <div id="taux-info" style="display:none;"></div>
      
      <!-- Indicateur de prix -->
      <div id="price-indicator" class="price-indicator hidden">
        <strong>üìä Prix: <span id="current-price">0</span>‚Ç¨/unit√© de production</strong>
      </div>
      
      <button id="don-btn" onclick="receiveDon()">Recevoir mon don</button>
      <div id="eh-msg" class="message-box msg-blue" style="display:none;"></div>
      <div class="btn-row">
        <button id="ouvrier-btn" onclick="acheterIA()" style="display:none;">ü§ñ Engager une IA (500 ‚Ç¨)</button>
        <button id="trading-btn" class="btn-trading" onclick="acheterTrader()" style="display:none;">üè™ Acheter un trader auto (1000 ‚Ç¨)</button>
        <button id="confort-auto-btn" class="btn-confortauto hidden" onclick="acheterConfortAuto()">üõãÔ∏è Achat confort auto (15s) - 500‚Ç¨</button>
        <button id="upgrade-btn2" onclick="upgradeProd2()" style="display:none;">üí† Am√©liorer la production (2 000 ‚Ç¨)</button>
        
        <!-- Nouvelles fonctionnalit√©s -->
        <button id="factory-btn" class="btn-factory hidden" onclick="acheterUsine()">üè≠ Usine de Production (√ó10) - 20 000 ‚Ç¨</button>
        <button id="trading-market-btn" class="btn-trading-market hidden" onclick="acheterMarcheTrading()">üìà March√© de Trading (√ó10 vente) - 20 000 ‚Ç¨</button>
        <button id="centre-commercial-btn" class="btn-centre-commercial hidden" onclick="acheterCentreCommercial()">üè¨ Centre Commercial (+10 confort/10 clics) - 3 000 ‚Ç¨</button>
        <button id="price-indicator-btn" class="btn-price-indicator hidden" onclick="acheterIndicateurPrix()">üìä Indicateur de Prix - 30 000 ‚Ç¨</button>
        <button id="auto-clicks-btn" class="btn-auto-clicks hidden" onclick="acheterAutoClicks()">‚öôÔ∏è Les automatismes comptent comme des clics - 10 000 ‚Ç¨</button>
        
        <button id="negocier-btn" class="btn-negocier" onclick="negocierTaux()" style="display:none;">
          üìâ N√©gocier son taux d'int√©r√™t
          <span id="negocier-cost"></span>
        </button>
        <button id="evolution-btn" onclick="evolution()" style="display:none;">üå± √âvolution √©conomique</button>
      </div>
    </div>
  </div>
  
  <!-- Boutons de contr√¥le automatique -->
  <div id="prodauto-row">
    <div id="venteauto-wrapper" style="display:none;">
      <button id="venteauto-btn" class="btn-venteauto" onclick="toggleVenteAuto()">Vente auto : ON</button>
    </div>
    <div id="confortauto-wrapper" style="display:none;">
      <button id="confortauto-btn" class="btn-confortauto on" onclick="toggleConfortAuto()">Confort auto : ON</button>
    </div>
    <div id="prodauto-wrapper" style="display:none;">
      <button id="prodauto-btn" class="btn-prodauto on" onclick="toggleProdAuto()">Production auto : ON</button>
    </div>
    <div id="prixrelatif-wrapper" style="display:none;">
      <button id="prixrelatif-btn" class="btn-prixrelatif on" onclick="togglePrixRelatif()">Prix relatif : ON</button>
    </div>
  </div>
  
  <!-- Jauges de progression -->
  <div style="margin: 0 auto 14px auto; max-width:620px;">
    <div class="jauge-bottom-barre">
      <div class="jauge-bottom-label">üå± Ressources</div>
      <div class="jauge-bottom-bar"><div class="jauge-bottom-fill" id="jauge-nature"></div></div>
      <div class="jauge-bottom-val" id="jauge-nature-txt"></div>
    </div>
    <div class="jauge-bottom-barre" id="jauge-confort-container" style="display:none;">
      <div class="jauge-bottom-label">ü§ñ Confort</div>
      <div class="jauge-bottom-bar"><div class="jauge-bottom-fill" id="jauge-confort"></div></div>
      <div class="jauge-bottom-val" id="jauge-confort-txt"></div>
    </div>
    <div class="jauge-bottom-barre" id="jauge-money-container" style="display:none;">
      <div class="jauge-bottom-label">üí∂ Monnaie</div>
      <div class="jauge-bottom-bar"><div class="jauge-bottom-fill" id="jauge-money"></div></div>
      <div class="jauge-bottom-val" id="jauge-money-txt"></div>
    </div>
    <div class="jauge-bottom-barre" id="jauge-budget-container" style="display:none;">
      <div class="jauge-bottom-label">üí∂ Budget √âtat</div>
      <div class="jauge-bottom-bar"><div class="jauge-bottom-fill" id="jauge-budget"></div></div>
      <div class="jauge-bottom-val" id="jauge-budget-txt"></div>
      <button id="bercy-btn" class="btn-bercy on" onclick="toggleTaxe()">üí∂ Imp√¥t ON</button>
    </div>
    <div class="jauge-bottom-barre" id="jauge-taux-container" style="display:none;">
      <div class="jauge-bottom-label">üìâ Taux int√©r√™t</div>
      <div class="jauge-bottom-bar"><div class="jauge-bottom-fill" id="jauge-taux"></div></div>
      <div class="jauge-bottom-val" id="jauge-taux-txt"></div>
    </div>
    <div class="jauge-bottom-barre" id="jauge-ia-container" style="display:none;">
      <div class="jauge-bottom-label">ü§ñ IA</div>
      <div class="jauge-bottom-bar"><div class="jauge-bottom-fill" id="jauge-ia"></div></div>
      <div class="jauge-bottom-val" id="jauge-ia-txt"></div>
    </div>
    <div class="jauge-bottom-barre" id="jauge-venteauto-container" style="display:none;">
      <div class="jauge-bottom-label">üè™ Vente auto</div>
      <div class="jauge-bottom-bar"><div class="jauge-bottom-fill" id="jauge-venteauto"></div></div>
      <div class="jauge-bottom-val" id="jauge-venteauto-txt"></div>
    </div>
    <div class="jauge-bottom-barre" id="jauge-confortauto-container" style="display:none;">
      <div class="jauge-bottom-label">üõãÔ∏è Confort auto</div>
      <div class="jauge-bottom-bar"><div class="jauge-bottom-fill" id="jauge-confortauto"></div></div>
      <div class="jauge-bottom-val" id="jauge-confortauto-txt"></div>
    </div>
    <div class="jauge-bottom-barre" id="jauge-tech-container" style="display:none;">
      <div class="jauge-bottom-label">üß™ Technologie</div>
      <div class="jauge-bottom-bar"><div class="jauge-bottom-fill" id="jauge-tech"></div></div>
      <div class="jauge-bottom-val" id="jauge-tech-txt"></div>
    </div>
    <div class="jauge-bottom-barre" id="jauge-usines-container" style="display:none;">
      <div class="jauge-bottom-label">üè≠ Usines</div>
      <div class="jauge-bottom-bar"><div class="jauge-bottom-fill" id="jauge-usines"></div></div>
      <div class="jauge-bottom-val" id="jauge-usines-txt"></div>
    </div>
    <div class="jauge-bottom-barre" id="jauge-marches-container" style="display:none;">
      <div class="jauge-bottom-label">üìà March√©s</div>
      <div class="jauge-bottom-bar"><div class="jauge-bottom-fill" id="jauge-marches"></div></div>
      <div class="jauge-bottom-val" id="jauge-marches-txt"></div>
    </div>
    <div class="jauge-bottom-barre" id="jauge-centres-container" style="display:none;">
      <div class="jauge-bottom-label">üè¨ Centres</div>
      <div class="jauge-bottom-bar"><div class="jauge-bottom-fill" id="jauge-centres"></div></div>
      <div class="jauge-bottom-val" id="jauge-centres-txt"></div>
    </div>
  </div>
  
  <!-- Messages de status -->
  <div id="revolution" class="message-box msg-red" style="display:none;"></div>
  <div class="message" id="message"></div>
  <div id="clics-container">Clics/actions : <span id="clicks">0</span></div>
  
  <!-- Section Triche -->
  <hr id="triche-sep">
  <div id="triche-label">Triche</div>
  <div class="debug-row">
    <button class="btn-yellow" id="test-btn" onclick="addMoney()">+1000 cr√©dits (test)</button>
    <button class="btn-yellow" id="plus1-btn" onclick="addOneNature()">+100 ressources (test)</button>
    <button class="btn-yellow" id="test-clics-btn" onclick="addClicks50()">Clics +50 (test)</button>
    <button class="btn-yellow" id="test-event-btn" onclick="triggerRandomEvent()">D√©clencher √©v√©nement (test)</button>
    <button class="btn-annuler" id="undo-btn" onclick="undoAction()">‚è™ Annuler le clic pr√©c√©dent</button>
  </div>
  
  <script>
    // Variables globales du jeu
    let nature = 300, confort = 0, production = 0, money = 10, clicks = 0;
    let prodCost = 5, techLevel = 0;
    let upgradeCount = 0;
    let upgradeAvailable = false;
    let lastUpgradePalier = 0;
    let lastCrisisResource = 20, criseSocialeActive = false, jeuBloque = false, lastState = null;
    let monnaieActive = false;
    let ia = 0, prixIA = 500;
    let iaProdTimer = null, iaProdOn = true;
    let venteAutoActive = true;
    let venteAutoCount = 0;
    let venteAutoTimers = [];
    let confortAutoActive = true;
    let confortAutoCount = 0;
    let confortAutoTimers = [];
    let tauxInteret = 5;
    let clicksEnDette = 0;
    let premierPrelevement = false;
    let nbNegociations = 0;
    let lastNegociationClick = 0;
    const maxNegociations = 4, delaiNegociation = 200;
    let budgetEtat = 0;
    let taxeActive = true;
    let clicksTaxe = 0;
    let taxeActivee = false;
    let productionMultiplier = 1;
    let salesMultiplier = 1;
    let factoryLastUsed = 0;
    let tradingMarketLastUsed = 0;
    let centreCommercialLastUsed = 0;
    let priceIndicatorLastUsed = 0;
    let autoClicksLastUsed = 0;
    let confortAutoLastUsed = 0;
    let priceIndicatorActive = false;
    let autoClicksActive = false;
    let prixRelatifActive = true;
    let nbUsines = 0;
    let nbMarches = 0;
    let nbCentres = 0;

    // Variables pour les cycles des boutons automatiques
    let iaLastUsed = 0;
    let tradingLastUsed = 0;

    // Variables pour √©v√©nements al√©atoires
    let lastEventClick = 0;
    let activeEvents = [];
    let eventCooldowns = {};
    let eventModifiers = {
      productionBonus: 1,
      salesBonus: 1,
      costPenalty: 1,
      automationBlocked: false,
      actionsBlocked: false,
      productionBlocked: false,
      salesBlocked: false
    };

    // Base de donn√©es enrichie des √©v√©nements al√©atoires
    const randomEvents = {
      phase1: [
        {
          id: 'prime_exceptionnelle',
          title: 'üí∞ Prime exceptionnelle',
          description: 'Votre √©quipe re√ßoit une prime inattendue !',
          probability: 0.05,
          minClicks: 50,
          effect: function() {
            const bonus = Math.floor(Math.max(money * 0.1, 200));
            money += bonus;
            return '+' + bonus + '‚Ç¨ de prime re√ßue !';
          }
        },
        {
          id: 'bug_logiciel',
          title: 'üêõ Bug logiciel',
          description: 'Un bug ralentit temporairement la production',
          probability: 0.04,
          minClicks: 100,
          effect: function() {
            eventModifiers.productionBonus = 0.6;
            setTimeout(function() { eventModifiers.productionBonus = 1; }, 20000);
            return 'Production r√©duite de 40% pendant 20 secondes';
          }
        },
        {
          id: 'embauche_talentueuse',
          title: 'üåü Embauche talentueuse',
          description: 'Un nouveau talent booste votre √©quipe',
          probability: 0.03,
          minClicks: 150,
          effect: function() {
            productionMultiplier *= 1.1;
            return 'Production permanente +10% !';
          }
        },
        {
          id: 'rupture_stock',
          title: 'üì¶ Rupture de stock',
          description: 'Probl√®me d\'approvisionnement temporaire',
          probability: 0.04,
          minClicks: 200,
          effect: function() {
            eventModifiers.costPenalty = 1.3;
            setTimeout(function() { eventModifiers.costPenalty = 1; }, 25000);
            return 'Co√ªts de production +30% pendant 25 secondes';
          }
        }
      ],
      phase2: [
        {
          id: 'controle_fiscal',
          title: 'üïµÔ∏è Contr√¥le fiscal',
          description: 'L\'administration v√©rifie vos comptes',
          probability: 0.05,
          minClicks: 500,
          effect: function() {
            const penalite = Math.floor(Math.max(money * 0.15, 300));
            money -= penalite;
            budgetEtat += Math.floor(penalite * 0.8);
            return 'P√©nalit√© fiscale : -' + penalite + '‚Ç¨';
          }
        },
        {
          id: 'audit_surprise',
          title: 'üìã Audit surprise',
          description: 'Audit interne qui r√©v√®le des inefficacit√©s',
          probability: 0.04,
          minClicks: 700,
          effect: function() {
            eventModifiers.automationBlocked = true;
            setTimeout(function() { eventModifiers.automationBlocked = false; }, 30000);
            return 'Automatismes bloqu√©s pendant 30 secondes';
          }
        },
        {
          id: 'greve_personnel',
          title: '‚úä Gr√®ve du personnel',
          description: 'Les employ√©s manifestent leurs revendications',
          probability: 0.03,
          minClicks: 800,
          effect: function() {
            eventModifiers.productionBonus = 0.3;
            eventModifiers.salesBlocked = true;
            setTimeout(function() { 
              eventModifiers.productionBonus = 1; 
              eventModifiers.salesBlocked = false;
            }, 35000);
            return 'Production -70% et ventes bloqu√©es pendant 35 secondes';
          }
        },
        {
          id: 'innovation_externe',
          title: 'üí° Innovation externe',
          description: 'Un concurrent lance une innovation disruptive',
          probability: 0.03,
          minClicks: 1000,
          effect: function() {
            eventModifiers.salesBonus = 0.7;
            setTimeout(function() { eventModifiers.salesBonus = 1; }, 40000);
            return 'Ventes r√©duites de 30% pendant 40 secondes';
          }
        },
        {
          id: 'bulle_speculative',
          title: 'üìà Bulle sp√©culative',
          description: 'Les prix s\'envolent temporairement',
          probability: 0.04,
          minClicks: 500,
          effect: function() {
            eventModifiers.salesBonus = 2;
            setTimeout(function() { eventModifiers.salesBonus = 1; }, 20000);
            return 'Ventes doubl√©es pendant 20 secondes !';
          }
        }
      ],
      phase3: [
        {
          id: 'fusion_entreprise',
          title: 'ü§ù Fusion d\'entreprise',
          description: 'Opportunit√© de fusion avec un concurrent',
          probability: 0.03,
          minClicks: 3000,
          effect: function() {
            productionMultiplier *= 1.5;
            salesMultiplier *= 1.3;
            const cout = Math.floor(money * 0.2);
            money -= cout;
            return 'Fusion r√©ussie ! Production √ó1.5, Ventes √ó1.3 (co√ªt: ' + cout + '‚Ç¨)';
          }
        },
        {
          id: 'crash_boursier',
          title: 'üìâ Crash boursier',
          description: 'Effondrement temporaire des march√©s',
          probability: 0.04,
          minClicks: 3500,
          effect: function() {
            const perte = Math.floor(Math.max(money * 0.3, 1000));
            money -= perte;
            eventModifiers.salesBonus = 0.5;
            setTimeout(function() { eventModifiers.salesBonus = 1; }, 45000);
            return 'Perte de ' + perte + '‚Ç¨ et ventes -50% pendant 45s';
          }
        },
        {
          id: 'revolution_technologique',
          title: 'üöÄ R√©volution technologique',
          description: 'Perc√©e technologique majeure',
          probability: 0.02,
          minClicks: 4000,
          effect: function() {
            productionMultiplier *= 1.2;
            techLevel += 2;
            return 'Production permanente +20% et +2 niveaux tech !';
          }
        },
        {
          id: 'cyberattaque',
          title: 'üíª Cyberattaque',
          description: 'Syst√®mes automatiques compromis',
          probability: 0.03,
          minClicks: 4500,
          effect: function() {
            eventModifiers.automationBlocked = true;
            setTimeout(function() { eventModifiers.automationBlocked = false; }, 40000);
            return 'Automatismes bloqu√©s pendant 40 secondes';
          }
        },
        {
          id: 'nouvelle_reglementation',
          title: '‚öñÔ∏è Nouvelle r√©glementation',
          description: 'Nouvelles lois impactent votre secteur',
          probability: 0.04,
          minClicks: 5000,
          effect: function() {
            eventModifiers.costPenalty = 1.4;
            const taxeSup = Math.floor(money * 0.05);
            money -= taxeSup;
            budgetEtat += taxeSup;
            setTimeout(function() { eventModifiers.costPenalty = 1; }, 50000);
            return 'Co√ªts +40% pendant 50s et taxe suppl√©mentaire: ' + taxeSup + '‚Ç¨';
          }
        }
      ],
      phase4: [
        {
          id: 'effondrement_ecosysteme',
          title: 'üåç Effondrement √©cosyst√®me',
          description: 'Crise environnementale majeure',
          probability: 0.04,
          minClicks: 8000,
          effect: function() {
            nature = Math.max(0, nature - 100);
            eventModifiers.costPenalty = 2;
            setTimeout(function() { eventModifiers.costPenalty = 1; }, 60000);
            return 'Perte de 100 ressources et co√ªts doubl√©s pendant 1 minute !';
          }
        },
        {
          id: 'singularite_ia',
          title: 'ü§ñ Singularit√© IA',
          description: 'L\'IA devient autonome et super-efficace',
          probability: 0.01,
          minClicks: 10000,
          effect: function() {
            autoClicksActive = true;
            productionMultiplier *= 2;
            ia += 10;
            return 'IA autonome ! Production √ó2, +10 IA et auto-clics activ√©s !';
          }
        },
        {
          id: 'crise_systemique',
          title: 'üí• Crise syst√©mique',
          description: 'Effondrement du syst√®me √©conomique',
          probability: 0.03,
          minClicks: 12000,
          effect: function() {
            money = Math.floor(money * 0.4);
            eventModifiers.salesBonus = 0.2;
            eventModifiers.productionBonus = 0.3;
            setTimeout(function() { 
              eventModifiers.salesBonus = 1; 
              eventModifiers.productionBonus = 1;
            }, 90000);
            return 'Crise majeure ! 60% des liquidit√©s perdues, production et ventes tr√®s r√©duites pendant 90s';
          }
        },
        {
          id: 'monopolisation',
          title: 'üëë Monopolisation',
          description: 'Vous dominez compl√®tement le march√©',
          probability: 0.02,
          minClicks: 15000,
          effect: function() {
            salesMultiplier *= 3;
            eventModifiers.salesBonus = 1.5;
            return 'Monopole √©tabli ! Ventes √ó3 permanent et +50% de bonus !';
          }
        }
      ]
    };

    function getCurrentPhase() {
      if (clicks < 500) return 'phase1';
      if (clicks < 3000) return 'phase2';
      if (clicks < 8000) return 'phase3';
      return 'phase4';
    }

    // ===== FONCTIONS DE SAUVEGARDE =====
    function saveState() {
      lastState = {
        nature: nature,
        confort: confort,
        production: production,
        money: money,
        clicks: clicks,
        techLevel: techLevel,
        upgradeCount: upgradeCount,
        ia: ia,
        venteAutoCount: venteAutoCount,
        confortAutoCount: confortAutoCount,
        tauxInteret: tauxInteret,
        budgetEtat: budgetEtat,
        productionMultiplier: productionMultiplier,
        salesMultiplier: salesMultiplier,
        nbUsines: nbUsines,
        nbMarches: nbMarches,
        nbCentres: nbCentres
      };
    }

    function undoAction() {
      if (lastState) {
        nature = lastState.nature;
        confort = lastState.confort;
        production = lastState.production;
        money = lastState.money;
        clicks = lastState.clicks;
        techLevel = lastState.techLevel;
        upgradeCount = lastState.upgradeCount;
        ia = lastState.ia;
        venteAutoCount = lastState.venteAutoCount;
        confortAutoCount = lastState.confortAutoCount;
        tauxInteret = lastState.tauxInteret;
        budgetEtat = lastState.budgetEtat;
        productionMultiplier = lastState.productionMultiplier;
        salesMultiplier = lastState.salesMultiplier;
        nbUsines = lastState.nbUsines;
        nbMarches = lastState.nbMarches;
        nbCentres = lastState.nbCentres;
        updateUI("Action annul√©e");
      }
    }

    // ===== FONCTIONS UTILITAIRES =====
    function calculatePrice() {
      if (!prixRelatifActive || nature === 0) return 1;
      return Math.max(1, Math.ceil(Math.abs(money) / nature));
    }

    // ===== ACTIONS PRINCIPALES =====
    function produce() {
      if (jeuBloque || eventModifiers.actionsBlocked || eventModifiers.productionBlocked) return;
      saveState();
      
      const cost = Math.max(1, Math.floor(prodCost * eventModifiers.costPenalty));
      if (nature >= cost) {
        nature -= cost;
        const prodAmount = Math.floor(productionMultiplier * eventModifiers.productionBonus);
        production += prodAmount;
        confort += prodAmount;
        clicks++;
        
        if (autoClicksActive) {
          clicks++;
        }
        
        checkRandomEvents();
        updateUI("Production : +" + prodAmount + " confort");
      } else {
        updateUI("Pas assez de ressources pour produire (co√ªt: " + cost + ")");
      }
    }

    function sell() {
      if (jeuBloque || eventModifiers.actionsBlocked || eventModifiers.salesBlocked || production <= 0) {
        if (production <= 0) {
          updateUI("Aucun produit √† vendre");
        }
        return;
      }
      
      saveState();
      const price = calculatePrice();
      const saleAmount = Math.min(production, Math.floor(salesMultiplier * eventModifiers.salesBonus));
      const totalEarnings = price * saleAmount;
      
      money += totalEarnings;
      production -= saleAmount;
      clicks++;
      
      if (autoClicksActive) {
        clicks++;
      }
      
      if (!monnaieActive) {
        monnaieActive = true;
        document.getElementById("money-row").style.display = "block";
        document.getElementById("jauge-money-container").style.display = "flex";
      }
      
      gererInterets();
      checkRandomEvents();
      updateUI("Vente : +" + totalEarnings + "‚Ç¨ (" + saleAmount + " produits)");
    }

    function acheterConfort() {
      if (jeuBloque || !monnaieActive || eventModifiers.actionsBlocked || money < 50) {
        if (money < 50) {
          updateUI("Pas assez d'argent pour acheter du confort (50‚Ç¨ requis)");
        }
        return;
      }
      
      saveState();
      money -= 50;
      confort += 1;
      clicks++;
      
      if (autoClicksActive) {
        clicks++;
      }
      
      gererInterets();
      checkRandomEvents();
      updateUI("Confort achet√© : +1 confort");
    }

    function receiveDon() {
      if (jeuBloque) return;
      saveState();
      money += 1000;
      clicks++;
      
      if (autoClicksActive) {
        clicks++;
      }
      
      if (!monnaieActive) {
        monnaieActive = true;
        document.getElementById("money-row").style.display = "block";
        document.getElementById("jauge-money-container").style.display = "flex";
      }
      
      document.getElementById("don-btn").style.display = "none";
      checkRandomEvents();
      updateUI("Don re√ßu : +1000‚Ç¨");
    }

    // ===== ACHATS ET AM√âLIORATIONS =====
    function acheterIA() {
      if (jeuBloque || !monnaieActive || eventModifiers.actionsBlocked || money < prixIA) {
        if (money < prixIA) {
          updateUI("Pas assez d'argent pour engager une IA (" + prixIA + "‚Ç¨ requis)");
        }
        return;
      }
      
      saveState();
      money -= prixIA;
      ia++;
      prixIA = Math.floor(prixIA * 1.5);
      clicks++;
      
      if (autoClicksActive) {
        clicks++;
      }
      
      iaLastUsed = clicks;
      document.getElementById("ouvrier-btn").style.display = "none";
      
      manageIAProduction();
      gererInterets();
      checkRandomEvents();
      updateUI("IA engag√©e ! Production automatique activ√©e" + (money < 0 ? " (√† cr√©dit)" : ""));
    }

    function acheterTrader() {
      if (jeuBloque || !monnaieActive || eventModifiers.actionsBlocked || money < 1000) {
        if (money < 1000) {
          updateUI("Pas assez d'argent pour acheter un trader automatique (1000‚Ç¨ requis)");
        }
        return;
      }
      
      saveState();
      money -= 1000;
      venteAutoCount++;
      clicks++;
      
      if (autoClicksActive) {
        clicks++;
      }
      
      tradingLastUsed = clicks;
      document.getElementById("trading-btn").style.display = "none";
      
      startVenteAuto();
      gererInterets();
      checkRandomEvents();
      updateUI("Trader automatique achet√© !" + (money < 0 ? " (√† cr√©dit)" : ""));
    }

    function acheterConfortAuto() {
      if (jeuBloque || !monnaieActive || eventModifiers.actionsBlocked || money < 500) {
        if (money < 500) {
          updateUI("Pas assez d'argent pour l'achat confort automatique (500‚Ç¨ requis)");
        }
        return;
      }
      
      saveState();
      money -= 500;
      confortAutoCount++;
      clicks++;
      
      if (autoClicksActive) {
        clicks++;
      }
      
      confortAutoLastUsed = clicks;
      document.getElementById("confort-auto-btn").classList.add("hidden");
      
      startConfortAuto();
      gererInterets();
      checkRandomEvents();
      updateUI("Achat confort automatique activ√© !" + (money < 0 ? " (√† cr√©dit)" : ""));
    }

    function upgradeProd2() {
      if (jeuBloque || !monnaieActive || eventModifiers.actionsBlocked || money < 2000) {
        if (money < 2000) {
          updateUI("Pas assez d'argent pour am√©liorer la production (2 000‚Ç¨ requis)");
        }
        return;
      }
      
      saveState();
      money -= 2000;
      techLevel++;
      productionMultiplier *= 1.5;
      clicks++;
      
      if (autoClicksActive) {
        clicks++;
      }
      
      gererInterets();
      checkRandomEvents();
      updateUI("Production am√©lior√©e ! Multiplicateur √ó1.5" + (money < 0 ? " (√† cr√©dit)" : ""));
    }

    // ===== NOUVELLES FONCTIONNALIT√âS =====
    function acheterUsine() {
      if (jeuBloque || !monnaieActive || eventModifiers.actionsBlocked || money < 20000) {
        if (money < 20000) {
          updateUI("Pas assez d'argent pour acheter une usine (20 000‚Ç¨ requis)");
        }
        return;
      }
      
      saveState();
      money -= 20000;
      productionMultiplier *= 10;
      nbUsines += 1;
      factoryLastUsed = clicks;
      document.getElementById('factory-btn').classList.add('hidden');
      clicks++;
      
      if (autoClicksActive) {
        clicks++;
      }
      
      gererInterets();
      checkRandomEvents();
      updateUI("Usine de production achet√©e ! Production √ó10" + (money < 0 ? " (√† cr√©dit)" : ""));
    }

    function acheterMarcheTrading() {
      if (jeuBloque || !monnaieActive || eventModifiers.actionsBlocked || money < 20000) {
        if (money < 20000) {
          updateUI("Pas assez d'argent pour acheter un march√© de trading (20 000‚Ç¨ requis)");
        }
        return;
      }
      
      saveState();
      money -= 20000;
      salesMultiplier *= 10;
      nbMarches += 1;
      tradingMarketLastUsed = clicks;
      document.getElementById('trading-market-btn').classList.add('hidden');
      clicks++;
      
      if (autoClicksActive) {
        clicks++;
      }
      
      gererInterets();
      checkRandomEvents();
      updateUI("March√© de trading achet√© ! Ventes √ó10" + (money < 0 ? " (√† cr√©dit)" : ""));
    }

    function acheterCentreCommercial() {
      if (jeuBloque || !monnaieActive || eventModifiers.actionsBlocked || money < 3000) {
        if (money < 3000) {
          updateUI("Pas assez d'argent pour acheter un centre commercial (3 000‚Ç¨ requis)");
        }
        return;
      }
      
      saveState();
      money -= 3000;
      nbCentres += 1;
      centreCommercialLastUsed = clicks;
      document.getElementById('centre-commercial-btn').classList.add('hidden');
      clicks++;
      
      if (autoClicksActive) {
        clicks++;
      }
      
      gererInterets();
      checkRandomEvents();
      updateUI("Centre commercial achet√© ! +10 confort tous les 10 clics" + (money < 0 ? " (√† cr√©dit)" : ""));
    }

    function acheterIndicateurPrix() {
      if (jeuBloque || !monnaieActive || eventModifiers.actionsBlocked || money < 30000) {
        if (money < 30000) {
          updateUI("Pas assez d'argent pour acheter l'indicateur de prix (30 000‚Ç¨ requis)");
        }
        return;
      }
      
      saveState();
      money -= 30000;
      priceIndicatorActive = true;
      priceIndicatorLastUsed = clicks;
      document.getElementById('price-indicator-btn').classList.add('hidden');
      document.getElementById('price-indicator').classList.remove('hidden');
      document.getElementById('prixrelatif-wrapper').style.display = 'flex';
      clicks++;
      
      if (autoClicksActive) {
        clicks++;
      }
      
      gererInterets();
      checkRandomEvents();
      updateUI("Indicateur de prix achet√© !" + (money < 0 ? " (√† cr√©dit)" : ""));
    }

    function acheterAutoClicks() {
      if (jeuBloque || !monnaieActive || eventModifiers.actionsBlocked || money < 10000) {
        if (money < 10000) {
          updateUI("Pas assez d'argent pour l'automatisation compl√®te (10 000‚Ç¨ requis)");
        }
        return;
      }
      
      saveState();
      money -= 10000;
      autoClicksActive = true;
      autoClicksLastUsed = clicks;
      document.getElementById('auto-clicks-btn').classList.add('hidden');
      clicks++;
      
      gererInterets();
      checkRandomEvents();
      updateUI("Automatisation compl√®te activ√©e !" + (money < 0 ? " (√† cr√©dit)" : ""));
    }

    function evolution() {
      if (jeuBloque || !monnaieActive) return;
      saveState();
      updateUI("√âvolution vers l'√©conomie hom√©ostatique - Fonctionnalit√© √† venir");
    }

    function negocierTaux() {
      if (jeuBloque || !monnaieActive || eventModifiers.actionsBlocked) return;
      if (nbNegociations >= maxNegociations) {
        updateUI("Nombre maximum de n√©gociations atteint");
        return;
      }
      if (clicks - lastNegociationClick < delaiNegociation) {
        updateUI("Attendez avant de ren√©gocier");
        return;
      }
      
      // CORRECTION: Co√ªt en confort au lieu d'argent selon le plan
      const coutConfort = Math.floor(confort * 0.1 + 10);
      if (confort < coutConfort) {
        updateUI("Pas assez de confort pour n√©gocier (requis: " + coutConfort + ")");
        return;
      }
      
      saveState();
      confort -= coutConfort;
      tauxInteret = Math.max(1, tauxInteret - 1);
      nbNegociations++;
      lastNegociationClick = clicks;
      clicks++;
      
      if (autoClicksActive) {
        clicks++;
      }
      
      checkRandomEvents();
      updateUI('Taux n√©goci√© √† ' + tauxInteret + '% pour ' + coutConfort + ' confort');
    }

    // ===== SYST√àMES AUTOMATIQUES =====
    function manageIAProduction(interval = 5000) {
      if (iaProdTimer) clearInterval(iaProdTimer);
      
      iaProdTimer = setInterval(function() {
        if (iaProdOn && ia > 0 && !jeuBloque && !eventModifiers.automationBlocked && !eventModifiers.productionBlocked) {
          const cost = Math.max(1, Math.floor(prodCost * eventModifiers.costPenalty));
          if (nature >= cost * ia) {
            nature -= cost * ia;
            const prodAmount = Math.floor(ia * productionMultiplier * eventModifiers.productionBonus);
            production += prodAmount;
            confort += prodAmount;
            
            if (autoClicksActive) {
              clicks += ia;
            }
            
            updateUI();
          }
        }
      }, interval);
    }

    function startVenteAuto() {
      const timer = setInterval(function() {
        if (venteAutoActive && production > 0 && !jeuBloque && !eventModifiers.automationBlocked && !eventModifiers.salesBlocked) {
          const price = calculatePrice();
          const saleAmount = Math.min(production, Math.floor(salesMultiplier * eventModifiers.salesBonus));
          const totalEarnings = price * saleAmount;
          
          money += totalEarnings;
          production -= saleAmount;
          
          if (autoClicksActive) {
            clicks++;
          }
          
          gererInterets();
          updateUI();
        }
      }, 3000);
      venteAutoTimers.push(timer);
    }

    function startConfortAuto() {
      const timer = setInterval(function() {
        if (confortAutoActive && money >= 50 && !jeuBloque && !eventModifiers.automationBlocked) {
          money -= 50;
          confort += 1;
          
          if (autoClicksActive) {
            clicks++;
          }
          
          gererInterets();
          updateUI();
        }
      }, 15000);
      confortAutoTimers.push(timer);
    }

    // ===== SYST√àME √âCONOMIQUE =====
    function gererInterets() {
      if (money < 0 && monnaieActive) {
        clicksEnDette++;
        if (clicksEnDette >= 10) {
          const interets = Math.floor(Math.abs(money) * (tauxInteret / 100));
          money -= interets;
          clicksEnDette = 0;
          
          if (!taxeActivee && !premierPrelevement) {
            budgetEtat += Math.floor(interets * 0.3);
            premierPrelevement = true;
            taxeActivee = true;
            document.getElementById("jauge-budget-container").style.display = "flex";
            document.getElementById("jauge-taux-container").style.display = "flex";
            document.getElementById("taux-info").style.display = "block";
            document.getElementById("negocier-btn").style.display = "block";
          }
        }
      }
      
      if (taxeActivee && taxeActive) {
        clicksTaxe++;
        if (clicksTaxe >= 5) {
          const taxe = Math.floor(Math.max(money, 0) * 0.02 + 10);
          money -= taxe;
          budgetEtat += taxe;
          clicksTaxe = 0;
        }
      }
    }

    // ===== BOUTONS DE CONTR√îLE =====
    function toggleProdAuto() {
      iaProdOn = !iaProdOn;
      const btn = document.getElementById("prodauto-btn");
      if (iaProdOn) {
        btn.textContent = "Production auto : ON";
        btn.classList.add("on");
      } else {
        btn.textContent = "Production auto : OFF";
        btn.classList.remove("on");
      }
    }

    function toggleVenteAuto() {
      venteAutoActive = !venteAutoActive;
      const btn = document.getElementById("venteauto-btn");
      if (venteAutoActive) {
        btn.textContent = "Vente auto : ON";
        btn.classList.add("on");
      } else {
        btn.textContent = "Vente auto : OFF";
        btn.classList.remove("on");
      }
    }

    function toggleConfortAuto() {
      confortAutoActive = !confortAutoActive;
      const btn = document.getElementById("confortauto-btn");
      if (confortAutoActive) {
        btn.textContent = "Confort auto : ON";
        btn.classList.add("on");
      } else {
        btn.textContent = "Confort auto : OFF";
        btn.classList.remove("on");
      }
    }

    function togglePrixRelatif() {
      prixRelatifActive = !prixRelatifActive;
      const btn = document.getElementById("prixrelatif-btn");
      if (prixRelatifActive) {
        btn.textContent = "Prix relatif : ON";
        btn.classList.add("on");
      } else {
        btn.textContent = "Prix relatif : OFF";
        btn.classList.remove("on");
      }
      updateUI();
    }

    function toggleTaxe() {
      taxeActive = !taxeActive;
      const btn = document.getElementById("bercy-btn");
      if (taxeActive) {
        btn.textContent = "üí∂ Imp√¥t ON";
        btn.classList.remove("off");
        btn.classList.add("on");
      } else {
        btn.textContent = "üí∂ Imp√¥t OFF";
        btn.classList.remove("on");
        btn.classList.add("off");
      }
    }

    // ===== √âV√âNEMENTS AL√âATOIRES =====
    function triggerRandomEvent() {
      if (jeuBloque || !monnaieActive) return;
      
      const phase = getCurrentPhase();
      const availableEvents = randomEvents[phase];
      
      if (availableEvents.length === 0) {
        updateUI("Aucun √©v√©nement disponible pour cette phase");
        return;
      }
      
      const randomIndex = Math.floor(Math.random() * availableEvents.length);
      const selectedEvent = availableEvents[randomIndex];
      const result = selectedEvent.effect();
      
      displayEvent(selectedEvent.title, selectedEvent.description + '\n' + result);
      
      lastEventClick = clicks;
      updateUI(result);
    }

    function displayEvent(title, description) {
      const eventDisplay = document.getElementById('event-display');
      const eventTitle = document.getElementById('event-title');
      const eventDescription = document.getElementById('event-description');
      
      eventTitle.textContent = title;
      eventDescription.textContent = description;
      eventDisplay.style.display = 'block';
      
      setTimeout(function() {
        eventDisplay.style.display = 'none';
      }, 5000);
    }

    function checkRandomEvents() {
      // CORRECTION: √âv√©nements plus fr√©quents selon le plan (tous les 100 clics environ)
      if (monnaieActive && Math.random() < 0.05 && clicks - lastEventClick > 50) {
        const phase = getCurrentPhase();
        const availableEvents = randomEvents[phase].filter(function(event) {
          return clicks >= event.minClicks && Math.random() < event.probability;
        });
        
        if (availableEvents.length > 0) {
          const selectedEvent = availableEvents[0];
          const result = selectedEvent.effect();
          displayEvent(selectedEvent.title, selectedEvent.description + '\n' + result);
          lastEventClick = clicks;
        }
      }
    }

    // ===== FONCTIONS DE TEST =====
    function addMoney() {
      money += 1000;
      updateUI("Test : +1000‚Ç¨");
    }

    function addOneNature() {
      nature += 100;
      updateUI("Test : +100 ressources");
    }

    function addClicks50() {
      clicks += 50;
      updateUI("Test : +50 clics");
    }

    // ===== INTERFACE UTILISATEUR =====
    function updateUI(message = "") {
      // Mise √† jour des valeurs de base
      document.getElementById("nature").textContent = nature;
      document.getElementById("confort").textContent = confort;
      document.getElementById("production").textContent = production;
      document.getElementById("money").textContent = money;
      document.getElementById("clicks").textContent = clicks;
      
      // Gestion du centre commercial automatique
      if (nbCentres > 0 && clicks > centreCommercialLastUsed && clicks % 10 === 0) {
        confort += 10 * nbCentres;
      }
      
      // Mise √† jour du prix si l'indicateur est actif
      if (priceIndicatorActive) {
        document.getElementById("current-price").textContent = calculatePrice();
      }
      
      // Mise √† jour du prix de l'IA
      document.getElementById("ouvrier-btn").textContent = 'ü§ñ Engager une IA (' + prixIA + ' ‚Ç¨)';
      
      // Affichage des informations techniques
      if (techLevel > 0) {
        document.getElementById("tech-level").textContent = 'Niveau tech : ' + techLevel;
        document.getElementById("tech-level").style.display = "block";
        document.getElementById("jauge-tech-container").style.display = "flex";
      }
      
      if (ia > 0) {
        document.getElementById("ia-info").textContent = 'IA actives : ' + ia;
        document.getElementById("ia-info").style.display = "block";
        document.getElementById("prodauto-wrapper").style.display = "flex";
        document.getElementById("jauge-ia-container").style.display = "flex";
      }
      
      if (venteAutoCount > 0) {
        document.getElementById("venteauto-info").textContent = 'Traders auto : ' + venteAutoCount;
        document.getElementById("venteauto-info").style.display = "block";
        document.getElementById("venteauto-wrapper").style.display = "flex";
        document.getElementById("jauge-venteauto-container").style.display = "flex";
      }
      
      if (confortAutoCount > 0) {
        document.getElementById("confortauto-info").textContent = 'Confort auto : ' + confortAutoCount;
        document.getElementById("confortauto-info").style.display = "block";
        document.getElementById("confortauto-wrapper").style.display = "flex";
        document.getElementById("jauge-confortauto-container").style.display = "flex";
      }
      
      if (taxeActivee) {
        document.getElementById("taux-info").textContent = 'Taux d\'int√©r√™t : ' + tauxInteret + '%';
        // CORRECTION: Co√ªt en confort pour la n√©gociation
        const coutNegociation = Math.floor(confort * 0.1 + 10);
        document.getElementById("negocier-cost").textContent = 'Co√ªt : ' + coutNegociation + ' confort';
        
        if (nbNegociations >= maxNegociations) {
          document.getElementById("negocier-btn").classList.remove("active");
          document.getElementById("negocier-btn").style.opacity = "0.3";
        } else {
          document.getElementById("negocier-btn").classList.add("active");
          document.getElementById("negocier-btn").style.opacity = "1";
        }
      }
      
      // Affichage des jauges
      updateJauges();
      
      // V√©rification des d√©verrouillages
      checkUnlocks();
      
      // Gestion des crises et r√©volution
      checkCrises();
      
      // Affichage du message
      if (message) {
        document.getElementById("message").textContent = message;
      }
    }

    function updateJauges() {
      const maxVals = {
        nature: Math.max(3000, nature * 1.2),
        confort: Math.max(100, confort * 1.2),
        money: Math.max(10000, Math.abs(money) * 1.2),
        budget: Math.max(1000, budgetEtat * 1.2),
        taux: 20,
        ia: Math.max(10, ia * 1.2),
        venteauto: Math.max(10, venteAutoCount * 1.2),
        confortauto: Math.max(10, confortAutoCount * 1.2),
        tech: Math.max(10, techLevel * 1.2),
        usines: Math.max(10, nbUsines * 1.2),
        marches: Math.max(10, nbMarches * 1.2),
        centres: Math.max(10, nbCentres * 1.2)
      };
      
      // Jauge des ressources
      const naturePercent = Math.min(100, (nature / maxVals.nature) * 100);
      document.getElementById("jauge-nature").style.width = naturePercent + "%";
      document.getElementById("jauge-nature-txt").textContent = nature;
      
      // Jauge du confort
      if (confort > 0) {
        document.getElementById("jauge-confort-container").style.display = "flex";
        const confortPercent = Math.min(100, (confort / maxVals.confort) * 100);
        document.getElementById("jauge-confort").style.width = confortPercent + "%";
        document.getElementById("jauge-confort-txt").textContent = confort;
      }
      
      // Jauge de l'argent
      if (monnaieActive) {
        const moneyPercent = Math.min(100, (Math.abs(money) / maxVals.money) * 100);
        document.getElementById("jauge-money").style.width = moneyPercent + "%";
        document.getElementById("jauge-money-txt").textContent = money + "‚Ç¨";
      }
      
      // Jauge du budget de l'√âtat
      if (taxeActivee) {
        const budgetPercent = Math.min(100, (budgetEtat / maxVals.budget) * 100);
        document.getElementById("jauge-budget").style.width = budgetPercent + "%";
        document.getElementById("jauge-budget-txt").textContent = budgetEtat + "‚Ç¨";
      }
      
      // Jauge du taux d'int√©r√™t
      if (taxeActivee) {
        const tauxPercent = Math.min(100, (tauxInteret / maxVals.taux) * 100);
        document.getElementById("jauge-taux").style.width = tauxPercent + "%";
        document.getElementById("jauge-taux-txt").textContent = tauxInteret + "%";
      }
      
      // Autres jauges
      if (ia > 0) {
        const iaPercent = Math.min(100, (ia / maxVals.ia) * 100);
        document.getElementById("jauge-ia").style.width = iaPercent + "%";
        document.getElementById("jauge-ia-txt").textContent = ia;
      }
      
      if (venteAutoCount > 0) {
        const ventePercent = Math.min(100, (venteAutoCount / maxVals.venteauto) * 100);
        document.getElementById("jauge-venteauto").style.width = ventePercent + "%";
        document.getElementById("jauge-venteauto-txt").textContent = venteAutoCount;
      }
      
      if (confortAutoCount > 0) {
        const confortAutoPercent = Math.min(100, (confortAutoCount / maxVals.confortauto) * 100);
        document.getElementById("jauge-confortauto").style.width = confortAutoPercent + "%";
        document.getElementById("jauge-confortauto-txt").textContent = confortAutoCount;
      }
      
      if (techLevel > 0) {
        const techPercent = Math.min(100, (techLevel / maxVals.tech) * 100);
        document.getElementById("jauge-tech").style.width = techPercent + "%";
        document.getElementById("jauge-tech-txt").textContent = techLevel;
      }
      
      if (nbUsines > 0) {
        document.getElementById("jauge-usines-container").style.display = "flex";
        const usinesPercent = Math.min(100, (nbUsines / maxVals.usines) * 100);
        document.getElementById("jauge-usines").style.width = usinesPercent + "%";
        document.getElementById("jauge-usines-txt").textContent = nbUsines;
      }
      
      if (nbMarches > 0) {
        document.getElementById("jauge-marches-container").style.display = "flex";
        const marchesPercent = Math.min(100, (nbMarches / maxVals.marches) * 100);
        document.getElementById("jauge-marches").style.width = marchesPercent + "%";
        document.getElementById("jauge-marches-txt").textContent = nbMarches;
      }
      
      if (nbCentres > 0) {
        document.getElementById("jauge-centres-container").style.display = "flex";
        const centresPercent = Math.min(100, (nbCentres / maxVals.centres) * 100);
        document.getElementById("jauge-centres").style.width = centresPercent + "%";
        document.getElementById("jauge-centres-txt").textContent = nbCentres;
      }
    }

    function checkUnlocks() {
      // CORRECTION: Bouton confort - appara√Æt √† 120 clics (au lieu de 180)
      if (monnaieActive && clicks >= 120) {
        document.getElementById("comfort-btn").style.display = "block";
      }
      
      // CORRECTION: Bouton am√©liorer production - appara√Æt √† 600 clics (au lieu de 250)
      if (monnaieActive && clicks >= 600) {
        document.getElementById("upgrade-btn2").style.display = "block";
      }
      
      // CORRECTION: Bouton IA - appara√Æt √† 250 clics et r√©appara√Æt tous les 500 clics
      if (monnaieActive && clicks >= 250 && Math.floor(clicks / 500) > Math.floor(iaLastUsed / 500)) {
        document.getElementById("ouvrier-btn").style.display = "block";
      }
      
      // CORRECTION: Bouton trader - appara√Æt √† 500 clics et r√©appara√Æt tous les 1000 clics
      if (monnaieActive && clicks >= 500 && Math.floor(clicks / 1000) > Math.floor(tradingLastUsed / 1000)) {
        document.getElementById("trading-btn").style.display = "block";
      }
      
      // Usine de production (1500 clics et r√©appara√Æt tous les 1500 suivants)
      if (clicks >= 1500 && Math.floor(clicks / 1500) > Math.floor(factoryLastUsed / 1500)) {
        document.getElementById('factory-btn').classList.remove('hidden');
      }
      
      // March√© de trading (1600 clics et r√©appara√Æt tous les 1600 suivants)
      if (clicks >= 1600 && Math.floor(clicks / 1600) > Math.floor(tradingMarketLastUsed / 1600)) {
        document.getElementById('trading-market-btn').classList.remove('hidden');
      }
      
      // CORRECTION: Centre commercial (1100 clics et r√©appara√Æt tous les 1100 suivants - au lieu de 900)
      if (clicks >= 1100 && Math.floor(clicks / 1100) > Math.floor(centreCommercialLastUsed / 1100)) {
        document.getElementById('centre-commercial-btn').classList.remove('hidden');
      }
      
      // CORRECTION: Achat confort auto (200 clics et r√©appara√Æt tous les 150 clics - au lieu de 180)
      if (monnaieActive && clicks >= 200 && Math.floor((clicks - 200) / 150) >= Math.floor((confortAutoLastUsed - 200) / 150)) {
        document.getElementById('confort-auto-btn').classList.remove('hidden');
      }
      
      // Indicateur de prix (1000 clics et appara√Æt UNE SEULE FOIS)
      if (clicks >= 1000 && !priceIndicatorActive && priceIndicatorLastUsed === 0) {
        document.getElementById('price-indicator-btn').classList.remove('hidden');
      }
      
      // Automatisation compl√®te (750 clics et appara√Æt UNE SEULE FOIS)
      if (clicks >= 750 && !autoClicksActive && autoClicksLastUsed === 0) {
        document.getElementById('auto-clicks-btn').classList.remove('hidden');
      }
    }

    function checkCrises() {
      const criseBox = document.getElementById("alert-crise");
      if (nature < 20) {
        criseBox.style.display = "block";
        criseBox.textContent = "Crise √©cologique : risque sur l'habitabilit√© humaine de la plan√®te ‚Äì perte de confort";
      } else {
        criseBox.style.display = "none";
      }
      
      const ehBox = document.getElementById("eh-msg");
      if (monnaieActive && nature <= 5) {
        ehBox.style.display = "block";
        ehBox.textContent = "Une √©volution est possible : passer √† l'√©conomie hom√©ostatique (EH)";
        document.getElementById("evolution-btn").style.display = "block";
      } else {
        ehBox.style.display = "none";
      }
      
      const socialBox = document.getElementById("social-crise");
      const revolutionBox = document.getElementById("revolution");
      if (confort > 5) criseSocialeActive = true;
      if (criseSocialeActive && !jeuBloque) {
        if (confort > 0 && confort < 5) {
          socialBox.style.display = "block";
          socialBox.textContent = "Crise sociale ‚Äì risque de r√©volution";
        } else {
          socialBox.style.display = "none";
        }
        if (confort === 0) {
          revolutionBox.style.display = "block";
          revolutionBox.textContent = "R√âVOLUTION ‚Äì FIN DE JEU";
          jeuBloque = true;
        } else {
          revolutionBox.style.display = "none";
        }
      } else {
        socialBox.style.display = "none";
        revolutionBox.style.display = "none";
      }
    }

    // ===== INITIALISATION =====
    updateUI("");
  </script>
</body>
</html>
