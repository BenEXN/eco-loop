<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Looop v1.4.0</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      font-family: sans-serif;
      text-align: center;
      background-color: #f3f3f3;
      padding: 20px;
    }
    h1 { font-size: 2em; margin-bottom: 10px; }
    .columns { display: flex; justify-content: center; gap: 2vw; margin: 20px 0 20px 0;}
    .column {
      background: #fff;
      border-radius: 20px;
      box-shadow: 0 6px 30px #0002;
      padding: 32px 30px 28px 30px;
      min-width: 240px;
      max-width: 300px;
      flex: 1 0 0;
      margin: 0 4px;
    }
    .column h2 { font-size: 1.3em; font-weight: bold; margin-bottom: 12px;}
    .column .stock { font-size: 1.1em; margin-bottom: 10px;}
    .actions { margin: 16px 0 0 0;}
    button {
      font-size: 1.1em;
      padding: 10px 22px;
      margin: 8px 0 4px 0;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      transition: background 0.2s;
    }
    button:disabled { background: #eee !important; color: #bbb;}
    .btn-yellow { background: #FFD600; color: #222; font-weight: bold;}
    .btn-blue { background: #2976d9; color: #fff; }
    .btn-grey { background: #888; color: #fff;}
    .btn-green { background: #b3ecb3; color: #125812; }
    .center { text-align: center;}
    .jauges-box {
      border: 1.2px solid #ccc;
      background: #fff;
      border-radius: 10px;
      display: flex; justify-content: center; gap: 28px;
      padding: 12px 12px 4px 12px;
      margin: 22px auto 12px auto;
      width: fit-content;
    }
    .jauge { margin: 0 7px 4px 7px; font-size: 0.97em; color: #444; text-align:center;}
    .jauge span { font-weight: bold; font-family: monospace;}
    .info-box {
      margin: 12px 0 0 0; padding: 8px 10px;
      border-radius: 10px; font-size: 1em;
      font-weight: bold; display: inline-block;
    }
    .info-eco { background: #e3f6fc; color: #1e6185;}
    .info-env { background: #fff3e0; color: #d8730b;}
    .info-soc { background: #ffe4ef; color: #af005b;}
    .produits-card {
      background: #eef2fa;
      border-radius: 12px;
      margin: 12px auto 0 auto;
      padding: 10px 0 6px 0;
      max-width: 160px;
      font-size: 1.07em;
      font-weight: bold;
      box-shadow: 0 2px 8px #ddd;
      border: 1.5px solid #dde1f3;
    }
    #charts-section {
      background: #fff;
      margin: 40px auto 0 auto;
      border-radius: 14px;
      max-width: 800px;
      padding: 24px 6vw 28px 6vw;
      box-shadow: 0 2px 10px #bbb1;
      display: none;
    }
    #charts-section h3 { margin-bottom: 16px;}
    #close-charts-btn {
      margin-top: 16px;
      background: #ccc;
      color: #222;
      font-size: 1em;
    }
    @media (max-width:900px) {
      .columns { flex-direction: column; align-items: center;}
      .column { width: 90vw; max-width: 99vw; margin-bottom: 15px;}
      .jauges-box { flex-direction: column; gap: 6px; width: 95vw;}
    }
    @media (max-width:600px) {
      body { padding: 2px;}
      .columns { gap: 7px;}
      .column { padding: 15px 6vw 13px 6vw;}
      .jauges-box { padding: 8px 2vw 2px 2vw;}
    }
  </style>
</head>
<body>
  <h1>üåç Looop <span id="version">v1.4.0</span></h1>

  <div class="columns">
    <div class="column">
      <h2>ü™¥ Environnement</h2>
      <div class="stock">Ressources‚ÄØ: <span id="nature">300</span></div>
      <div id="env-message" class="info-box info-env" style="display:none"></div>
      <div class="actions">
        <button onclick="produce()" id="produce-btn">üõ†Ô∏è Produire</button>
      </div>
    </div>
    <div class="column">
      <h2>ü§ñ Exosomatisation</h2>
      <div class="stock">Confort‚ÄØ: <span id="confort">0</span></div>
      <div class="produits-card">
        <div>üõí <b>Produits cr√©√©s</b></div>
        <div style="font-size:1.3em;" id="production">0</div>
        <div style="font-size:0.98em;">Niveau technologique‚ÄØ: <span id="tech">0</span></div>
        <div style="font-size:0.95em;">IA‚ÄØ: <span id="ia">0</span></div>
      </div>
      <div class="actions">
        <button onclick="sell()" id="sell-btn">üí∂ Vente</button>
      </div>
    </div>
    <div class="column">
      <h2>üí∂ √âconomie</h2>
      <div class="stock">Monnaie (‚Ç¨)‚ÄØ: <span id="money">10</span></div>
      <div id="eco-message" class="info-box info-eco" style="display:none"></div>
      <div id="credit1500-zone"></div>
      <div id="credit2000-zone"></div>
      <div id="evolution-zone"></div>
      <div class="actions" id="don-action"></div>
    </div>
  </div>

  <div class="jauges-box" id="jauges-box">
    <div class="jauge">Ressources‚ÄØ: <span id="jauge-nature">300</span></div>
    <div class="jauge">Confort‚ÄØ: <span id="jauge-confort">0</span></div>
    <div class="jauge">Monnaie‚ÄØ: <span id="jauge-money">10</span></div>
    <div class="jauge">IA‚ÄØ: <span id="jauge-ia">0</span></div>
    <div class="jauge">Technologie‚ÄØ: <span id="jauge-tech">0</span></div>
    <div class="jauge">Produits‚ÄØ: <span id="jauge-prod">0</span></div>
  </div>

  <div class="center" style="margin:24px 0 10px 0;">
    <b id="actions-label">Clics/actions</b>‚ÄØ: <span id="clicks">0</span>
  </div>

  <div style="margin:28px 0 0 0; text-align:left; border-top:2px solid #111; padding-top:12px; max-width:1024px; margin-left:auto; margin-right:auto;">
    <div style="margin-bottom:8px; font-weight:normal; color:#333; font-size:1.08em;">triche</div>
    <button class="btn-yellow" onclick="addMoney()">+1000 cr√©dits (test)</button>
    <button class="btn-yellow" onclick="addResource()">+1 ressource</button>
    <button class="btn-yellow" onclick="addClicks50()">+50 clics</button>
    <button class="btn-grey" onclick="undoClick()">‚Ü©Ô∏è Annuler le clic pr√©c√©dent</button>
  </div>

  <div class="center" style="margin: 38px 0 28px 0;">
    <button class="btn-blue" onclick="showCharts()">Voir mon profil (radar et √©volution)</button>
    <button class="btn-green" onclick="exportCSV()">Exporter ma partie (CSV)</button>
  </div>

  <!-- SECTION GRAPHIQUES -->
  <div id="charts-section">
    <h3>Profil de la partie</h3>
    <canvas id="radarChart" width="330" height="220"></canvas>
    <div style="margin:18px 0 12px 0;"></div>
    <canvas id="lineChart" width="600" height="300"></canvas>
    <br>
    <button id="close-charts-btn" onclick="closeCharts()">Fermer</button>
  </div>

<script>
let nature = 300, confort = 0, money = 10, clicks = 0, production = 0, tech = 0, ia = 0;
let prodCost = 5, upgradeUsed1 = false, upgradeUsed2 = false, jeuBloque = false;
let historique = [];
let previousState = null;
const jauges = () => {
  document.getElementById("jauge-nature").textContent = nature;
  document.getElementById("jauge-confort").textContent = confort;
  document.getElementById("jauge-money").textContent = money;
  document.getElementById("jauge-ia").textContent = ia;
  document.getElementById("jauge-tech").textContent = tech;
  document.getElementById("jauge-prod").textContent = production;
};
function enregistrer() {
  historique.push({
    clic: clicks,
    ressources: nature,
    confort: confort,
    monnaie: money,
    ia: ia,
    technologie: tech,
    production: production
  });
}
function updateUI(messageEnv="", messageEco="") {
  document.getElementById("nature").textContent = nature;
  document.getElementById("confort").textContent = confort;
  document.getElementById("production").textContent = production;
  document.getElementById("money").textContent = money;
  document.getElementById("tech").textContent = tech;
  document.getElementById("ia").textContent = ia;
  document.getElementById("clicks").textContent = clicks;
  jauges();

  // Messages √©cologie et √©conomie dans leur colonne
  let envMsg = document.getElementById("env-message");
  let ecoMsg = document.getElementById("eco-message");
  envMsg.style.display = messageEnv ? "block" : "none";
  envMsg.innerHTML = messageEnv;
  ecoMsg.style.display = messageEco ? "block" : "none";
  ecoMsg.innerHTML = messageEco;

  // Gestion affichage/cr√©dit/√©volution
  let credit1500 = document.getElementById("credit1500-zone");
  let credit2000 = document.getElementById("credit2000-zone");
  let evolutionZ = document.getElementById("evolution-zone");
  let donAction = document.getElementById("don-action");

  // Affichage cr√©dit 1500 √† 100 clics
  credit1500.innerHTML = "";
  if (clicks >= 100 && !upgradeUsed1) {
    credit1500.innerHTML = `<button class="btn-yellow" onclick="upgradeProd1()">‚≠ê Am√©liorer la production (1‚ÄØ500‚ÄØ‚Ç¨)</button>`;
  }
  // Affichage cr√©dit 2000 √† 101 clics (si pas d√©j√† utilis√©)
  credit2000.innerHTML = "";
  if (clicks >= 101 && !upgradeUsed2) {
    let dis = money < 2000 ? 'disabled' : '';
    credit2000.innerHTML = `<button class="btn-blue" onclick="upgradeProd2()" ${dis}>üí† Am√©liorer la production (2‚ÄØ000‚ÄØ‚Ç¨)</button>`;
  }
  // √âvolution √©conomique si ressources ‚â§ 5
  evolutionZ.innerHTML = "";
  if (nature <= 5) {
    evolutionZ.innerHTML = `<button class="btn-grey" onclick="evolution()">üå± √âvolution √©conomique</button>`;
  }
  // Bouton ‚ÄúRecevoir mon don‚Äù si monnaie = 10 (d√©but)
  donAction.innerHTML = "";
  if (clicks === 0 && money === 10) {
    donAction.innerHTML = `<button class="btn-green" onclick="recevoirDon()">Recevoir mon don</button>`;
    document.getElementById("produce-btn").disabled = true;
  } else {
    document.getElementById("produce-btn").disabled = false;
  }
  // D√©sactivation production si ressources trop faibles
  document.getElementById("produce-btn").disabled = jeuBloque || (nature < prodCost) || (clicks === 0 && money === 10);
  document.getElementById("sell-btn").disabled = jeuBloque || (production < 1);
}
function recevoirDon() {
  money += 20;
  updateUI("", "");
}
function produce() {
  if (jeuBloque) return;
  saveState();
  if (nature >= prodCost && (money >= 1 || upgradeUsed1 || upgradeUsed2)) {
    nature -= prodCost; production += 1; money -= 1; clicks++;
    if (nature < 0) nature = 0;
    if (nature < 20 && nature > 5) {
      if (clicks % 3 === 0) {
        confort = Math.floor(confort / 2);
        updateUI("Crise √©cologique‚ÄØ: risque sur l'habitabilit√© humaine de la plan√®te ‚Äì perte de confort", "");
      } else {
        updateUI("Crise √©cologique‚ÄØ: risque sur l'habitabilit√© humaine de la plan√®te ‚Äì perte de confort", "");
      }
    } else if (nature <= 5) {
      updateUI("", "Une √©volution est possible‚ÄØ: passer √† l‚Äô√©conomie hom√©ostatique (EH)");
    } else {
      updateUI("", "");
    }
    enregistrer();
  } else if (nature < prodCost) {
    updateUI("Plus assez de ressources‚ÄØ!", "");
  } else {
    updateUI("Pas assez de monnaie ou de ressources‚ÄØ!", "");
  }
  checkCriseSoc();
}
function sell() {
  if (jeuBloque) return;
  saveState();
  if (production >= 1) {
    production--; money += 2; confort++;
    clicks++;
    enregistrer();
    updateUI();
  }
  checkCriseSoc();
}
function upgradeProd1() {
  if (jeuBloque || upgradeUsed1) return;
  saveState();
  money -= 1500; prodCost = 4; upgradeUsed1 = true; tech++; updateUI("", "");
  enregistrer();
}
function upgradeProd2() {
  if (jeuBloque || upgradeUsed2 || money < 2000) return;
  saveState();
  money -= 2000; prodCost = 3; upgradeUsed2 = true; tech++; updateUI("", "");
  enregistrer();
}
function evolution() {
  updateUI("", "<b>‚ö° Passage √† l‚Äô√©conomie hom√©ostatique‚ÄØ: nouvelle phase √† venir‚ÄØ!</b>");
  enregistrer();
}
function addMoney() { saveState(); money += 1000; clicks++; updateUI("", ""); enregistrer();}
function addResource() { saveState(); nature += 1; clicks++; updateUI("", ""); enregistrer();}
function addClicks50() { saveState(); clicks += 50; updateUI("", ""); enregistrer();}
function undoClick() {
  if (!previousState) return;
  nature = previousState.nature; confort = previousState.confort; money = previousState.money;
  clicks = previousState.clicks; production = previousState.production; tech = previousState.tech;
  ia = previousState.ia; upgradeUsed1 = previousState.upgradeUsed1; upgradeUsed2 = previousState.upgradeUsed2; jeuBloque = previousState.jeuBloque;
  historique.pop();
  updateUI("", "");
}
function saveState() {
  previousState = {
    nature, confort, money, clicks, production, tech, ia, upgradeUsed1, upgradeUsed2, jeuBloque
  };
}
function checkCriseSoc() {
  // Crise sociale
  let socMsg = document.getElementById("env-message");
  if (confort < 5 && confort > 0) {
    socMsg.style.display = "block";
    socMsg.className = "info-box info-soc";
    socMsg.innerHTML = "Crise sociale‚ÄØ: risque de r√©volution";
  }
  if (confort <= 0) {
    socMsg.style.display = "block";
    socMsg.className = "info-box info-soc";
    socMsg.innerHTML = "<b>R√âVOLUTION ‚Äì FIN DE JEU</b>";
    jeuBloque = true;
    document.getElementById("produce-btn").disabled = true;
    document.getElementById("sell-btn").disabled = true;
    document.getElementById("credit1500-zone").innerHTML = "";
    document.getElementById("credit2000-zone").innerHTML = "";
    document.getElementById("evolution-zone").innerHTML = "";
  }
}
function showCharts() {
  document.getElementById("charts-section").style.display = "block";
  // Profil final radar
  let d = historique.length > 0 ? historique[historique.length-1] : {ressources:nature, confort, monnaie:money, ia, technologie:tech, production};
  let labels = ["Ressources", "Confort", "Monnaie", "IA", "Technologie", "Production"];
  let values = [d.ressources, d.confort, d.monnaie, d.ia, d.technologie, d.production];
  // Radar chart
  let ctxRadar = document.getElementById('radarChart').getContext('2d');
  if(window.radarChartObj){window.radarChartObj.destroy();}
  window.radarChartObj = new Chart(ctxRadar, {
    type: 'radar',
    data: { labels: labels, datasets: [{
      label: "Profil final",
      data: values,
      fill: true,
      backgroundColor: 'rgba(46,155,214,0.11)',
      borderColor: 'rgba(21,81,190,0.91)',
      pointBackgroundColor: 'rgba(24,65,192,1)'
    }]},
    options: { responsive: false, scales: { r: { angleLines: { display: true }, suggestedMin: 0, suggestedMax: Math.max(...values, 30) }}}
  });
  // Evolution dans le temps (lignes)
  let ctxLine = document.getElementById('lineChart').getContext('2d');
  let x = historique.map(h=>h.clic);
  let ds = k=>({ label:k, data:historique.map(h=>h[k]), fill:false, tension:0.12, borderWidth:2});
  if(window.lineChartObj){window.lineChartObj.destroy();}
  window.lineChartObj = new Chart(ctxLine, {
    type: 'line',
    data: {
      labels: x,
      datasets: [
        {...ds("ressources"), borderColor:"#1976d2", backgroundColor:"#e3f2fd"},
        {...ds("confort"), borderColor:"#388e3c", backgroundColor:"#e8f5e9"},
        {...ds("monnaie"), borderColor:"#ffa000", backgroundColor:"#fff8e1"},
        {...ds("ia"), borderColor:"#b71c1c", backgroundColor:"#ffebee"},
        {...ds("technologie"), borderColor:"#512da8", backgroundColor:"#ede7f6"},
        {...ds("production"), borderColor:"#607d8b", backgroundColor:"#eceff1"}
      ]
    },
    options: { responsive: false, scales: { x: { title:{display:true, text:"Clic/action"}}, y: {beginAtZero:true} } }
  });
}
function closeCharts() {
  document.getElementById("charts-section").style.display = "none";
}
function exportCSV() {
  let csv = "clics,ressources,confort,monnaie,ia,technologie,production\n";
  historique.forEach(row=>{
    csv += [row.clic, row.ressources, row.confort, row.monnaie, row.ia, row.technologie, row.production].join(",")+"\n";
  });
  let blob = new Blob([csv],{type:'text/csv'});
  let a = document.createElement('a');
  a.href = URL.createObjectURL(blob);
  a.download = "looop_data.csv";
  a.click();
}
updateUI();
</script>
</body>
</html>
