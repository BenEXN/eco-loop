<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Looop v1.12.1 ‚Äì U+Events</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body { background: #f3f3f3; font-family: sans-serif; margin:0; padding:0; }
    h1 { text-align: center; margin: 25px 0 10px; }
    .container { display: flex; justify-content: center; align-items: flex-start; margin: 0 auto 18px auto; max-width: 950px; gap: 24px;}
    .category { background: #fff; border-radius: 18px; box-shadow: 0 4px 24px #0001; flex: 1; padding: 32px 18px 18px 18px; margin: 0 6px; min-width: 250px; max-width: 320px; min-height: 250px; display: flex; flex-direction: column; align-items: center;}
    .cat-title { font-size: 1.25em; margin-bottom: 20px; font-weight: bold; letter-spacing: 1px;}
    .stock { font-size: 1.1em; margin-bottom: 10px;}
    .products-box { background: #f7f7fa; border: 2px solid #dde1eb; border-radius: 10px; color: #333; margin-bottom: 10px; padding: 10px 28px; font-size: 1.2em; font-weight: bold; letter-spacing: 1px; box-shadow: 0 1px 4px #ddd5; min-width: 110px; text-align: center;}
    .message-box { border-radius: 10px; margin: 8px 0 14px 0; padding: 11px 14px 11px 14px; font-weight: bold; font-size: 1.08em; box-shadow: 0 1px 4px #0002; text-align: center; min-width: 130px; max-width: 260px; word-break: break-word; line-height: 1.25em;}
    .msg-orange { background: #ffe9cf; color: #d2691e; border: 2px solid #f5c387;}
    .msg-blue { background: #e7f4ff; color: #0978c6; border: 2px solid #7cc8fa;}
    .msg-red { background: #ffe3e3; color: #c00; border: 2px solid #e48888;}
    .msg-brown { background: #fff4d6; color: #be8c00; border: 2px solid #e2c071;}
    .msg-purple { background: #f3e5f5; color: #7b1fa2; border: 2px solid #ce93d8;}
    .msg-green { background: #e8f5e8; color: #2e7d32; border: 2px solid #81c784;}
    .btn-row { margin: 18px 0 0 0;}
    button { font-size: 1em; padding: 10px 18px; margin: 5px 0; border-radius: 14px; border: none; background: #ededed; color: #111; cursor: pointer; transition: background 0.2s;}
    button:disabled { opacity: 0.5; background: #ededed; color: #bbb; cursor: not-allowed;}
    .btn-prodauto { background: #094075; color: #fff; font-weight: bold; border-radius: 8px;}
    .btn-prodauto.on { background: #094075; color: #fff; }
    .btn-venteauto { background: #f9c9e6; color: #a52b74; font-weight: bold; margin-right: 10px; border-radius: 8px;}
    .btn-venteauto.on { background: #ea6bbd; color: #fff;}
    .btn-trading { background: #ededed; color: #111; font-weight: normal; border: none; border-radius: 14px; font-size: 1.08em; padding: 10px 18px; margin: 5px 0; cursor: pointer; box-shadow: 0 1px 2px #0001; transition: background 0.2s; display: inline-block;}
    .btn-trading:disabled { background: #ededed; color: #bbb; cursor: not-allowed;}
    .btn-primary { background: #2976d9; color: #fff; font-weight: bold; }
    .btn-yellow { background: #FFD600; color: #222; font-weight: bold;}
    .btn-green  { background: #4fd860; color: #fff; font-weight: bold;}
    .btn-annuler { background: #aaa; color: #fff; }
    .debug-row { margin: 0 0 32px 0; display: flex; justify-content: center; gap: 10px;}
    .message { font-weight: bold; min-height: 24px; margin: 10px 0;}
    #prodauto-row { width:100%; display:flex; justify-content: center; align-items: center; gap:12px; margin: 26px 0 18px 0;}
    #prodauto-wrapper, #venteauto-wrapper, #prixrelatif-wrapper { display: flex; }
    @media (max-width: 900px) { #prodauto-row { margin: 16px 0 10px 0;} }
    #clics-container { text-align: center; margin: 25px 0 0 0; font-size: 1.2em; font-weight: bold; color: #333;}
    #revolution { color: #b10000; font-size: 1.1em; text-transform: uppercase;}
    #tech-level, #ia-info { font-size:1em; color:#2980b9; margin-bottom: 0; font-weight: normal;}
    #venteauto-info { font-size: 1.03em; color: #ea6bbd; margin: 2px 0 0 0; font-weight: normal;}
    #triche-sep { border: none; border-top: 3px solid #222; margin: 38px auto 12px auto; width: 94vw; max-width: 1000px;}
    #triche-label { text-align: left; font-size:1.13em; font-weight:normal; letter-spacing:1px; margin: 0 0 12px 0; color:#111; width: 95vw; max-width: 1000px; margin-left: auto; margin-right: auto;}
    #don-btn { margin-top: 10px; background: #FFD600; color: #222; font-weight: bold; border: none; border-radius: 8px; font-size: 1.1em; padding: 14px 20px; box-shadow: 0 1px 8px #fffdbe99;}
    .jauge-bottom-barre { margin: 0 auto 6px auto; display: flex; flex-direction: row; align-items: center; gap: 8px; max-width: 600px;}
    .jauge-bottom-label { min-width: 70px; font-size: .99em; color: #888; text-align: right;}
    .jauge-bottom-bar { background: #eee; border-radius: 8px; height: 13px; flex: 1; overflow: hidden; position: relative;}
    .jauge-bottom-fill { height: 100%; border-radius: 8px; transition: width 0.19s;}
    #jauge-nature { background: #86e08e;}
    #jauge-confort { background: #86b6ea;}
    #jauge-money { background: #ffb3b3;}
    #jauge-ia { background: #094075;}
    #jauge-tech { background: #ba9afc;}
    #jauge-venteauto { background: #fd90d9;}
    #jauge-taux { background: #9b59b6;}
    #jauge-budget { background: #f9e79f;}
    #jauge-usines { background: #ff5722;}
    #jauge-marches { background: #795548;}
    .btn-bercy { background: #f39c12; color: #fff; font-weight: bold; border-radius: 8px; margin-left: 10px; padding: 6px 12px; font-size: 0.9em;}
    .btn-bercy.on { background: #f39c12; color: #fff; }
    .btn-bercy.off { background: #bdc3c7; color: #7f8c8d; }
    .btn-negocier { background: #9b59b6; color: #fff; font-weight: bold; border-radius: 8px; opacity: 0.6; font-size: 1em; position: relative;}
    .btn-negocier.active { background: #9b59b6; color: #fff; opacity: 1;}
    #negocier-cost { display: block; font-size: 0.89em; opacity: 0.82; line-height: 1.1em; font-weight: normal; color: #e4d9fa;}
    #taux-info { font-size: 1.03em; color: #9b59b6; margin: 2px 0 0 0; font-weight: normal;}
    .jauge-bottom-val { font-size: .97em; color: #666; min-width: 60px; text-align: left; padding-left: 4px; }
    
    /* Nouvelles fonctionnalit√©s */
    .btn-factory { background: #ff5722; color: #fff; font-weight: bold; border-radius: 8px;}
    .btn-trading-market { background: #795548; color: #fff; font-weight: bold; border-radius: 8px;}
    .btn-price-indicator { background: #607d8b; color: #fff; font-weight: bold; border-radius: 8px;}
    .btn-auto-clicks { background: #9c27b0; color: #fff; font-weight: bold; border-radius: 8px;}
    .btn-prixrelatif { background: #607d8b; color: #fff; font-weight: bold; border-radius: 8px;}
    .btn-prixrelatif.on { background: #607d8b; color: #fff; }
    
    .price-indicator { background: #f7f7fa; border: 2px solid #dde1eb; border-radius: 10px; padding: 10px; margin: 10px 0; text-align: center;}
    .hidden { display: none; }
    
    /* √âv√©nements al√©atoires */
    #event-display { position: fixed; top: 20px; right: 20px; max-width: 300px; z-index: 1000; background: rgba(255,255,255,0.95); border-radius: 10px; padding: 15px; box-shadow: 0 4px 20px rgba(0,0,0,0.3); border-left: 5px solid #ff6b35; display: none; animation: slideIn 0.5s ease;}
    @keyframes slideIn { from { transform: translateX(100%); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
    #event-title { font-weight: bold; color: #333; margin-bottom: 8px; font-size: 1.1em;}
    #event-description { color: #666; font-size: 0.95em; line-height: 1.3;}
    
    @media (max-width: 700px) {
      .container { flex-direction: column; align-items: stretch; gap: 12px;}
      .category { max-width: none; min-width: 0; margin: 0 0 20px 0; padding: 18px 10px 12px 10px;}
      .products-box, .message-box { min-width: 0; font-size: 1.04em; padding: 8px 4px;}
      #clics-container { font-size: 1.05em;}
      button { width: 96%; max-width: 340px; font-size: 1em; margin-left: auto; margin-right: auto;}
      .debug-row { flex-direction: column; gap: 6px;}
      #triche-label { font-size:1em; margin-left: 4vw;}
      h1 { font-size: 1.16em;}
      .jauge-bottom-barre { max-width: 98vw; }
      .jauge-bottom-label, .jauge-bottom-val { font-size: 0.91em; }
      #prodauto-row { flex-direction:column; gap:8px;}
      #event-display { position: static; max-width: none; margin: 10px; }
    }
  </style>
</head>
<body>
  <!-- CHANGELOG TEXTUEL - √âL√âMENTS √Ä INT√âGRER -->
  <!-- 
  ===== CHANGELOG LOOOP v1.12.1 - √âV√âNEMENTS AL√âATOIRES =====
  
  √âV√âNEMENTS √Ä CODER (indiquer OK quand fait):
  [ ] 1. Panne informatique - ralentit production temporairement
  [ ] 2. Gr√®ve du personnel - arr√™t fonction temporaire
  [ ] 3. Audit surprise - perte monnaie/ralentissement
  [ ] 4. Prime exceptionnelle - gain monnaie ponctuel
  [ ] 5. Rupture de stock - impossible produire X tours
  [ ] 6. Gr√®ve g√©n√©rale - bloque actions 10 secondes
  [ ] 7. Embauche talentueuse - production +20% temporaire
  [ ] 8. Faillite fournisseur - prix item augmente
  [ ] 9. Fuite informations - co√ªt actions augment√©
  [ ] 10. Piratage informatique - perte monnaie
  [ ] 11. Subvention publique - bonus monnaie/production
  [ ] 12. Contr√¥le fiscal - perte monnaie/blocage
  [ ] 13. March√© de niche - ventes augment√©es
  [ ] 14. Concurrent - baisse production/ventes
  [ ] 15. Scandale m√©diatique - perte capital social
  [ ] 16. Pub virale - bonus production/ventes
  [ ] 17. D√©mission employ√©-cl√© - perte production
  [ ] 18. Bug logiciel - ralentissement automatisations
  [ ] 19. Ru√©e clients - ventes doubl√©es X temps
  [ ] 20. Panne √©lectricit√© - tout s'arr√™te X secondes
  [ ] 21. Investisseur providentiel - gros bonus argent
  [ ] 22. Proc√®s justice - perte monnaie
  [ ] 23. D√©part retraite - perte employ√©s temporaire
  [ ] 24. Innovation externe - nouvel item disponible
  [ ] 25. Crash boursier - perte valeur mon√©taire
  [ ] 26. Taux int√©r√™t hausse - co√ªt cr√©dit augment√©
  [ ] 27. Inflation/d√©flation - variation prix
  [ ] 28. Demande export - ventes augment√©es
  [ ] 29. March√© satur√© - ventes impossibles
  [ ] 30. Gr√®ve transporteurs - blocage ressource
  [ ] 31. R√©compense employeur - bonus social/mon√©taire
  [ ] 32. Rumeur produit d√©fectueux - ventes ralenties
  [ ] 33. Hackathon r√©ussi - bonus production
  [ ] 34. Recrutement √©clair - employ√© temporaire
  [ ] 35. Bug compta - gain/perte al√©atoire
  [ ] 36. Perte donn√©es clients - amende
  [ ] 37. Panne serveur - automatisations pause
  [ ] 38. Succ√®s viral - pic ventes
  [ ] 39. D√©tournement interne - perte monnaie
  [ ] 40. Commande annul√©e - perte production
  [ ] 41. Gr√®ve managers - actions sp√©ciales impossibles
  [ ] 42. Rachat concurrent - bonus + fonctionnalit√©
  [ ] 43. Nouvel imp√¥t - taxe r√©guli√®re
  [ ] 44. Fusion entreprise - synergies +10% production
  [ ] 45. Appel offre remport√© - gros bonus monnaie
  [ ] 46. Perte brevet - co√ªt production augment√©
  [ ] 47. Rumeurs licenciements - baisse moral
  [ ] 48. √âpid√©mie - ralentissement absent√©isme
  [ ] 49. Surcharge travail - efficacit√© diminu√©e
  [ ] 50. Oubli √©ch√©ance - p√©nalit√© bancaire
  [ ] 51. Nouvelle r√©glementation - co√ªt mise conformit√©
  [ ] 52. Coup de g√©nie salari√© - astuce production+
  [ ] 53. Fuite cerveau - perte bonus temporaire
  [ ] 54. Candidatures spontan√©es - recrutement facilit√©
  [ ] 55. D√©tournement fonds - grosse perte monnaie
  [ ] 56. Arnaque commande - perte produits/argent
  [ ] 57. Gr√®ve SAV - baisse capital social
  [ ] 58. P√©nurie mat√©riel - co√ªt/production impact√©s
  [ ] 59. Inflation salaires - co√ªt employ√©s augmente
  [ ] 60. Erreur inventaire - gain/perte ressources
  
  SYST√àME √âV√âNEMENTS:
  [ ] D√©clenchement selon phases (0-500, 500-3000, 3000-8000, 8000+)
  [ ] Fr√©quence adaptative (rare au d√©but, fr√©quent en endgame)
  [ ] Effets temporaires et permanents
  [ ] Interface d'affichage √©v√©nements
  [ ] Cumul d'effets possibles
  [ ] √âv√©nements de crise majeure
  
  =============================================================
  -->

  <!-- Affichage des √©v√©nements al√©atoires -->
  <div id="event-display">
    <div id="event-title"></div>
    <div id="event-description"></div>
  </div>

  <h1>üåç Looop <span style="font-size:0.7em;color:#777;">v1.12.1+Events</span></h1>
  <div class="container">
    <div class="category">
      <div class="cat-title">üå± Environnement</div>
      <div class="stock">Ressources : <span id="nature">300</span></div>
      <div id="alert-crise" class="message-box msg-orange" style="display:none;"></div>
      <div class="btn-row">
        <button id="produce-btn" onclick="produce()">üõ†Ô∏è Produire</button>
      </div>
    </div>
    <div class="category">
      <div class="cat-title">ü§ñ Exosomatisation</div>
      <div class="stock">Confort : <span id="confort">0</span></div>
      <div class="products-box">
        Produits cr√©√©s<br>
        <span id="production">0</span>
      </div>
      <div class="stock" id="tech-level"></div>
      <div class="stock" id="ia-info"></div>
      <div id="venteauto-info"></div>
      <div id="social-crise" class="message-box msg-brown" style="display:none;"></div>
      <div class="btn-row">
        <button id="sell-btn" onclick="sell()">üí∂ Vente</button>
      </div>
    </div>
    <div class="category">
      <div class="cat-title">üí∂ √âconomie</div>
      <div class="stock" id="money-row" style="display:none;">
        Monnaie (‚Ç¨) : <span id="money">10</span>
      </div>
      <div id="taux-info" style="display:none;"></div>
      
      <!-- Indicateur de prix -->
      <div id="price-indicator" class="price-indicator hidden">
        <strong>üìä Prix: <span id="current-price">0</span>‚Ç¨/unit√© de production</strong>
      </div>
      
      <button id="don-btn" onclick="receiveDon()">Recevoir mon don</button>
      <div id="eh-msg" class="message-box msg-blue" style="display:none;"></div>
      <div class="btn-row">
        <button id="ouvrier-btn" onclick="acheterIA()">ü§ñ Engager une IA (500 ‚Ç¨)</button>
        <button id="trading-btn" class="btn-trading" onclick="acheterTrader()">üè™ Acheter un trader auto (1000 ‚Ç¨)</button>
        <button id="upgrade-btn2" onclick="upgradeProd2()">üí† Am√©liorer la production (2 000 ‚Ç¨)</button>
        
        <!-- Nouvelles fonctionnalit√©s -->
        <button id="factory-btn" class="btn-factory hidden" onclick="acheterUsine()">üè≠ Usine de Production (√ó10) - 20 000 ‚Ç¨</button>
        <button id="trading-market-btn" class="btn-trading-market hidden" onclick="acheterMarcheTrading()">üìà March√© de Trading (√ó10 vente) - 20 000 ‚Ç¨</button>
        <button id="price-indicator-btn" class="btn-price-indicator hidden" onclick="acheterIndicateurPrix()">üìä Indicateur de Prix - 30 000 ‚Ç¨</button>
        <button id="auto-clicks-btn" class="btn-auto-clicks hidden" onclick="acheterAutoClicks()">‚öôÔ∏è Les automatismes comptent comme des clics - 10 000 ‚Ç¨</button>
        
        <button id="negocier-btn" class="btn-negocier" onclick="negocierTaux()" style="display:none;">
          üìâ N√©gocier son taux d'int√©r√™t
          <span id="negocier-cost"></span>
        </button>
        <button id="evolution-btn" onclick="evolution()" style="display:none;">üå± √âvolution √©conomique</button>
      </div>
    </div>
  </div>
  
  <div id="prodauto-row">
    <div id="venteauto-wrapper" style="display:none;">
      <button id="venteauto-btn" class="btn-venteauto">Vente auto : ON</button>
    </div>
    <div id="prodauto-wrapper" style="display:none;">
      <button id="prodauto-btn" class="btn-prodauto on">Production auto : ON</button>
    </div>
    <div id="prixrelatif-wrapper" style="display:none;">
      <button id="prixrelatif-btn" class="btn-prixrelatif on">Prix relatif : ON</button>
    </div>
  </div>
  
  <div style="margin: 0 auto 14px auto; max-width:620px;">
    <div class="jauge-bottom-barre">
      <div class="jauge-bottom-label">üå± Ressources</div>
      <div class="jauge-bottom-bar"><div class="jauge-bottom-fill" id="jauge-nature"></div></div>
      <div class="jauge-bottom-val" id="jauge-nature-txt"></div>
    </div>
    <div class="jauge-bottom-barre" id="jauge-confort-container" style="display:none;">
      <div class="jauge-bottom-label">ü§ñ Confort</div>
      <div class="jauge-bottom-bar"><div class="jauge-bottom-fill" id="jauge-confort"></div></div>
      <div class="jauge-bottom-val" id="jauge-confort-txt"></div>
    </div>
    <div class="jauge-bottom-barre" id="jauge-money-container" style="display:none;">
      <div class="jauge-bottom-label">üí∂ Monnaie</div>
      <div class="jauge-bottom-bar"><div class="jauge-bottom-fill" id="jauge-money"></div></div>
      <div class="jauge-bottom-val" id="jauge-money-txt"></div>
    </div>
    <div class="jauge-bottom-barre" id="jauge-budget-container" style="display:none;">
      <div class="jauge-bottom-label">üí∂ Budget √âtat</div>
      <div class="jauge-bottom-bar"><div class="jauge-bottom-fill" id="jauge-budget"></div></div>
      <div class="jauge-bottom-val" id="jauge-budget-txt"></div>
      <button id="bercy-btn" class="btn-bercy on">üí∂ Imp√¥t ON</button>
    </div>
    <div class="jauge-bottom-barre" id="jauge-taux-container" style="display:none;">
      <div class="jauge-bottom-label">üìâ Taux int√©r√™t</div>
      <div class="jauge-bottom-bar"><div class="jauge-bottom-fill" id="jauge-taux"></div></div>
      <div class="jauge-bottom-val" id="jauge-taux-txt"></div>
    </div>
    <div class="jauge-bottom-barre" id="jauge-ia-container" style="display:none;">
      <div class="jauge-bottom-label">ü§ñ IA</div>
      <div class="jauge-bottom-bar"><div class="jauge-bottom-fill" id="jauge-ia"></div></div>
      <div class="jauge-bottom-val" id="jauge-ia-txt"></div>
    </div>
    <div class="jauge-bottom-barre" id="jauge-venteauto-container" style="display:none;">
      <div class="jauge-bottom-label">üè™ Vente auto</div>
      <div class="jauge-bottom-bar"><div class="jauge-bottom-fill" id="jauge-venteauto"></div></div>
      <div class="jauge-bottom-val" id="jauge-venteauto-txt"></div>
    </div>
    <div class="jauge-bottom-barre" id="jauge-tech-container" style="display:none;">
      <div class="jauge-bottom-label">üß™ Technologie</div>
      <div class="jauge-bottom-bar"><div class="jauge-bottom-fill" id="jauge-tech"></div></div>
      <div class="jauge-bottom-val" id="jauge-tech-txt"></div>
    </div>
    <div class="jauge-bottom-barre" id="jauge-usines-container" style="display:none;">
      <div class="jauge-bottom-label">üè≠ Usines</div>
      <div class="jauge-bottom-bar"><div class="jauge-bottom-fill" id="jauge-usines"></div></div>
      <div class="jauge-bottom-val" id="jauge-usines-txt"></div>
    </div>
    <div class="jauge-bottom-barre" id="jauge-marches-container" style="display:none;">
      <div class="jauge-bottom-label">üìà March√©s</div>
      <div class="jauge-bottom-bar"><div class="jauge-bottom-fill" id="jauge-marches"></div></div>
      <div class="jauge-bottom-val" id="jauge-marches-txt"></div>
    </div>
  </div>
  
  <div id="revolution" class="message-box msg-red" style="display:none;"></div>
  <div class="message" id="message"></div>
  <div id="clics-container">Clics/actions : <span id="clicks">0</span></div>
  <hr id="triche-sep">
  <div id="triche-label">Triche</div>
  <div class="debug-row">
    <button class="btn-yellow" id="test-btn" onclick="addMoney()">+1000 cr√©dits (test)</button>
    <button class="btn-yellow" id="plus1-btn" onclick="addOneNature()">+100 ressources (test)</button>
    <button class="btn-yellow" id="test-clics-btn" onclick="addClicks50()">Clics +50 (test)</button>
    <button class="btn-yellow" id="test-event-btn" onclick="triggerRandomEvent()">D√©clencher √©v√©nement (test)</button>
    <button class="btn-annuler" id="undo-btn" onclick="undoAction()">‚è™ Annuler le clic pr√©c√©dent</button>
  </div>
  
  <script>
    // Variables globales existantes
    let nature = 3000, confort = 0, production = 0, money = 10, clicks = 0;
    let prodCost = 5, techLevel = 0;
    let upgradeCount = 0;
    let upgradeAvailable = false;
    let lastUpgradePalier = 0;
    let lastCrisisResource = 20, criseSocialeActive = false, jeuBloque = false, lastState = null;
    let monnaieActive = false;
    let ia = 0, prixIA = 500;
    let iaProdTimer = null, iaProdOn = true;
    let venteAutoActive = true;
    let venteAutoCount = 0;
    let venteAutoTimers = [];
    let tauxInteret = 5;
    let clicksEnDette = 0;
    let premierPrelevement = false;
    let nbNegociations = 0;
    let lastNegociationClick = 0;
    const maxNegociations = 4, delaiNegociation = 200;
    let budgetEtat = 0;
    let taxeActive = true;
    let clicksTaxe = 0;
    let taxeActivee = false;
    let productionMultiplier = 1;
    let salesMultiplier = 1;
    let factoryLastUsed = 0;
    let tradingMarketLastUsed = 0;
    let priceIndicatorLastUsed = 0;
    let autoClicksLastUsed = 0;
    let priceIndicatorActive = false;
    let autoClicksActive = false;
    let prixRelatifActive = true;
    let nbUsines = 0;
    let nbMarches = 0;

    // ===== NOUVELLES VARIABLES POUR √âV√âNEMENTS AL√âATOIRES =====
    let lastEventClick = 0;
    let activeEvents = []; // √âv√©nements actifs avec effets temporaires
    let eventCooldowns = {}; // Cooldowns pour √©viter la r√©p√©tition d'√©v√©nements
    let eventModifiers = {
      productionBonus: 1, // Multiplicateur de production temporaire
      salesBonus: 1, // Multiplicateur de vente temporaire
      costPenalty: 1, // Multiplicateur de co√ªt temporaire
      automationBlocked: false, // Blocage des automatisations
      actionsBlocked: false, // Blocage total des actions
      productionBlocked: false, // Blocage production sp√©cifique
      salesBlocked: false // Blocage vente sp√©cifique
    };

    // Base de donn√©es des √©v√©nements al√©atoires
    const randomEvents = {
      // PHASE 1: 0-500 clics - √âv√©nements rares et plut√¥t positifs
      phase1: [
        {
          id: 'prime_exceptionnelle',
          title: 'üí∞ Prime exceptionnelle',
          description: 'Votre √©quipe re√ßoit une prime inattendue !',
          probability: 0.05,
          minClicks: 100,
          effect: () => {
            const bonus = Math.floor(money * 0.1 + 200);
            money += bonus;
            return `+${bonus}‚Ç¨ de prime re√ßue !`;
          }
        },
        {
          id: 'ruee_clients',
          title: 'üèÉ‚Äç‚ôÇÔ∏è Ru√©e de clients',
          description: 'Vos produits sont tr√®s demand√©s aujourd\'hui !',
          probability: 0.04,
          minClicks: 150,
          duration: 30000, // 30 secondes
          effect: () => {
            eventModifiers.salesBonus = 2;
            setTimeout(() => { eventModifiers.salesBonus = 1; }, 30000);
            return 'Ventes doubl√©es pendant 30 secondes !';
          }
        },
        {
          id: 'recrutement_eclair',
          title: '‚ö° Recrutement √©clair',
          description: 'Un candidat exceptionnel rejoint votre √©quipe !',
          probability: 0.03,
          minClicks: 200,
          duration: 60000, // 1 minute
          effect: () => {
            eventModifiers.productionBonus = 1.3;
            setTimeout(() => { eventModifiers.productionBonus = 1; }, 60000);
            return 'Production +30% pendant 1 minute !';
          }
        }
      ],

      // PHASE 2: 500-3000 clics - √âv√©nements de difficult√© progressive
      phase2: [
        {
          id: 'panne_informatique',
          title: 'üíª Panne informatique',
          description: 'Vos syst√®mes ralentissent √† cause d\'un bug.',
          probability: 0.08,
          minClicks: 500,
          duration: 45000, // 45 secondes
          effect: () => {
            eventModifiers.productionBonus = 0.7;
            setTimeout(() => { eventModifiers.productionBonus = 1; }, 45000);
            return 'Production ralentie de 30% pendant 45 secondes.';
          }
        },
        {
          id: 'greve_personnel',
          title: '‚úä Gr√®ve du personnel',
          description: 'Les employ√©s font gr√®ve pour de meilleures conditions.',
          probability: 0.06,
          minClicks: 600,
          duration: 20000, // 20 secondes
          effect: () => {
            eventModifiers.automationBlocked = true;
            setTimeout(() => { eventModifiers.automationBlocked = false; }, 20000);
            return 'Automatisations bloqu√©es pendant 20 secondes !';
          }
        },
        {
          id: 'audit_surprise',
          title: 'üìã Audit surprise',
          description: 'Un audit inattendu perturbe vos activit√©s.',
          probability: 0.07,
          minClicks: 750,
          effect: () => {
            const perte = Math.floor(Math.abs(money) * 0.15 + 100);
            money -= perte;
            confort = Math.max(0, confort - 2);
            return `Audit: -${perte}‚Ç¨ et -2 confort`;
          }
        },
        {
          id: 'rupture_stock',
          title: 'üì¶ Rupture de stock',
          description: 'Probl√®me d\'approvisionnement de vos fournisseurs.',
          probability: 0.05,
          minClicks: 800,
          duration: 30000, // 30 secondes
          effect: () => {
            eventModifiers.productionBlocked = true;
            setTimeout(() => { eventModifiers.productionBlocked = false; }, 30000);
            return 'Production impossible pendant 30 secondes !';
          }
        },
        {
          id: 'embauche_talentueuse',
          title: 'üåü Embauche talentueuse',
          description: 'Un expert rejoint temporairement votre √©quipe.',
          probability: 0.04,
          minClicks: 1000,
          duration: 120000, // 2 minutes
          effect: () => {
            eventModifiers.productionBonus = 1.5;
            setTimeout(() => { eventModifiers.productionBonus = 1; }, 120000);
            return 'Production +50% pendant 2 minutes !';
          }
        },
        {
          id: 'bug_logiciel',
          title: 'üêõ Bug logiciel',
          description: 'Un bug ralentit vos automatisations.',
          probability: 0.06,
          minClicks: 1200,
          duration: 60000, // 1 minute
          effect: () => {
            // Ralentit les timers d'automatisation (simulation)
            if (iaProdTimer) {
              clearInterval(iaProdTimer);
              manageIAProduction(10000); // Timer plus lent
              setTimeout(() => manageIAProduction(), 60000);
            }
            return 'Automatisations ralenties pendant 1 minute.';
          }
        },
        {
          id: 'controle_fiscal',
          title: 'üèõÔ∏è Contr√¥le fiscal',
          description: 'L\'administration v√©rifie vos comptes.',
          probability: 0.05,
          minClicks: 1500,
          effect: () => {
            const amende = Math.floor(Math.abs(money) * 0.2 + 300);
            money -= amende;
            budgetEtat += Math.floor(amende * 0.8);
            return `Contr√¥le fiscal: -${amende}‚Ç¨ d'amende`;
          }
        }
      ],

      // PHASE 3: 3000-8000 clics - √âv√©nements puissants et r√©guliers
      phase3: [
        {
          id: 'greve_generale',
          title: 'üö´ Gr√®ve g√©n√©rale',
          description: 'Toutes les activit√©s sont bloqu√©es !',
          probability: 0.1,
          minClicks: 3000,
          duration: 15000, // 15 secondes
          effect: () => {
            eventModifiers.actionsBlocked = true;
            setTimeout(() => { eventModifiers.actionsBlocked = false; }, 15000);
            return 'TOUTES LES ACTIONS BLOQU√âES pendant 15 secondes !';
          }
        },
        {
          id: 'piratage_informatique',
          title: 'üè¥‚Äç‚ò†Ô∏è Piratage informatique',
          description: 'Des hackers s\'attaquent √† vos syst√®mes !',
          probability: 0.08,
          minClicks: 3500,
          effect: () => {
            const vol = Math.floor(Math.abs(money) * 0.25 + 500);
            money -= vol;
            techLevel = Math.max(0, techLevel - 1);
            return `Piratage: -${vol}‚Ç¨ vol√©s et -1 niveau tech`;
          }
        },
        {
          id: 'subvention_publique',
          title: 'üèõÔ∏è Subvention publique',
          description: 'L\'√âtat vous accorde une aide financi√®re !',
          probability: 0.06,
          minClicks: 4000,
          effect: () => {
            const aide = Math.floor(Math.abs(money) * 0.3 + 1000);
            money += aide;
            nature += 50;
            return `Subvention: +${aide}‚Ç¨ et +50 ressources`;
          }
        },
        {
          id: 'marche_niche',
          title: 'üéØ March√© de niche d√©couvert',
          description: 'Vous d√©couvrez un nouveau segment rentable !',
          probability: 0.05,
          minClicks: 4500,
          duration: 90000, // 1.5 minutes
          effect: () => {
            eventModifiers.salesBonus = 2.5;
            setTimeout(() => { eventModifiers.salesBonus = 1; }, 90000);
            return 'Ventes √ó2.5 pendant 1m30 !';
          }
        },
        {
          id: 'concurrent_agressif',
          title: '‚öîÔ∏è Concurrent agressif',
          description: 'Un concurrent vous fait une guerre des prix !',
          probability: 0.09,
          minClicks: 5000,
          duration: 120000, // 2 minutes
          effect: () => {
            eventModifiers.salesBonus = 0.6;
            eventModifiers.productionBonus = 0.8;
            setTimeout(() => {
              eventModifiers.salesBonus = 1;
              eventModifiers.productionBonus = 1;
            }, 120000);
            return 'Ventes -40% et production -20% pendant 2 minutes';
          }
        },
        {
          id: 'fusion_entreprise',
          title: 'ü§ù Fusion d\'entreprise',
          description: 'Vous fusionnez avec un partenaire strat√©gique !',
          probability: 0.04,
          minClicks: 6000,
          duration: 180000, // 3 minutes
          effect: () => {
            eventModifiers.productionBonus = 1.8;
            eventModifiers.salesBonus = 1.4;
            money += 2000;
            setTimeout(() => {
              eventModifiers.productionBonus = 1;
              eventModifiers.salesBonus = 1;
            }, 180000);
            return 'Fusion: +2000‚Ç¨, production √ó1.8 et ventes √ó1.4 pendant 3 min !';
          }
        },
        {
          id: 'crash_boursier',
          title: 'üìâ Crash boursier',
          description: 'Les march√©s s\'effondrent !',
          probability: 0.07,
          minClicks: 6500,
          effect: () => {
            const perte = Math.floor(Math.abs(money) * 0.4);
            money -= perte;
            tauxInteret = Math.min(20, tauxInteret + 3);
            return `Crash: -${perte}‚Ç¨ et taux d'int√©r√™t +3%`;
          }
        }
      ],

      // PHASE 4: 8000+ clics - √âv√©nements extr√™mes et fr√©quents
      phase4: [
        {
          id: 'revolution_technologique',
          title: 'üöÄ R√©volution technologique',
          description: 'Une innovation bouleverse votre secteur !',
          probability: 0.12,
          minClicks: 8000,
          effect: () => {
            techLevel += 5;
            productionMultiplier *= 2;
            money += 5000;
            return 'R√âVOLUTION TECH: +5 niveaux, production √ó2, +5000‚Ç¨ !';
          }
        },
        {
          id: 'crise_systemique',
          title: 'üí• Crise syst√©mique',
          description: 'Une crise majeure frappe l\'√©conomie !',
          probability: 0.1,
          minClicks: 9000,
          duration: 60000, // 1 minute
          effect: () => {
            const perte = Math.floor(Math.abs(money) * 0.5);
            money -= perte;
            eventModifiers.productionBonus = 0.3;
            eventModifiers.salesBonus = 0.2;
            setTimeout(() => {
              eventModifiers.productionBonus = 1;
              eventModifiers.salesBonus = 1;
            }, 60000);
            return `CRISE: -${perte}‚Ç¨, production -70%, ventes -80% pendant 1 min`;
          }
        },
        {
          id: 'monopole_temporaire',
          title: 'üëë Monopole temporaire',
          description: 'Vous dominez temporairement le march√© !',
          probability: 0.06,
          minClicks: 10000,
          duration: 45000, // 45 secondes
          effect: () => {
            eventModifiers.salesBonus = 5;
            eventModifiers.productionBonus = 3;
            setTimeout(() => {
              eventModifiers.salesBonus = 1;
              eventModifiers.productionBonus = 1;
            }, 45000);
            return 'MONOPOLE: ventes √ó5 et production √ó3 pendant 45s !';
          }
        },
        {
          id: 'effondrement_concurrent',
          title: 'üíÄ Effondrement concurrent',
          description: 'Votre principal concurrent fait faillite !',
          probability: 0.08,
          minClicks: 12000,
          effect: () => {
            salesMultiplier *= 1.5;
            money += 10000;
            nbMarches += 1;
            return 'Concurrent √©limin√©: ventes √ó1.5 permanentes, +10000‚Ç¨, +1 march√© !';
          }
        }
      ]
    };

    // ===== FONCTIONS POUR √âV√âNEMENTS AL√âATOIRES =====
    
    function getCurrentPhase() {
      if (clicks < 500) return 'phase1';
      if (clicks < 3000) return 'phase2';
      if (clicks < 8000) return 'phase3';
      return 'phase4';
    }

    function getEventFrequency() {
      if (clicks < 500) return 150; // Tr√®s rare
      if (clicks < 3000) return 80; // Rare
      if (clicks < 8000) return 40; // R√©gulier
      return 20; // Tr√®s fr√©quent
    }

    function shouldTriggerEvent() {
      const frequency = getEventFrequency();
      return (clicks - lastEventClick) >= frequency && Math.random() < 0.3;
    }

    function triggerRandomEvent() {
      if (jeuBloque || !monnaieActive) return;
      
      const phase = getCurrentPhase();
      const availableEvents = randomEvents[phase];
      
      // Filtrer les √©v√©nements disponibles
      const validEvents = availableEvents.filter(event => {
        return clicks >= event.minClicks && 
               !eventCooldowns[event.id] && 
               Math.random() < event.probability;
      });

      if (validEvents.length === 0) return;

      // S√©lectionner un √©v√©nement al√©atoire
      const selectedEvent = validEvents[Math.floor(Math.random() * validEvents.length)];
      
      // Appliquer l'effet
      const result = selectedEvent.effect();
      
      // Afficher l'√©v√©nement
      displayEvent(selectedEvent.title, selectedEvent.description + '\n' + result);
      
      // Mettre en cooldown (√©vite la r√©p√©tition imm√©diate)
      eventCooldowns[selectedEvent.id] = true;
      setTimeout(() => {
        delete eventCooldowns[selectedEvent.id];
      }, 60000); // 1 minute de cooldown
      
      lastEventClick = clicks;
      updateUI(result);
    }

    function displayEvent(title, description) {
      const eventDisplay = document.getElementById('event-display');
      const eventTitle = document.getElementById('event-title');
      const eventDescription = document.getElementById('event-description');
      
      eventTitle.textContent = title;
      eventDescription.textContent = description;
      eventDisplay.style.display = 'block';
      
      // Masquer apr√®s 5 secondes
      setTimeout(() => {
        eventDisplay.style.display = 'none';
      }, 5000);
    }

    function checkRandomEvents() {
      if (shouldTriggerEvent()) {
        triggerRandomEvent();
      }
    }

    // ===== FONCTIONS EXISTANTES MODIFI√âES =====

    function calculatePrice() {
      if (!prixRelatifActive || nature === 0) return 0;
      return Math.ceil(Math.abs(money) / nature);
    }

    function checkUnlocks() {
      // Usine de production (1500 clics et r√©appara√Æt tous les 1500 suivants)
      if (clicks >= 1500 && Math.floor(clicks / 1500) > Math.floor(factoryLastUsed / 1500)) {
        document.getElementById('factory-btn').classList.remove('hidden');
      }
      
      // March√© de trading (1600 clics et r√©appara√Æt tous les 1600 suivants)
      if (clicks >= 1600 && Math.floor(clicks / 1600) > Math.floor(tradingMarketLastUsed / 1600)) {
        document.getElementById('trading-market-btn').classList.remove('hidden');
      }
      
      document.getElementById("message").textContent = message;
      
      const criseBox = document.getElementById("alert-crise");
      if (nature < 20) {
        criseBox.style.display = "block";
        criseBox.textContent = "Crise √©cologique : risque sur l'habitabilit√© humaine de la plan√®te ‚Äì perte de confort";
      } else {
        criseBox.style.display = "none";
      }
      
      const ehBox = document.getElementById("eh-msg");
      if (monnaieActive && nature <= 5) {
        ehBox.style.display = "block";
        ehBox.textContent = "Une √©volution est possible : passer √† l'√©conomie hom√©ostatique (EH)";
      } else {
        ehBox.style.display = "none";
      }
      
      const socialBox = document.getElementById("social-crise");
      const revolutionBox = document.getElementById("revolution");
      if (confort > 5) criseSocialeActive = true;
      if (criseSocialeActive && !jeuBloque) {
        if (confort > 0 && confort < 5) {
          socialBox.style.display = "block";
          socialBox.textContent = "Crise sociale ‚Äì risque de r√©volution";
        } else {
          socialBox.style.display = "none";
        }
        if (confort === 0) {
          revolutionBox.style.display = "block";
          revolutionBox.textContent = "R√âVOLUTION ‚Äì FIN DE JEU";
          jeuBloque = true;
        } else {
          revolutionBox.style.display = "none";
        }
      } else {
        socialBox.style.display = "none";
        revolutionBox.style.display = "none";
      } (1000 clics et appara√Æt UNE SEULE FOIS)
      if (clicks >= 1000 && !priceIndicatorActive && priceIndicatorLastUsed === 0) {
        document.getElementById('price-indicator-btn').classList.remove('hidden');
      }
      
      // Automatisation compl√®te (750 clics et appara√Æt UNE SEULE FOIS)
      if (clicks >= 750 && !autoClicksActive && autoClicksLastUsed === 0) {
        document.getElementById('auto-clicks-btn').classList.remove('hidden');
      }
    }

    // Nouvelles fonctions d'achat modifi√©es pour prendre en compte les √©v√©nements
    function acheterUsine() {
      if (jeuBloque || !monnaieActive || eventModifiers.actionsBlocked) return;
      saveState();
      money -= 20000;
      productionMultiplier *= 10;
      nbUsines += 1;
      factoryLastUsed = clicks;
      document.getElementById('factory-btn').classList.add('hidden');
      gererInterets();
      updateUI("Usine de production achet√©e ! Production √ó10" + (money < 0 ? " (√† cr√©dit)" : ""));
    }

    function acheterMarcheTrading() {
      if (jeuBloque || !monnaieActive || eventModifiers.actionsBlocked) return;
      saveState();
      money -= 20000;
      salesMultiplier *= 10;
      nbMarches += 1;
      tradingMarketLastUsed = clicks;
      document.getElementById('trading-market-btn').classList.add('hidden');
      gererInterets();
      updateUI("March√© de trading achet√© ! Ventes √ó10" + (money < 0 ? " (√† cr√©dit)" : ""));
    }

    function acheterIndicateurPrix() {
      if (jeuBloque || !monnaieActive || eventModifiers.actionsBlocked) return;
      saveState();
      money -= 30000;
      priceIndicatorActive = true;
      priceIndicatorLastUsed = clicks;
      document.getElementById('price-indicator-btn').classList.add('hidden');
      document.getElementById('price-indicator').classList.remove('hidden');
      document.getElementById('prixrelatif-wrapper').style.display = 'flex';
      gererInterets();
      updateUI("Indicateur de prix achet√© !" + (money < 0 ? " (√† cr√©dit)" : ""));
    }

    function acheterAutoClicks() {
      if (jeuBloque || !monnaieActive || eventModifiers.actionsBlocked) return;
      saveState();
      money -= 10000;
      autoClicksActive = true;
      autoClicksLastUsed = clicks;
      document.getElementById('auto-clicks-btn').classList.add('hidden');
      gererInterets();
      updateUI("Automatisation compl√®te activ√©e !" + (money < 0 ? " (√† cr√©dit)" : ""));
    }
