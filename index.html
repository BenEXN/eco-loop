<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Looop v1.11.0 ‚Äì Usines, March√©, Indicateur, Cubes</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    /* ... Toutes tes r√®gles CSS pr√©c√©dentes ... */
    /* Ajout du cadre pour les cubes */
    #cube-zone {
      min-height: 130px; min-width: 320px;
      background: #fafafa;
      border: 2px dashed #ddd;
      border-radius: 14px;
      margin: 16px auto 6px auto;
      display: flex; flex-wrap: wrap; gap: 12px; justify-content: flex-start; align-items: flex-end;
      padding: 12px;
      max-width: 480px;
    }
    .cube {
      width: 40px; height: 40px;
      background: #eee;
      border: 2px solid #ccc;
      border-radius: 8px;
      margin: 4px;
      display: flex; align-items: center; justify-content: center;
      font-weight: bold;
      font-size: 1.18em;
      box-shadow: 0 2px 4px #0001;
      cursor: pointer;
      transition: background 0.23s;
    }
    .cube.selected { border: 3px solid #333; }
    .color-picker {
      display: flex; gap: 7px; margin: 10px 0 10px 0;
    }
    .color-swatch {
      width: 24px; height: 24px; border-radius: 4px; border: 2px solid #999; cursor: pointer;
    }
    .color-swatch.selected { border: 2px solid #222; box-shadow: 0 0 6px #2223; }
    #placer-btn { margin-left: 16px; }
  </style>
</head>
<body>
<!-- ... tout le reste de l'UI pr√©c√©dent, puis ins√®re ici (dans la colonne √©conomie par ex) ... -->
  <div id="cube-zone"></div>
  <div id="cube-controls" style="display:none;">
    <div id="color-picker-container" style="display:none;">
      <span>Changer la couleur du dernier cube : </span>
      <div class="color-picker" id="color-picker">
        <!-- swatches ins√©r√©s par JS -->
      </div>
    </div>
    <button id="placer-btn" style="display:none;">Placer le dernier cube</button>
  </div>
<!-- ... le reste ... -->

<script>
/* -----------------------------------------
   1. Variables pour nouveaux boutons/√©tats
----------------------------------------- */
let productionX10 = false, venteX10 = false, indicateurPrisActive = false, autoClicsActive = false;
let prochainPalierProd = 1500, prochainPalierVente = 1600, prochainPalierIndicateur = 1000, prochainPalierAuto = 750;

// CUBES : liste des cubes [{color:..., x:..., y:...}]
let cubes = [];
let ventes = 0; // Total ventes pour cube-couleur
let prochainCubeConfort = 100, prochainCubeVente = 100, prochainCubeMoney = 1000; // paliers
let couleursDisponibles = ['#eee','#87cefa','#f88379','#85e085','#ffe473','#cfcfcf','#ffd700','#cc99ff','#fca3cc','#d2691e','#e60026'];
let lastPlacedCubeIdx = -1;

// Ajout d'un bouton triche pour ventes
function addCubeTricheBtn() {
  if (!document.getElementById("triche-ventes-btn")) {
    let debugRow = document.querySelector('.debug-row');
    let btn = document.createElement("button");
    btn.className = "btn-yellow";
    btn.id = "triche-ventes-btn";
    btn.textContent = "+50 ventes (test)";
    btn.onclick = function() { ventes += 50; checkCubeFeatures(); };
    debugRow.appendChild(btn);
  }
}
addCubeTricheBtn();

/* -----------------------------------------
   2. Boutons √©conomiques dynamiques
----------------------------------------- */
// Place dans la rubrique √©conomie (ajout dyn. apr√®s DOMLoaded)
function addEcoBtn(id, txt, cb) {
  let row = document.querySelector(".category:nth-child(3) .btn-row");
  if (!document.getElementById(id)) {
    let b = document.createElement("button");
    b.id = id; b.className = "btn-green";
    b.textContent = txt;
    b.onclick = cb;
    row.appendChild(b);
  }
}
function removeEcoBtn(id) {
  let b = document.getElementById(id); if (b) b.remove();
}

// Callbacks pour chaque bouton
function acheterUsineProd() {
  if (money >= 20000 && clicks >= prochainPalierProd) {
    money -= 20000; productionX10 = true;
    updateUI("Usine de production activ√©e : production √ó10‚ÄØ!");
    removeEcoBtn("btn-usine-prod");
    prochainPalierProd += 1500;
  }
}
function acheterMarcheTrading() {
  if (money >= 20000 && clicks >= prochainPalierVente) {
    money -= 20000; venteX10 = true;
    updateUI("March√© trading activ√© : vente √ó10‚ÄØ!");
    removeEcoBtn("btn-marche-trading");
    prochainPalierVente += 1600;
  }
}
function acheterIndicateurPrix() {
  if (money >= 30000 && clicks >= prochainPalierIndicateur) {
    money -= 30000; indicateurPrisActive = true;
    updateUI("Indicateur de prix activ√© !");
    removeEcoBtn("btn-indicateur-prix");
    prochainPalierIndicateur += 1000;
  }
}
function acheterAutoClics() {
  if (money >= 10000 && clicks >= prochainPalierAuto) {
    money -= 10000; autoClicsActive = true;
    updateUI("Automatismes : les ventes/prod auto sont maintenant compt√©es comme clics.");
    removeEcoBtn("btn-auto-clics");
    prochainPalierAuto += 750;
  }
}

/* -----------------------------------------
   3. CUBES ‚Äì gestion et affichage
----------------------------------------- */
function ajouterCube(couleur="#eee") {
  cubes.push({color: couleur, x: null, y: null});
  renderCubes();
}
function changerCouleurDernierCube(newColor) {
  if (cubes.length > 0) {
    cubes[cubes.length-1].color = newColor;
    renderCubes();
  }
}
function placerDernierCube() {
  // Pour l‚Äôinstant, simule juste "placer" sur une nouvelle ligne
  if (cubes.length > 0) {
    // Animation simple : d√©placer √† droite, puis retour d√©but si trop large
    let zone = document.getElementById('cube-zone');
    let count = zone.children.length;
    let cubeDiv = zone.children[cubes.length-1];
    if (cubeDiv) { cubeDiv.style.order = count; }
    lastPlacedCubeIdx = cubes.length-1;
    renderCubes();
  }
}
function renderCubes() {
  let zone = document.getElementById('cube-zone');
  zone.innerHTML = '';
  cubes.forEach((cube,i)=>{
    let c = document.createElement('div');
    c.className = "cube" + (i===lastPlacedCubeIdx ? " selected":"");
    c.style.background = cube.color;
    c.textContent = "";
    zone.appendChild(c);
  });
}

/* -----------------------------------------
   4. V√©rif paliers cubes et boutons sp√©ciaux
----------------------------------------- */
function checkCubeFeatures() {
  // 100 confort : cube
  if (confort >= prochainCubeConfort) {
    ajouterCube();
    prochainCubeConfort += 100;
  }
  // 100 ventes : autorise couleur
  if (ventes >= prochainCubeVente && cubes.length > 0) {
    document.getElementById("color-picker-container").style.display = "block";
    prochainCubeVente += 100;
  } else {
    document.getElementById("color-picker-container").style.display = "none";
  }
  // 1000 monnaie : placer cube
  if (Math.abs(money) >= prochainCubeMoney && cubes.length > 0) {
    document.getElementById("placer-btn").style.display = "inline-block";
    prochainCubeMoney += 1000;
  } else {
    document.getElementById("placer-btn").style.display = "none";
  }
}

/* -----------------------------------------
   5. Surcouches sur les anciennes fonctions de base
----------------------------------------- */
// Surcharge les fonctions d'UI, production et vente pour int√©grer les nouveaut√©s

let _oldUpdateUI = updateUI;
updateUI = function(message="") {
  // (1) Ajout/masquage des boutons dynamiques
  if (clicks >= prochainPalierProd && !productionX10) addEcoBtn("btn-usine-prod","üè≠ Usine de production √ó10 (20‚ÄØ000‚ÄØ‚Ç¨)",acheterUsineProd); else removeEcoBtn("btn-usine-prod");
  if (clicks >= prochainPalierVente && !venteX10) addEcoBtn("btn-marche-trading","üíπ March√© trading √ó10 (20‚ÄØ000‚ÄØ‚Ç¨)",acheterMarcheTrading); else removeEcoBtn("btn-marche-trading");
  if (clicks >= prochainPalierIndicateur && !indicateurPrisActive) addEcoBtn("btn-indicateur-prix","üí≤ Indicateur de prix (30‚ÄØ000‚ÄØ‚Ç¨)",acheterIndicateurPrix); else removeEcoBtn("btn-indicateur-prix");
  if (clicks >= prochainPalierAuto && !autoClicsActive) addEcoBtn("btn-auto-clics","‚è© Automatisation (10‚ÄØ000‚ÄØ‚Ç¨)",acheterAutoClics); else removeEcoBtn("btn-auto-clics");
  _oldUpdateUI(message);
  checkCubeFeatures();
  renderCubes();
  // Affichage de l'indicateur de prix
  if (indicateurPrisActive) {
    let prix = Math.ceil(Math.abs(money)/(nature || 1));
    if (!document.getElementById("indicateur-prix")) {
      let row = document.querySelector(".category:nth-child(3)");
      let d = document.createElement("div");
      d.id = "indicateur-prix";
      d.innerHTML = `<b>Indicateur de prix : </b>${prix}‚ÄØ‚Ç¨/ressource`;
      row.appendChild(d);
    } else {
      document.getElementById("indicateur-prix").innerHTML = `<b>Indicateur de prix : </b>${prix}‚ÄØ‚Ç¨/ressource`;
    }
  } else if(document.getElementById("indicateur-prix")) {
    document.getElementById("indicateur-prix").remove();
  }
};

/* --------- Surcharge production/vente --------- */
let _oldProduce = produce;
produce = function() {
  let multi = productionX10 ? 10 : 1;
  for(let i=0;i<multi;i++) _oldProduce();
  if(autoClicsActive && ia>0) clicks += multi;
};
let _oldSell = sell;
sell = function() {
  let multi = venteX10 ? 10 : 1;
  for(let i=0;i<multi;i++) {_oldSell(); ventes++;}
  if(autoClicsActive && venteAutoCount>0) clicks += multi;
  checkCubeFeatures();
};

/* --------- Event listeners pour color picker et placer btn --------- */
document.addEventListener('DOMContentLoaded', function() {
  // Cr√©e dynamiquement la palette
  let cpick = document.getElementById("color-picker");
  couleursDisponibles.forEach(c=>{
    let sw = document.createElement("div");
    sw.className = "color-swatch";
    sw.style.background = c;
    sw.onclick = function(){ changerCouleurDernierCube(c); };
    cpick.appendChild(sw);
  });
  document.getElementById("placer-btn").onclick = placerDernierCube;
});

</script>
</body>
</html>
