<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Looop v1.26.0 â€“ Ã‰vÃ©nements alÃ©atoires</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body { background: #f3f3f3; font-family: sans-serif; margin:0; padding:0; }
    h1 { text-align: center; margin: 25px 0 10px; }
    .container { display: flex; justify-content: center; align-items: flex-start; margin: 0 auto 18px auto; max-width: 950px; gap: 24px;}
    .category { background: #fff; border-radius: 18px; box-shadow: 0 4px 24px #0001; flex: 1; padding: 32px 18px 18px 18px; margin: 0 6px; min-width: 250px; max-width: 320px; min-height: 250px; display: flex; flex-direction: column; align-items: center;}
    .cat-title { font-size: 1.25em; margin-bottom: 20px; font-weight: bold; letter-spacing: 1px;}
    .stock { font-size: 1.1em; margin-bottom: 10px;}
    .products-box { background: #f7f7fa; border: 2px solid #dde1eb; border-radius: 10px; color: #333; margin-bottom: 10px; padding: 10px 28px; font-size: 1.2em; font-weight: bold; letter-spacing: 1px; box-shadow: 0 1px 4px #ddd5; min-width: 110px; text-align: center;}
    .message-box { border-radius: 10px; margin: 8px 0 14px 0; padding: 11px 14px 11px 14px; font-weight: bold; font-size: 1.08em; box-shadow: 0 1px 4px #0002; text-align: center; min-width: 130px; max-width: 260px; word-break: break-word; line-height: 1.25em;}
    .msg-orange { background: #ffe9cf; color: #d2691e; border: 2px solid #f5c387;}
    .msg-blue { background: #e7f4ff; color: #0978c6; border: 2px solid #7cc8fa;}
    .msg-red { background: #ffe3e3; color: #c00; border: 2px solid #e48888;}
    .msg-brown { background: #fff4d6; color: #be8c00; border: 2px solid #e2c071;}
    .msg-green { background: #e8f5e8; color: #2e7d32; border: 2px solid #81c784;}
    .msg-purple { background: #f3e5f5; color: #7b1fa2; border: 2px solid #ba68c8;}
    .btn-row { margin: 18px 0 0 0;}
    button { font-size: 1em; padding: 10px 18px; margin: 5px 0; border-radius: 14px; border: none; background: #ededed; color: #111; cursor: pointer; transition: background 0.2s;}
    .btn-yellow { background: #FFD600; color: #222; font-weight: bold;}
    .btn-annuler { background: #aaa; color: #fff; }
    .btn-credit { background: #ff6b35; color: #fff; font-weight: bold;}
    .btn-evolution { background: #4CAF50; color: #fff; font-weight: bold;}
    .debug-row { margin: 0 0 32px 0; display: flex; justify-content: center; gap: 10px;}
    .message { font-weight: bold; min-height: 24px; margin: 10px 0;}
    #clics-container { text-align: center; margin: 25px 0 0 0; font-size: 1.2em; font-weight: bold; color: #333;}
    #don-btn { margin-top: 10px; background: #FFD600; color: #222; font-weight: bold; border: none; border-radius: 8px; font-size: 1.1em; padding: 14px 20px;}
    #triche-sep { border: none; border-top: 3px solid #222; margin: 38px auto 12px auto; width: 94vw; max-width: 1000px;}
    #triche-label { text-align: left; font-size:1.13em; font-weight:normal; letter-spacing:1px; margin: 0 0 12px 0; color:#111; width: 95vw; max-width: 1000px; margin-left: auto; margin-right: auto;}
    .automatisms-controls { margin: 15px auto 15px auto; max-width: 950px; display: none; justify-content: center; gap: 20px; flex-wrap: wrap; padding: 15px; background: #fff; border-radius: 12px; box-shadow: 0 2px 12px #0001;}
    .control-btn { font-size: 0.9em; padding: 8px 12px; border-radius: 8px; border: none; cursor: pointer; transition: all 0.2s; min-width: 80px;}
    .control-btn.active { background: #4CAF50; color: white; }
    .control-btn.inactive { background: #f44336; color: white; }
    .control-btn.disabled { background: #ccc; color: #888; cursor: not-allowed; }
    .jauge-bottom-barre { margin: 0 auto 6px auto; display: flex; flex-direction: row; align-items: center; gap: 8px; max-width: 600px;}
    .jauge-bottom-label { min-width: 70px; font-size: .99em; color: #888; text-align: right;}
    .jauge-bottom-bar { background: #eee; border-radius: 8px; height: 13px; flex: 1; overflow: hidden; position: relative;}
    .jauge-bottom-fill { height: 100%; border-radius: 8px; transition: width 0.19s;}
    #jauge-nature { background: #86e08e;}
    #jauge-confort { background: #86b6ea;}
    #jauge-money { background: #ffb3b3;}
    #jauge-achat-auto { background: #ffa726;}
    #jauge-ia { background: #ab47bc;}
    #jauge-trader { background: #26c6da;}
    #jauge-centre { background: #66bb6a;}
    #jauge-budget-etat { background: #ff9800;}
    #jauge-tech { background: #9c27b0;}
    .hidden { display: none; }
    /* Ã‰vÃ©nements */
    #event-display { margin: 20px auto; max-width: 600px; padding: 0 20px; text-align: center;}
  </style>
</head>
<body>
  <h1>ğŸŒ Looop <span style="font-size:0.7em;color:#777;">v1.26.0 avec Ã‰vÃ©nements AlÃ©atoires</span></h1>
  
  <div id="event-display">
    <div id="event-message" class="message-box" style="display: none;"></div>
  </div>
  <div class="automatisms-controls" id="automatisms-controls">
    <button class="control-btn disabled" id="control-ia" onclick="toggleAutomatism('ia')">ğŸ¤– IA: OFF</button>
    <button class="control-btn disabled" id="control-trader" onclick="toggleAutomatism('trader')">ğŸ’° Trader: OFF</button>
    <button class="control-btn disabled" id="control-confort" onclick="toggleAutomatism('confort')">ğŸ›‹ï¸ Confort: OFF</button>
    <button class="control-btn disabled" id="control-centre" onclick="toggleAutomatism('centre')">ğŸ¬ Centre: OFF</button>
  </div>
  <div class="container">
    <div class="category">
      <div class="cat-title">ğŸŒ± Environnement</div>
      <div class="stock">Ressources : <span id="nature">3000</span></div>
      <div id="alert-crise" class="message-box msg-orange" style="display:none;"></div>
      <div class="btn-row">
        <button id="produce-btn" onclick="produce()">ğŸ› ï¸ Produire</button>
      </div>
    </div>
    <div class="category">
      <div class="cat-title">ğŸ¤– Exosomatisation</div>
      <div class="stock">Confort : <span id="confort">0</span></div>
      <div class="products-box">
        Produits crÃ©Ã©s<br>
        <span id="production">0</span>
      </div>
      <div id="social-crise" class="message-box msg-brown" style="display:none;"></div>
      <div class="btn-row">
        <button id="comfort-btn" onclick="acheterConfort()" style="display:none;">ğŸ›‹ï¸ Achat (100 â‚¬)</button>
        <button id="sell-btn" onclick="sell()">ğŸ’¶ Vendre</button>
      </div>
    </div>
    <div class="category">
      <div class="cat-title">ğŸ’¶ Ã‰conomie</div>
      <div class="stock" id="money-row" style="display:none;">
        Monnaie (â‚¬) : <span id="money">10</span>
      </div>
      <div class="stock" id="budget-etat-row" style="display:none;">
        Budget de l'Ã‰tat : <span id="budget-etat">0</span> â‚¬
      </div>
      <div class="products-box" id="price-indicator-box" style="display:none;">
        Prix de vente<br>
        <span id="current-price">1â‚¬</span>
      </div>
      <button id="don-btn" onclick="receiveDon()">Recevoir mon don</button>
      <button id="credit-btn" onclick="activateCredit()" style="display:none;" class="btn-credit">ğŸ’³ Effectuer un crÃ©dit</button>
      <div id="eh-msg" class="message-box msg-blue" style="display:none;"></div>
      <div id="eh-success" class="message-box msg-green" style="display:none;"></div>
      <div id="game-over-resources" class="message-box msg-red" style="display:none;"></div>
      <div id="game-over-confort" class="message-box msg-red" style="display:none;"></div>
      <div class="btn-row">
        <button id="ouvrier-btn" onclick="acheterIA()" style="display:none;">ğŸ¤– Engager une IA (500 â‚¬)</button>
        <button id="trader-btn" onclick="acheterTrader()" style="display:none;">ğŸ¤– Trader automatique (1 000 â‚¬)</button>
        <button id="comfort-auto-btn" onclick="acheterConfortAuto()" style="display:none;">ğŸ”„ Achat auto confort (2 000 â‚¬)</button>
        <button id="upgrade-btn2" onclick="upgradeProd2()" style="display:none;">ğŸ’  AmÃ©liorer la production (2 000 â‚¬)</button>
        <button id="automatisms-btn" onclick="acheterAutomatismsClics()" style="display:none;">âš¡ Automatismes = clics (10 000 â‚¬)</button>
        <button id="centre-commercial-btn" onclick="acheterCentreCommercial()" style="display:none;">ğŸ¬ Centre commercial (5 000 â‚¬)</button>
        <button id="price-indicator-btn" onclick="acheterIndicateurPrix()" style="display:none;">ğŸ“Š Indicateur de prix (30 000 â‚¬)</button>
        <button id="evolution-btn" onclick="evolution()" style="display:none;" class="btn-evolution">ğŸŒ± Ã‰volution Ã©conomique</button>
        <button id="rescue-eh-btn" onclick="activateRescueEH()" style="display:none;" class="btn-evolution">ğŸŒ± Passer Ã  l'Ã©conomie homÃ©ostatique</button>
      </div>
    </div>
  </div>
  <div id="jauges-zone" style="margin: 0 auto 14px auto; max-width:620px;">
    <div class="jauge-bottom-barre">
      <div class="jauge-bottom-label">ğŸŒ± Ressources</div>
      <div class="jauge-bottom-bar"><div class="jauge-bottom-fill" id="jauge-nature"></div></div>
      <div class="jauge-bottom-val" id="jauge-nature-txt"></div>
    </div>
    <div class="jauge-bottom-barre" id="jauge-confort-container" style="display:none;">
      <div class="jauge-bottom-label">ğŸ¤– Confort</div>
      <div class="jauge-bottom-bar"><div class="jauge-bottom-fill" id="jauge-confort"></div></div>
      <div class="jauge-bottom-val" id="jauge-confort-txt"></div>
    </div>
    <div class="jauge-bottom-barre" id="jauge-money-container" style="display:none;">
      <div class="jauge-bottom-label">ğŸ’¶ Monnaie</div>
      <div class="jauge-bottom-bar"><div class="jauge-bottom-fill" id="jauge-money"></div></div>
      <div class="jauge-bottom-val" id="jauge-money-txt"></div>
    </div>
    <div class="jauge-bottom-barre" id="jauge-budget-etat-container" style="display:none;">
      <div class="jauge-bottom-label">ğŸ›ï¸ Budget Ã‰tat</div>
      <div class="jauge-bottom-bar"><div class="jauge-bottom-fill" id="jauge-budget-etat"></div></div>
      <div class="jauge-budget-etat-val" id="jauge-budget-etat-txt"></div>
    </div>
    <div class="jauge-bottom-barre" id="jauge-achat-auto-container" style="display:none;">
      <div class="jauge-bottom-label">ğŸ”„ Achat auto</div>
      <div class="jauge-bottom-bar"><div class="jauge-bottom-fill" id="jauge-achat-auto"></div></div>
      <div class="jauge-bottom-val" id="jauge-achat-auto-txt"></div>
    </div>
    <div class="jauge-bottom-barre" id="jauge-ia-container" style="display:none;">
      <div class="jauge-bottom-label">ğŸ¤– IA</div>
      <div class="jauge-bottom-bar"><div class="jauge-bottom-fill" id="jauge-ia"></div></div>
      <div class="jauge-bottom-val" id="jauge-ia-txt"></div>
    </div>
    <div class="jauge-bottom-barre" id="jauge-trader-container" style="display:none;">
      <div class="jauge-bottom-label">ğŸ’° Trader</div>
      <div class="jauge-bottom-bar"><div class="jauge-bottom-fill" id="jauge-trader"></div></div>
      <div class="jauge-bottom-val" id="jauge-trader-txt"></div>
    </div>
    <div class="jauge-bottom-barre" id="jauge-centre-container" style="display:none;">
      <div class="jauge-bottom-label">ğŸ¬ Centre</div>
      <div class="jauge-bottom-bar"><div class="jauge-bottom-fill" id="jauge-centre"></div></div>
      <div class="jauge-bottom-val" id="jauge-centre-txt"></div>
    </div>
    <div class="jauge-bottom-barre" id="jauge-tech-container" style="display:none;">
      <div class="jauge-bottom-label">ğŸ’  Niveau technologique</div>
      <div class="jauge-bottom-bar"><div class="jauge-bottom-fill" id="jauge-tech"></div></div>
      <div class="jauge-bottom-val" id="jauge-tech-txt"></div>
    </div>
  </div>
  <div class="message" id="message"></div>
  <div id="clics-container">Clics/actions : <span id="clicks">0</span></div>
  <hr id="triche-sep">
  <div id="triche-label">Triche</div>
  <div class="debug-row">
    <button class="btn-yellow" onclick="addMoney()">+1000 crÃ©dits (test)</button>
    <button class="btn-yellow" onclick="addOneNature()">+100 ressources (test)</button>
    <button class="btn-yellow" onclick="addClicks50()">Clics +50 (test)</button>
    <button class="btn-annuler" onclick="undoAction()">âª Annuler le clic prÃ©cÃ©dent</button>
    <button class="btn-yellow" onclick="triggerRandomEvent()">ğŸ² DÃ©clencher Ã©vÃ©nement test</button>
  </div>
  <script>
   // ==================== 1. VARIABLES ET OBJETS GLOBAUX ====================

var gameState = {
  // Variables de base
  nature: 3000,
  confort: 0,
  production: 0,
  money: 10,
  clicks: 0,

  // Budget de l'Ã‰tat
  budgetEtat: 0,

  // Suivi du confort maximum
  confortMaxAtteint: 0,

  // Ã‰tats des systÃ¨mes
  monnaieActive: false,
  creditUnlocked: false,
  jeuBloque: false,
  criseSocialeActive: false,
  ehActivated: false,

  // Ã‰tats de fin de jeu
  gameOver: false,
  gameOverCause: null,

  // Automatismes
  ia: 0,
  traderAuto: 0,
  confortAuto: 0,
  centreCommercial: 0,

  // AmÃ©liorations
  techLevel: 0,
  productionMultiplier: 1,
  automatismsGenerateClicks: false,
  priceIndicatorActive: false,

  // Compteurs d'achats cycliques
  nbAchatIA: 0,
  nbAchatTrader: 0,
  nbAchatConfortAuto: 0,
  nbAchatUpgradeProd: 0,
  nbAchatCentre: 0,

  // Paliers
  paliersDebloque: {
    comfort: false,
    ia: false,
    trader: false,
    upgradeProd: false,
    confortAuto: false,
    automatismsClics: false,
    priceIndicator: false,
    centreCommercial: false
  }
};

// Ã‰tats des automatismes (ON/OFF)
var automatismsActive = {
  ia: true,
  trader: true,
  confort: true,
  centre: true
};

// Gestion des intervalles sÃ©curisÃ©s
var intervals = {
  ia: null,
  trader: null,
  confortAuto: null,
  centreCommercial: null
};

// SYSTÃˆME DE CRÃ‰DIT CENTRALISÃ‰
var pendingPurchase = null;

// Sauvegarde pour l'annulation
var lastState = null;

// Configuration des paliers cycliques selon le cahier des charges
var paliersConfig = {
  comfort: { 
    palierBase: 120, 
    cycle: 0, // Non cyclique (achat simple)
    coutBase: 100,
    multiplicateurCout: 1, // Pas d'augmentation
    name: "Acheter confort",
    emoji: "ğŸ›‹ï¸",
    description: "Conversion â‚¬ â†’ Confort"
  },
  ia: { 
    palierBase: 200, 
    cycle: 200, // Tous les 200 clics (400, 600, 800...)
    coutBase: 500,
    multiplicateurCout: 1.5, // CoÃ»t Ã—1.5 Ã  chaque achat
    name: "Engager une IA",
    emoji: "ğŸ¤–",
    description: "Production automatique (5s)"
  },
  trader: { 
    palierBase: 500, 
    cycle: 500, // Tous les 500 clics (1000, 1500...)
    coutBase: 1000,
    multiplicateurCout: 1.5, // CoÃ»t Ã—1.5 Ã  chaque achat
    name: "Trader automatique",
    emoji: "ğŸ¤–",
    description: "Vente auto (3s)"
  },
  upgradeProd: { 
    palierBase: 600, 
    cycle: 600, // Tous les 600 clics (1200, 1800...)
    coutBase: 2000,
    multiplicateurCout: 1.5, // CoÃ»t Ã—1.5 Ã  chaque achat
    name: "AmÃ©liorer la production",
    emoji: "ğŸ’ ",
    description: "Multiplie prod Ã—1.5"
  },
  confortAuto: { 
    palierBase: 700, 
    cycle: 700, // Tous les 700 clics (1400, 2100...)
    coutBase: 2000,
    multiplicateurCout: 1.5, // CoÃ»t Ã—1.5 Ã  chaque achat
    name: "Achat auto confort",
    emoji: "ğŸ”„",
    description: "Achat confort auto (15s)"
  },
  automatismsClics: { 
    palierBase: 750, 
    cycle: 0, // Non cyclique (achat unique)
    coutBase: 10000,
    multiplicateurCout: 1, // Pas d'augmentation
    name: "Automatismes = clics",
    emoji: "âš¡",
    description: "Actions auto = clics (score)",
    condition: function() { return !gameState.automatismsGenerateClicks; }
  },
  priceIndicator: { 
    palierBase: 1000, 
    cycle: 0, // Non cyclique (achat unique)
    coutBase: 30000,
    multiplicateurCout: 1, // Pas d'augmentation
    name: "Indicateur de prix",
    emoji: "ğŸ“Š",
    description: "Affiche dynamique du prix",
    condition: function() { return !gameState.priceIndicatorActive; }
  },
  centreCommercial: { 
    palierBase: 1100, 
    cycle: 1100, // Tous les 1100 clics (2200, 3300...)
    coutBase: 5000,
    multiplicateurCout: 1.5, // CoÃ»t Ã—1.5 Ã  chaque achat
    name: "Centre commercial",
    emoji: "ğŸ¬",
    description: "Achat confort 10Ã— (15s)"
  }
};

// ========================================================================
// 2. SYSTÃˆME D'Ã‰VÃ‰NEMENTS ALÃ‰ATOIRES
// ========================================================================

/**
 * Configuration du systÃ¨me d'Ã©vÃ©nements
 */
var EVENT_CONFIG = {
  minInterval: 20,    // Intervalle minimum entre Ã©vÃ©nements (en clics)
  maxInterval: 60,    // Intervalle maximum entre Ã©vÃ©nements (en clics)
  displayDuration: 10000  // DurÃ©e d'affichage des messages (10 secondes)
};

/**
 * Ã‰tat du systÃ¨me d'Ã©vÃ©nements
 */
var eventSystem = {
  nextEventAt: 0,           // Prochain Ã©vÃ©nement dÃ©clenchÃ© Ã  ce nombre de clics
  lastEventClick: 0,        // Dernier clic oÃ¹ un Ã©vÃ©nement s'est produit
  activeBoosts: {           // Boosts temporaires actifs
    production: { active: false, multiplier: 1, endTime: 0 },
    money: { active: false, multiplier: 1, endTime: 0 },
    selling: { active: false, multiplier: 1, endTime: 0 }
  }
};
/**
 * Liste complÃ¨te des Ã©vÃ©nements alÃ©atoires
 * (Extraits pour la taille ; tu peux Ã©toffer avec tes propres effets ou ceux fournis plus haut)
 */
var randomEvents = [
  // -------------------- Ã‰vÃ©nements positifs (1â€“30) --------------------
  { id: 1, type: "positif", title: "Prime d'innovation", desc: "+300 â‚¬", effect: function() { gameState.money += 300; } },
  { id: 2, type: "positif", title: "Subvention Ã©cologique", desc: "+500 ressources", effect: function() { gameState.nature += 500; } },
  { id: 3, type: "positif", title: "Boost social", desc: "+5 confort", effect: function() { gameState.confort += 5; } },
  { id: 4, type: "positif", title: "Exportation record", desc: "+400 â‚¬", effect: function() { gameState.money += 400; } },
  { id: 5, type: "positif", title: "Nouvelle alliance", desc: "+5 production", effect: function() { gameState.production += 5; } },
  // ... (complÃ¨te ici avec tous les autres Ã©vÃ©nements fournis dans tes versions prÃ©cÃ©dentes â€“ il doit y avoir environ 80 events)
  { id: 80, type: "neutre", title: "Convergence universelle", desc: "Toutes ressources = 1000", effect: function() { gameState.nature = 1000; gameState.confort = 1000; gameState.production = 1000; gameState.money = 1000; } }
];

// Outils pour Ã©vÃ©nements
function getRandomInterval() {
  return Math.floor(Math.random() * (EVENT_CONFIG.maxInterval - EVENT_CONFIG.minInterval + 1)) + EVENT_CONFIG.minInterval;
}

function initializeEventSystem() {
  eventSystem.nextEventAt = getRandomInterval();
}

function checkRandomEvent() {
  if (gameState.ehActivated || gameState.gameOver) return;
  if (gameState.clicks >= eventSystem.nextEventAt) {
    triggerRandomEvent();
    eventSystem.lastEventClick = gameState.clicks;
    eventSystem.nextEventAt = gameState.clicks + getRandomInterval();
  }
}

function triggerRandomEvent() {
  var randomIndex = Math.floor(Math.random() * randomEvents.length);
  var selectedEvent = randomEvents[randomIndex];
  try { selectedEvent.effect(); } catch (error) { console.error("Erreur Ã©vÃ©nement :", error); }
  showEventMessage(selectedEvent.title, selectedEvent.desc, selectedEvent.type);
  updateUIValues();
}

function showEventMessage(title, desc, type) {
  var eventElement = document.getElementById("event-message");
  var emoji, className;
  switch(type) {
    case "positif": emoji = "ğŸ‰"; className = "message-box msg-green"; break;
    case "negatif": emoji = "âš ï¸"; className = "message-box msg-red"; break;
    case "neutre": emoji = "ğŸ””"; className = "message-box msg-purple"; break;
    default: emoji = "ğŸ²"; className = "message-box msg-blue";
  }
  var fullMessage = emoji + " " + title + " : " + desc;
  eventElement.textContent = fullMessage;
  eventElement.className = className;
  eventElement.style.display = "block";
  setTimeout(function() {
    if (eventElement.textContent === fullMessage) {
      eventElement.style.display = "none";
      eventElement.textContent = "";
    }
  }, EVENT_CONFIG.displayDuration);
}

// Boosts temporaires (production, vente)
function boostProduction(mult, duration) {
  if (eventSystem.activeBoosts.production.active) clearTimeout(eventSystem.activeBoosts.production.timeout);
  eventSystem.activeBoosts.production.active = true;
  eventSystem.activeBoosts.production.multiplier = mult;
  eventSystem.activeBoosts.production.timeout = setTimeout(function() {
    eventSystem.activeBoosts.production.active = false;
    eventSystem.activeBoosts.production.multiplier = 1;
  }, duration);
}
function boostSelling(mult, duration) {
  if (eventSystem.activeBoosts.selling.active) clearTimeout(eventSystem.activeBoosts.selling.timeout);
  eventSystem.activeBoosts.selling.active = true;
  eventSystem.activeBoosts.selling.multiplier = mult;
  eventSystem.activeBoosts.selling.timeout = setTimeout(function() {
    eventSystem.activeBoosts.selling.active = false;
    eventSystem.activeBoosts.selling.multiplier = 1;
  }, duration);
}
// Blocages temporaires
function blockProduction(duration) {
  var btn = document.getElementById("produce-btn");
  var original = btn.textContent; var wasDisabled = btn.disabled;
  btn.disabled = true; btn.textContent = "ğŸ› ï¸ Production bloquÃ©e";
  setTimeout(function() { btn.disabled = wasDisabled; btn.textContent = original; }, duration);
}
function blockSelling(duration) {
  var btn = document.getElementById("sell-btn");
  var original = btn.textContent; var wasDisabled = btn.disabled;
  btn.disabled = true; btn.textContent = "ğŸ’¶ Ventes bloquÃ©es";
  setTimeout(function() { btn.disabled = wasDisabled; btn.textContent = original; }, duration);
}

function triggerTestEvent() { triggerRandomEvent(); updateUI("ğŸ² Ã‰vÃ©nement de test dÃ©clenchÃ©"); }

function getEffectiveProductionMultiplier() {
  var m = gameState.productionMultiplier;
  if (eventSystem.activeBoosts.production.active) m *= eventSystem.activeBoosts.production.multiplier;
  return m;
}
function getEffectiveSaleMultiplier() {
  var m = 1;
  if (eventSystem.activeBoosts.selling.active) m *= eventSystem.activeBoosts.selling.multiplier;
  return m;
}
// ==================== 3. FONCTIONS PRINCIPALES DU JEU ====================

// Action de production
function produce() {
  if (gameState.jeuBloque) return;
  saveState();
  var cost = 5;
  if (gameState.nature >= cost) {
    gameState.nature -= cost;
    var prodAmount = Math.floor(getEffectiveProductionMultiplier());
    gameState.production += prodAmount;
    gameState.clicks++;
    checkRandomEvent();
    checkAndApplyTax();
    updateUI("Production : +" + prodAmount + " produits crÃ©Ã©s");
  } else {
    updateUI("Pas assez de ressources pour produire");
  }
}

// Action de vente
function sell() {
  if (gameState.jeuBloque || gameState.production <= 0) {
    if (gameState.production <= 0) updateUI("Aucun produit Ã  vendre");
    return;
  }
  saveState();
  var price = calculatePrice();
  var saleAmount = Math.min(gameState.production, 1);
  var totalEarnings = price * saleAmount * getEffectiveSaleMultiplier();
  gameState.money += totalEarnings;
  gameState.production -= saleAmount;
  gameState.clicks++;
  checkRandomEvent();
  checkAndApplyTax();
  if (!gameState.monnaieActive) {
    gameState.monnaieActive = true;
    document.getElementById("money-row").style.display = "block";
    document.getElementById("jauge-money-container").style.display = "flex";
  }
  updateUI("Vente : +" + totalEarnings.toFixed(2) + "â‚¬");
}

// Action de don initial
function receiveDon() {
  if (gameState.jeuBloque) return;
  saveState();
  gameState.money = 1000;
  gameState.clicks++;
  checkRandomEvent();
  checkAndApplyTax();
  if (!gameState.monnaieActive) {
    gameState.monnaieActive = true;
    document.getElementById("money-row").style.display = "block";
    document.getElementById("jauge-money-container").style.display = "flex";
  }
  document.getElementById("don-btn").style.display = "none";
  updateUI("Don reÃ§u : 1000â‚¬");
}

// === Toutes les fonctions d'achat, upgrade et actions de paliers ===
// (identiques Ã  la version prÃ©cÃ©dente, incluses ici pour avoir un jeu complet)

function acheterConfort() {
  if (gameState.jeuBloque || !gameState.monnaieActive) return;
  var cost = 100;
  if (needsCreditActivation(cost)) {
    if (showCreditButton('comfort', cost)) {
      updateUI("Solde insuffisant pour acheter du confort - CrÃ©dit disponible");
      return;
    }
  }
  saveState();
  debitMoney(cost);
  gameState.confort += 1;
  gameState.clicks++;
  checkRandomEvent();
  checkAndApplyTax();
  if (gameState.confort === 1) {
    document.getElementById("jauge-confort-container").style.display = "flex";
  }
  var message = "Confort achetÃ© : +1 confort";
  if (gameState.money < 0) {
    message += " - Solde : " + gameState.money + "â‚¬";
  }
  updateUI(message);
}

function acheterIA() {
  if (gameState.jeuBloque || !gameState.monnaieActive) return;
  var etat = calculerEtatPalierCyclique('ia');
  var cost = etat.cout;
  if (needsCreditActivation(cost)) {
    if (showCreditButton('ia', cost)) {
      updateUI("Solde insuffisant pour engager une IA - CrÃ©dit disponible");
      return;
    }
  }
  saveState();
  debitMoney(cost);
  if (gameState.ia === 0) {
    gameState.ia = 1;
    document.getElementById("jauge-ia-container").style.display = "flex";
    startIAInterval();
  } else {
    gameState.ia *= 2;
    if (intervals.ia) clearInterval(intervals.ia);
    startIAInterval();
  }
  gameState.nbAchatIA++;
  gameState.clicks++;
  checkRandomEvent();
  checkAndApplyTax();
  document.getElementById("ouvrier-btn").style.display = "none";
  updateUI("IA engagÃ©e ! Production automatique Ã—" + gameState.ia + " (toutes les 5s)");
}

function acheterTrader() {
  if (gameState.jeuBloque || !gameState.monnaieActive) return;
  var etat = calculerEtatPalierCyclique('trader');
  var cost = etat.cout;
  if (needsCreditActivation(cost)) {
    if (showCreditButton('trader', cost)) {
      updateUI("Solde insuffisant pour engager un trader - CrÃ©dit disponible");
      return;
    }
  }
  saveState();
  debitMoney(cost);
  if (gameState.traderAuto === 0) {
    gameState.traderAuto = 1;
    document.getElementById("jauge-trader-container").style.display = "flex";
    startTraderInterval();
  } else {
    gameState.traderAuto *= 2;
    if (intervals.trader) clearInterval(intervals.trader);
    startTraderInterval();
  }
  gameState.nbAchatTrader++;
  gameState.clicks++;
  checkRandomEvent();
  checkAndApplyTax();
  document.getElementById("trader-btn").style.display = "none";
  updateUI("Trader automatique Ã—" + gameState.traderAuto + " engagÃ© ! Vente automatique (toutes les 3s)");
}

function acheterConfortAuto() {
  if (gameState.jeuBloque || !gameState.monnaieActive) return;
  var etat = calculerEtatPalierCyclique('confortAuto');
  var cost = etat.cout;
  if (needsCreditActivation(cost)) {
    if (showCreditButton('confortAuto', cost)) {
      updateUI("Solde insuffisant pour l'achat automatique de confort - CrÃ©dit disponible");
      return;
    }
  }
  saveState();
  debitMoney(cost);
  if (gameState.confortAuto === 0) {
    gameState.confortAuto = 1;
    document.getElementById("jauge-achat-auto-container").style.display = "flex";
    startConfortAutoInterval();
  } else {
    gameState.confortAuto *= 2;
    if (intervals.confortAuto) clearInterval(intervals.confortAuto);
    startConfortAutoInterval();
  }
  gameState.nbAchatConfortAuto++;
  gameState.clicks++;
  checkRandomEvent();
  checkAndApplyTax();
  document.getElementById("comfort-auto-btn").style.display = "none";
  updateUI("Achat automatique de confort activÃ© ! +" + gameState.confortAuto + " confort toutes les 15s");
}

function acheterCentreCommercial() {
  if (gameState.jeuBloque || !gameState.monnaieActive) return;
  var etat = calculerEtatPalierCyclique('centreCommercial');
  var cost = etat.cout;
  if (needsCreditActivation(cost)) {
    if (showCreditButton('centreCommercial', cost)) {
      updateUI("Solde insuffisant pour le centre commercial - CrÃ©dit disponible");
      return;
    }
  }
  saveState();
  debitMoney(cost);
  if (gameState.centreCommercial === 0) {
    gameState.centreCommercial = 1;
    document.getElementById("jauge-centre-container").style.display = "flex";
    startCentreCommercialInterval();
  } else {
    gameState.centreCommercial *= 2;
    if (intervals.centreCommercial) clearInterval(intervals.centreCommercial);
    startCentreCommercialInterval();
  }
  gameState.nbAchatCentre++;
  gameState.clicks++;
  checkRandomEvent();
  checkAndApplyTax();
  document.getElementById("centre-commercial-btn").style.display = "none";
  updateUI("Centre commercial activÃ© ! +" + (10 * gameState.centreCommercial) + " confort toutes les 15s");
}

function upgradeProd2() {
  if (gameState.jeuBloque || !gameState.monnaieActive) return;
  var etat = calculerEtatPalierCyclique('upgradeProd');
  var cost = etat.cout;
  if (needsCreditActivation(cost)) {
    if (showCreditButton('upgradeProd', cost)) {
      updateUI("Solde insuffisant pour amÃ©liorer la production - CrÃ©dit disponible");
      return;
    }
  }
  saveState();
  debitMoney(cost);
  gameState.techLevel++;
  gameState.productionMultiplier *= 1.5;
  gameState.nbAchatUpgradeProd++;
  gameState.clicks++;
  checkRandomEvent();
  checkAndApplyTax();
  if (gameState.techLevel === 1) {
    document.getElementById("jauge-tech-container").style.display = "flex";
  }
  document.getElementById("upgrade-btn2").style.display = "none";
  updateUI("Production amÃ©liorÃ©e ! Multiplicateur Ã—" + gameState.productionMultiplier.toFixed(1));
}

function acheterAutomatismsClics() {
  if (gameState.jeuBloque || !gameState.monnaieActive) return;
  var cost = 10000;
  if (needsCreditActivation(cost)) {
    if (showCreditButton('automatismsClics', cost)) {
      updateUI("Solde insuffisant pour les automatismes = clics - CrÃ©dit disponible");
      return;
    }
  }
  saveState();
  debitMoney(cost);
  gameState.automatismsGenerateClicks = true;
  gameState.clicks++;
  checkRandomEvent();
  checkAndApplyTax();
  gameState.paliersDebloque.automatismsClics = true;
  document.getElementById("automatisms-btn").style.display = "none";
  updateUI("Automatismes activÃ©s ! Chaque action automatique compte comme un clic");
}

function acheterIndicateurPrix() {
  if (gameState.jeuBloque || !gameState.monnaieActive) return;
  var cost = 30000;
  if (needsCreditActivation(cost)) {
    if (showCreditButton('priceIndicator', cost)) {
      updateUI("Solde insuffisant pour l'indicateur de prix - CrÃ©dit disponible");
      return;
    }
  }
  saveState();
  debitMoney(cost);
  gameState.priceIndicatorActive = true;
  gameState.clicks++;
  checkRandomEvent();
  checkAndApplyTax();
  gameState.paliersDebloque.priceIndicator = true;
  document.getElementById("price-indicator-btn").style.display = "none";
  updateUI("Indicateur de prix activÃ© ! Le prix varie selon : |Monnaie| Ã· Ressources");
}

function evolution() {
  if (gameState.jeuBloque || !gameState.monnaieActive || gameState.ehActivated) return;
  saveState();
  gameState.ehActivated = true;
  gameState.jeuBloque = true;
  gameState.clicks++;
  checkRandomEvent();
  checkAndApplyTax();
  // ArrÃªter tous les automatismes
  Object.keys(automatismsActive).forEach(function(key) { automatismsActive[key] = false; });
  clearAllIntervals();
  document.getElementById("automatisms-controls").style.display = "none";
  var successBox = document.getElementById("eh-success");
  successBox.style.display = "block";
  successBox.textContent = "ğŸŒ± Transition vers l'Ã‰conomie HomÃ©ostatique rÃ©ussie ! Le systÃ¨me entre en Ã©quilibre...";
  document.getElementById("evolution-btn").style.display = "none";
  updateUI("ğŸŒ± Ã‰volution vers l'Ã‰conomie HomÃ©ostatique - SystÃ¨me stabilisÃ© !");
}

function activateRescueEH() {
  saveState();
  gameState.nature += 100;
  gameState.confort += 50;
  if (gameState.confort > gameState.confortMaxAtteint) {
    gameState.confortMaxAtteint = gameState.confort;
  }
  gameState.ehActivated = true;
  gameState.gameOver = false;
  gameState.jeuBloque = true;
  document.getElementById("game-over-resources").style.display = "none";
  document.getElementById("game-over-confort").style.display = "none";
  document.getElementById("rescue-eh-btn").style.display = "none";
  var successBox = document.getElementById("eh-success");
  successBox.style.display = "block";
  successBox.textContent = "ğŸŒ± Transition d'urgence vers l'Ã‰conomie HomÃ©ostatique rÃ©ussie ! Le systÃ¨me entre en Ã©quilibre...";
  updateUI("ğŸŒ± Secours EH activÃ© : +100 ressources, +50 confort - SystÃ¨me stabilisÃ© !");
}

// Initialisation et dÃ©marrage
initializeEventSystem(); // DÃ©marre les Ã©vÃ©nements alÃ©atoires
updateUI("");


  </script>
</body>
</html>


