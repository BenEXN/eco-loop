<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Looop -V1.15.1</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f0f0f0;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .stat {
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            text-align: center;
            border: 2px solid #dee2e6;
        }
        
        .stat-value {
            font-size: 1.5em;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .actions {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
            margin-bottom: 20px;
        }
        
        button {
            padding: 12px 20px;
            font-size: 1em;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            background: #007bff;
            color: white;
            transition: background-color 0.3s;
        }
        
        button:hover {
            background: #0056b3;
        }
        
        button:disabled {
            background: #6c757d;
            cursor: not-allowed;
        }
        
        .upgrade-btn {
            background: #28a745;
        }
        
        .upgrade-btn:hover {
            background: #1e7e34;
        }
        
        .log {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 5px;
            padding: 15px;
            height: 200px;
            overflow-y: auto;
            font-family: monospace;
        }
        
        .log-entry {
            margin-bottom: 5px;
        }
        
        .negative { color: #dc3545; }
        .positive { color: #28a745; }
        .warning { color: #ffc107; }
    </style>
</head>
<body>
    <div class="container">
        <h1>🔄 LOOOP v1.12+ 🔄</h1>
        
        <div class="stats" id="stats">
            <!-- Stats will be populated by JavaScript -->
        </div>
        
        <div class="actions" id="actions">
            <!-- Actions will be populated by JavaScript -->
        </div>
        
        <div class="log" id="log">
            <div class="log-entry">🎮 Bienvenue dans Looop ! Cliquez sur "Recevoir mon don" pour commencer...</div>
        </div>
    </div>

    <script>
        const gameState = {
            money: 0,
            resources: 0,
            production: 0,
            comfort: 100,
            clicks: 0,
            hasInitialGift: false,
            hasAI: false,
            hasAutoTrader: false,
            hasProductionUpgrade: false,
            hasAutoComfort: false,
            debt: 0,
            interestRate: 0.05,
            productionMultiplier: 1,
            factories: 0,
            markets: 0,
            autoCountsAsClicks: false,
            hasPriceIndicator: false,
            interestNegotiations: 0,
            taxEnabled: false,
            lastEventClick: 0
        };

        const randomEvents = [
            // Événements Phase 1 (0-500 clics) - Rares et plutôt positifs
            { name: "Prime exceptionnelle", effect: () => { gameState.money += 200; log("📈 Prime exceptionnelle reçue ! +200€"); }, minClicks: 0, maxClicks: 500, probability: 0.02 },
            { name: "Ruée des clients", effect: () => { gameState.money += 300; log("🏃‍♂️ Ruée des clients ! +300€"); }, minClicks: 0, maxClicks: 500, probability: 0.02 },
            { name: "Recrutement éclair", effect: () => { gameState.productionMultiplier *= 1.1; log("⚡ Recrutement éclair ! Production +10%"); }, minClicks: 0, maxClicks: 500, probability: 0.02 },
            
            // Événements Phase 2 (250-1000 clics)
            { name: "Bug logiciel", effect: () => { gameState.productionMultiplier *= 0.9; log("🐛 Bug logiciel ! Production -10%"); }, minClicks: 250, maxClicks: 1000, probability: 0.03 },
            { name: "Embauche talentueuse", effect: () => { gameState.productionMultiplier *= 1.2; log("🌟 Embauche d'un employé talentueux ! Production +20%"); }, minClicks: 250, maxClicks: 1000, probability: 0.03 },
            { name: "Panne informatique", effect: () => { gameState.productionMultiplier *= 0.8; log("💻 Panne informatique ! Production ralentie"); }, minClicks: 250, maxClicks: 1000, probability: 0.03 },
            { name: "Contrôle fiscal", effect: () => { gameState.money -= 500; log("🕵️ Contrôle fiscal ! -500€"); }, minClicks: 500, maxClicks: 1000, probability: 0.03 },
            { name: "Rupture de stock", effect: () => { gameState.resources = Math.max(0, gameState.resources - 10); log("📦 Rupture de stock temporaire !"); }, minClicks: 500, maxClicks: 1000, probability: 0.03 },
            { name: "Perte de données", effect: () => { gameState.money -= 300; log("💾 Perte de données ! -300€"); }, minClicks: 500, maxClicks: 1000, probability: 0.03 },
            { name: "Audit surprise", effect: () => { gameState.money -= 400; log("📊 Audit surprise ! -400€"); }, minClicks: 500, maxClicks: 1000, probability: 0.03 },
            { name: "Grève du personnel", effect: () => { gameState.productionMultiplier *= 0.7; log("✊ Grève du personnel ! Production réduite"); }, minClicks: 500, maxClicks: 1000, probability: 0.03 },
            { name: "Innovation externe", effect: () => { gameState.money += 600; log("💡 Innovation externe profitable ! +600€"); }, minClicks: 500, maxClicks: 1000, probability: 0.03 },
            
            // Événements Phase 3 (1000-3000 clics)
            { name: "Fusion d'entreprise", effect: () => { gameState.productionMultiplier *= 1.1; gameState.money += 1000; log("🤝 Fusion d'entreprise ! Production +10% et +1000€"); }, minClicks: 1000, maxClicks: 3000, probability: 0.04 },
            { name: "Perte de brevet", effect: () => { gameState.productionMultiplier *= 0.85; log("📄 Perte de brevet ! Coût de production augmenté"); }, minClicks: 1000, maxClicks: 3000, probability: 0.04 },
            { name: "Crash boursier", effect: () => { gameState.money *= 0.8; log("📉 Crash boursier ! -20% de monnaie"); }, minClicks: 1000, maxClicks: 3000, probability: 0.04 },
            { name: "Commande annulée", effect: () => { gameState.resources -= 15; gameState.money -= 200; log("❌ Commande annulée ! Perte de production et -200€"); }, minClicks: 1000, maxClicks: 3000, probability: 0.04 },
            { name: "Rivalité concurrente", effect: () => { gameState.productionMultiplier *= 0.9; log("⚔️ Rivalité concurrente ! Production -10%"); }, minClicks: 1000, maxClicks: 3000, probability: 0.04 },
            { name: "Nouvelle réglementation", effect: () => { gameState.money -= 800; log("📋 Nouvelle réglementation ! Coût de mise en conformité -800€"); }, minClicks: 1000, maxClicks: 3000, probability: 0.04 },
            { name: "Grève générale", effect: () => { gameState.productionMultiplier *= 0.5; log("🚫 Grève générale ! Toute la production bloquée !"); }, minClicks: 1000, maxClicks: 3000, probability: 0.02 },
            { name: "Faillite d'un fournisseur", effect: () => { gameState.money -= 300; log("💸 Faillite d'un fournisseur ! Coûts augmentés -300€"); }, minClicks: 1000, maxClicks: 3000, probability: 0.04 },
            { name: "Fuite d'informations", effect: () => { gameState.money -= 500; log("🕳️ Fuite d'informations stratégiques ! -500€"); }, minClicks: 1000, maxClicks: 3000, probability: 0.04 },
            { name: "Piratage informatique", effect: () => { gameState.money -= 700; log("🏴‍☠️ Piratage informatique ! -700€"); }, minClicks: 1000, maxClicks: 3000, probability: 0.04 },
            { name: "Subvention publique", effect: () => { gameState.money += 1200; log("🏛️ Subvention publique exceptionnelle ! +1200€"); }, minClicks: 1000, maxClicks: 3000, probability: 0.03 },
            { name: "Découverte marché niche", effect: () => { gameState.money += 800; log("🎯 Découverte d'un marché de niche ! +800€"); }, minClicks: 1000, maxClicks: 3000, probability: 0.03 },
            { name: "Concurrent apparition", effect: () => { gameState.productionMultiplier *= 0.85; log("🏢 Apparition d'un concurrent ! Production -15%"); }, minClicks: 1000, maxClicks: 3000, probability: 0.04 },
            { name: "Scandale médiatique", effect: () => { gameState.comfort -= 20; gameState.money -= 400; log("📺 Scandale médiatique ! Confort -20 et -400€"); }, minClicks: 1000, maxClicks: 3000, probability: 0.03 },
            { name: "Campagne pub virale", effect: () => { gameState.money += 900; log("📱 Campagne de pub virale ! +900€"); }, minClicks: 1000, maxClicks: 3000, probability: 0.03 },
            { name: "Démission employé-clé", effect: () => { gameState.productionMultiplier *= 0.8; log("👋 Démission d'un employé-clé ! Production -20%"); }, minClicks: 1000, maxClicks: 3000, probability: 0.04 },
            { name: "Panne d'électricité", effect: () => { gameState.productionMultiplier *= 0.6; log("⚡ Panne d'électricité ! Tout s'arrête !"); }, minClicks: 1000, maxClicks: 3000, probability: 0.02 },
            { name: "Investisseur providentiel", effect: () => { gameState.money += 2000; log("💰 Investisseur providentiel ! +2000€ mais perte d'autonomie"); }, minClicks: 1000, maxClicks: 3000, probability: 0.02 },
            { name: "Procès en justice", effect: () => { gameState.money -= 1000; gameState.comfort -= 15; log("⚖️ Procès en justice ! -1000€ et confort -15"); }, minClicks: 1000, maxClicks: 3000, probability: 0.03 },
            { name: "Départ retraite massive", effect: () => { gameState.productionMultiplier *= 0.75; log("👴 Départ en retraite massive ! Production -25%"); }, minClicks: 1000, maxClicks: 3000, probability: 0.03 },
            { name: "Innovation techno externe", effect: () => { gameState.money += 500; gameState.productionMultiplier *= 1.05; log("🔬 Innovation technologique externe ! +500€ et production +5%"); }, minClicks: 1000, maxClicks: 3000, probability: 0.03 },
            
            // Événements Phase 4+ (>3000 clics) - Plus fréquents et puissants
            { name: "Taux intérêt hausse", effect: () => { gameState.interestRate *= 1.2; log("📈 Taux d'intérêt en hausse ! Crédit plus cher"); }, minClicks: 3000, maxClicks: 999999, probability: 0.05 },
            { name: "Inflation générale", effect: () => { gameState.money *= 0.9; log("💹 Inflation généralisée ! -10% de monnaie"); }, minClicks: 3000, maxClicks: 999999, probability: 0.05 },
            { name: "Demande export", effect: () => { gameState.money += 1500; log("🌍 Demande explosive à l'export ! +1500€"); }, minClicks: 3000, maxClicks: 999999, probability: 0.04 },
            { name: "Marché saturé", effect: () => { gameState.productionMultiplier *= 0.7; log("📊 Marché saturé ! Ventes impossibles"); }, minClicks: 3000, maxClicks: 999999, probability: 0.04 },
            { name: "Grève transporteurs", effect: () => { gameState.resources -= 20; log("🚚 Grève des transporteurs ! Ressources bloquées"); }, minClicks: 3000, maxClicks: 999999, probability: 0.04 },
            { name: "Récompense employeur", effect: () => { gameState.money += 800; gameState.comfort += 10; log("🏆 Récompense du meilleur employeur ! +800€ et confort +10"); }, minClicks: 3000, maxClicks: 999999, probability: 0.03 },
            { name: "Rumeur produit défectueux", effect: () => { gameState.money -= 600; log("📢 Rumeur sur un produit défectueux ! -600€"); }, minClicks: 3000, maxClicks: 999999, probability: 0.04 },
            { name: "Hackathon réussi", effect: () => { gameState.productionMultiplier *= 1.15; log("💻 Hackathon réussi ! Production +15%"); }, minClicks: 3000, maxClicks: 999999, probability: 0.03 },
            { name: "Bug compta", effect: () => { const change = Math.random() > 0.5 ? 400 : -400; gameState.money += change; log(`📊 Bug dans la compta ! ${change > 0 ? '+' : ''}${change}€`); }, minClicks: 3000, maxClicks: 999999, probability: 0.04 },
            { name: "Perte données clients", effect: () => { gameState.money -= 1200; gameState.comfort -= 25; log("💾 Perte de données clients ! -1200€ et confort -25"); }, minClicks: 3000, maxClicks: 999999, probability: 0.04 },
            { name: "Panne serveur", effect: () => { gameState.productionMultiplier *= 0.5; log("🖥️ Panne serveur ! Automatisations en pause"); }, minClicks: 3000, maxClicks: 999999, probability: 0.04 },
            { name: "Succès viral réseaux", effect: () => { gameState.money += 2000; log("📱 Succès viral sur les réseaux ! +2000€"); }, minClicks: 3000, maxClicks: 999999, probability: 0.02 },
            { name: "Détournement interne", effect: () => { gameState.money -= 1500; log("🕵️ Détournement interne ! -1500€"); }, minClicks: 3000, maxClicks: 999999, probability: 0.03 },
            { name: "Grève managers", effect: () => { gameState.productionMultiplier *= 0.6; log("👔 Grève des managers ! Actions spéciales impossibles"); }, minClicks: 3000, maxClicks: 999999, probability: 0.04 },
            { name: "Rachat concurrent", effect: () => { gameState.money += 3000; gameState.productionMultiplier *= 1.1; log("🏢 Rachat d'un concurrent ! +3000€ et production +10%"); }, minClicks: 3000, maxClicks: 999999, probability: 0.02 },
            { name: "Nouvel impôt", effect: () => { gameState.money -= 800; log("🏛️ Nouvel impôt voté ! -800€"); }, minClicks: 3000, maxClicks: 999999, probability: 0.04 },
            { name: "Appel offre remporté", effect: () => { gameState.money += 2500; log("📄 Appel d'offre remporté ! +2500€"); }, minClicks: 3000, maxClicks: 999999, probability: 0.02 },
            { name: "Rumeurs licenciements", effect: () => { gameState.productionMultiplier *= 0.8; gameState.comfort -= 15; log("📰 Rumeurs de licenciements ! Production -20% et confort -15"); }, minClicks: 3000, maxClicks: 999999, probability: 0.04 },
            { name: "Épidémie", effect: () => { gameState.productionMultiplier *= 0.7; log("🦠 Épidémie ! Absentéisme massif"); }, minClicks: 3000, maxClicks: 999999, probability: 0.03 },
            { name: "Surcharge travail", effect: () => { gameState.productionMultiplier *= 0.75; gameState.comfort -= 20; log("😰 Surcharge de travail ! Efficacité -25% et confort -20"); }, minClicks: 3000, maxClicks: 999999, probability: 0.04 },
            { name: "Oubli échéance", effect: () => { gameState.money -= 300; gameState.interestRate *= 1.1; log("💳 Oubli d'une échéance bancaire ! -300€ et taux +10%"); }, minClicks: 3000, maxClicks: 999999, probability: 0.04 },
            { name: "Coup génie salarié", effect: () => { gameState.productionMultiplier *= 1.25; log("💡 Coup de génie d'un salarié ! Production +25%"); }, minClicks: 3000, maxClicks: 999999, probability: 0.02 },
            { name: "Fuite cerveau", effect: () => { gameState.productionMultiplier *= 0.85; log("🧠 Fuite de cerveau ! Perte de talents -15%"); }, minClicks: 3000, maxClicks: 999999, probability: 0.04 },
            { name: "Vague candidatures", effect: () => { gameState.productionMultiplier *= 1.1; log("📝 Vague de candidatures spontanées ! Recrutement facilité +10%"); }, minClicks: 3000, maxClicks: 999999, probability: 0.03 },
            { name: "Détournement associé", effect: () => { gameState.money -= 2000; log("💸 Détournement de fonds par un associé ! -2000€"); }, minClicks: 3000, maxClicks: 999999, probability: 0.02 },
            { name: "Arnaque commande", effect: () => { gameState.money -= 800; gameState.resources -= 10; log("🎭 Arnaque à la commande ! -800€ et ressources perdues"); }, minClicks: 3000, maxClicks: 999999, probability: 0.03 },
            { name: "Grève SAV", effect: () => { gameState.comfort -= 30; log("📞 Grève du SAV ! Confort -30"); }, minClicks: 3000, maxClicks: 999999, probability: 0.04 },
            { name: "Pénurie matériel", effect: () => { gameState.productionMultiplier *= 0.8; gameState.money -= 400; log("📦 Pénurie de matériel ! Production -20% et coûts +400€"); }, minClicks: 3000, maxClicks: 999999, probability: 0.04 },
            { name: "Inflation salaires", effect: () => { gameState.money -= 600; log("💰 Inflation des salaires ! Coûts employés +600€"); }, minClicks: 3000, maxClicks: 999999, probability: 0.04 },
            { name: "Erreur inventaire", effect: () => { const change = Math.random() > 0.5 ? 15 : -15; gameState.resources += change; log(`📊 Erreur d'inventaire ! ${change > 0 ? '+' : ''}${change} ressources`); }, minClicks: 3000, maxClicks: 999999, probability: 0.04 }
        ];

        function updateDisplay() {
            const statsContainer = document.getElementById('stats');
            const actionsContainer = document.getElementById('actions');
            
            // Update stats
            const nature = Math.max(0, 100 - Math.floor(gameState.production / 5));
            statsContainer.innerHTML = `
                <div class="stat">
                    <div class="stat-value ${gameState.money >= 0 ? 'positive' : 'negative'}">${Math.floor(gameState.money)}€</div>
                    <div>Monnaie</div>
                </div>
                <div class="stat">
                    <div class="stat-value">${Math.floor(gameState.resources)}</div>
                    <div>Ressources</div>
                </div>
                <div class="stat">
                    <div class="stat-value">${Math.floor(gameState.production)}</div>
                    <div>Production</div>
                </div>
                <div class="stat">
                    <div class="stat-value ${gameState.comfort < 30 ? 'negative' : gameState.comfort < 60 ? 'warning' : 'positive'}">${Math.floor(gameState.comfort)}</div>
                    <div>Confort</div>
                </div>
                <div class="stat">
                    <div class="stat-value ${nature < 30 ? 'negative' : nature < 60 ? 'warning' : 'positive'}">${nature}</div>
                    <div>Nature</div>
                </div>
                <div class="stat">
                    <div class="stat-value">${gameState.clicks}</div>
                    <div>Clics</div>
                </div>
            `;
            
            // Update actions
            let buttonsHtml = '';
            
            if (!gameState.hasInitialGift) {
                buttonsHtml += `<button onclick="receiveGift()">🎁 Recevoir mon don</button>`;
            }
            
            if (gameState.hasInitialGift) {
                buttonsHtml += `<button onclick="produce()">🏭 Produire</button>`;
                buttonsHtml += `<button onclick="sell()">💰 Vendre</button>`;
                
                if (gameState.money >= 10) {
                    buttonsHtml += `<button onclick="buyComfort()">😌 Acheter confort (10€)</button>`;
                }
            }
            
            // Boutons d'amélioration
            if (gameState.clicks >= 250 && gameState.money >= -500 && !gameState.hasAI) {
                buttonsHtml += `<button onclick="buyAI()" class="upgrade-btn">🤖 Engager une IA (500 €)</button>`;
            }
            
            if (gameState.clicks >= 500 && gameState.money >= -1000 && !gameState.hasAutoTrader) {
                buttonsHtml += `<button onclick="buyAutoTrader()" class="upgrade-btn">📈 Acheter un trader auto (1000 €)</button>`;
            }
            
            if (gameState.clicks >= 600 && gameState.money >= -2000 && !gameState.hasProductionUpgrade) {
                buttonsHtml += `<button onclick="upgradeProduction()" class="upgrade-btn">⚡ Améliorer production (2000 €)</button>`;
            }
            
            if (gameState.clicks >= 900 && gameState.money >= -1500 && !gameState.hasAutoComfort) {
                buttonsHtml += `<button onclick="buyAutoComfort()" class="upgrade-btn">😎 Achat confort auto (1500 €)</button>`;
            }
            
            if (gameState.clicks >= 750 && gameState.money >= -10000 && !gameState.autoCountsAsClicks) {
                buttonsHtml += `<button onclick="enableAutoClicks()" class="upgrade-btn">🔄 Les automatismes comptent comme des clics (10 000 €)</button>`;
            }
            
            if (gameState.clicks >= 1000 && gameState.money >= -30000 && !gameState.hasPriceIndicator) {
                buttonsHtml += `<button onclick="buyPriceIndicator()" class="upgrade-btn">📊 Indicateur de prix (30 000 €)</button>`;
            }
            
            // Usines et marchés
            if (gameState.clicks >= 1500 && gameState.money >= -20000) {
                buttonsHtml += `<button onclick="buyFactory()" class="upgrade-btn">🏭 Usine de production ×10 (20 000 €)</button>`;
            }
            
            if (gameState.clicks >= 1600 && gameState.money >= -20000) {
                buttonsHtml += `<button onclick="buyMarket()" class="upgrade-btn">🏪 Marché de trading ×10 vente (20 000 €)</button>`;
            }
            
            // Négociation taux d'intérêt
            if (gameState.clicks >= 3000 && gameState.interestNegotiations < 4 && gameState.comfort >= 20) {
                buttonsHtml += `<button onclick="negotiateInterest()" class="upgrade-btn">💼 Négocier taux d'intérêt (coût: 20 confort)</button>`;
            }
            
            actionsContainer.innerHTML = buttonsHtml;
        }

        function log(message) {
            const logContainer = document.getElementById('log');
            const entry = document.createElement('div');
            entry.className = 'log-entry';
            entry.innerHTML = `<span style="opacity: 0.7">[${new Date().toLocaleTimeString()}]</span> ${message}`;
            logContainer.appendChild(entry);
            logContainer.scrollTop = logContainer.scrollHeight;
            
            // Garder seulement les 50 derniers messages
            while (logContainer.children.length > 50) {
                logContainer.removeChild(logContainer.firstChild);
            }
        }

        function receiveGift() {
            gameState.money = 100;
            gameState.hasInitialGift = true;
            gameState.clicks++;
            log("🎁 Don initial reçu ! +100€");
            updateDisplay();
            checkRandomEvent();
        }

        function produce() {
            if (gameState.comfort <= 0) {
                log("❌ Impossible de produire ! Confort trop bas");
                return;
            }
            
            const productionAmount = (1 + gameState.factories) * gameState.productionMultiplier;
            gameState.resources += productionAmount;
            gameState.production += productionAmount;
            gameState.comfort = Math.max(0, gameState.comfort - 1);
            gameState.clicks++;
            log(`🏭 Production : +${productionAmount.toFixed(1)} ressources`);
            updateDisplay();
            checkRandomEvent();
        }

        function sell() {
            if (gameState.resources <= 0) {
                log("❌ Aucune ressource à vendre !");
                return;
            }
            
            const sellAmount = Math.min(gameState.resources, 1 + gameState.markets);
            const price = gameState.hasPriceIndicator ? Math.random() * 20 + 10 : Math.random() * 15 + 5;
            const earnings = sellAmount * price;
            
            gameState.resources -= sellAmount;
            gameState.money += earnings;
            gameState.clicks++;
            log(`💰 Vente : ${sellAmount.toFixed(1)} ressources pour ${earnings.toFixed(2)}€`);
            updateDisplay();
            checkRandomEvent();
        }

        function buyComfort() {
            if (gameState.money >= 10) {
                gameState.money -= 10;
                gameState.comfort = Math.min(100, gameState.comfort + 5);
                gameState.clicks++;
                log("😌 Confort acheté ! +5 confort");
                updateDisplay();
                checkRandomEvent();
            }
        }

        function buyAI() {
            if (gameState.money >= -500) {
                gameState.money -= 500;
                gameState.hasAI = true;
                log("🤖 IA engagée ! Production automatique activée");
                updateDisplay();
            }
        }

        function buyAutoTrader() {
            if (gameState.money >= -1000) {
                gameState.money -= 1000;
                gameState.hasAutoTrader = true;
                log("📈 Trader automatique acheté ! Vente automatique activée");
                updateDisplay();
            }
        }

        function upgradeProduction() {
            if (gameState.money >= -2000) {
                gameState.money -= 2000;
                gameState.hasProductionUpgrade = true;
                gameState.productionMultiplier *= 1.5;
                log("⚡ Production améliorée ! Efficacité +50%");
                updateDisplay();
            }
        }

        function buyAutoComfort() {
            if (gameState.money >= -1500) {
                gameState.money -= 1500;
                gameState.hasAutoComfort = true;
                log("😎 Achat confort automatique activé !");
                updateDisplay();
            }
        }

        function enableAutoClicks() {
            if (gameState.money >= -10000) {
                gameState.money -= 10000;
                gameState.autoCountsAsClicks = true;
                log("🔄 Les automatismes comptent maintenant comme des clics !");
                updateDisplay();
            }
        }

        function buyPriceIndicator() {
            if (gameState.money >= -30000) {
                gameState.money -= 30000;
                gameState.hasPriceIndicator = true;
                log("📊 Indicateur de prix acheté ! Meilleurs prix de vente !");
                updateDisplay();
            }
        }

        function buyFactory() {
            if (gameState.money >= -20000) {
                gameState.money -= 20000;
                gameState.factories++;
                log(`🏭 Usine construite ! Production ×${gameState.factories + 1}`);
                updateDisplay();
            }
        }

        function buyMarket() {
            if (gameState.money >= -20000) {
                gameState.money -= 20000;
                gameState.markets++;
                log(`🏪 Marché ouvert ! Vente ×${gameState.markets + 1}`);
                updateDisplay();
            }
        }

        function negotiateInterest() {
            if (gameState.comfort >= 20) {
                gameState.comfort -= 20;
                gameState.interestRate *= 0.8;
                gameState.interestNegotiations++;
                log(`💼 Taux d'intérêt négocié ! Nouveau taux: ${(gameState.interestRate * 100).toFixed(2)}%`);
                updateDisplay();
            }
        }

        function checkRandomEvent() {
            // Événements plus fréquents selon la phase
            let eventChance = 0.02; // Base 2%
            if (gameState.clicks > 3000) eventChance = 0.08; // 8% après 3000 clics
            else if (gameState.clicks > 1000) eventChance = 0.05; // 5% après 1000 clics
            else if (gameState.clicks > 500) eventChance = 0.03; // 3% après 500 clics
            
            if (Math.random() < eventChance && gameState.clicks - gameState.lastEventClick > 50) {
                const possibleEvents = randomEvents.filter(event => 
                    gameState.clicks >= event.minClicks && 
                    gameState.clicks <= event.maxClicks &&
                    Math.random() < event.probability
                );
                
                if (possibleEvents.length > 0) {
                    const randomEvent = possibleEvents[Math.floor(Math.random() * possibleEvents.length)];
                    randomEvent.effect();
                    gameState.lastEventClick = gameState.clicks;
                    updateDisplay();
                }
            }
        }

        function handleDebt() {
            if (gameState.money < 0) {
                gameState.debt = Math.abs(gameState.money);
                const interest = gameState.debt * gameState.interestRate;
                gameState.money -= interest;
                if (Math.random() < 0.1) {
                    log(`💳 Intérêts sur la dette : -${interest.toFixed(2)}€`);
                }
            }
        }

        function checkCrises() {
            if (gameState.comfort < 10) {
                log("🚨 CRISE SOCIALE ! Confort critique !");
                gameState.productionMultiplier *= 0.8;
            }
            
            const nature = 100 - Math.floor(gameState.production / 5);
            if (nature < 10) {
                log("🌍 CRISE ÉCOLOGIQUE ! Impact environnemental critique !");
                gameState.productionMultiplier *= 0.9;
            }
            
            if (gameState.debt > 10000) {
                log("💸 CRISE FINANCIÈRE ! Dette trop élevée !");
                gameState.productionMultiplier *= 0.7;
            }
        }

        // Automation
        setInterval(() => {
            if (gameState.hasAI && gameState.hasInitialGift) {
                produce();
                if (gameState.autoCountsAsClicks) {
                    gameState.clicks++;
                }
            }
            if (gameState.hasAutoTrader && gameState.hasInitialGift) {
                sell();
                if (gameState.autoCountsAsClicks) {
                    gameState.clicks++;
                }
            }
            if (gameState.hasAutoComfort && gameState.hasInitialGift) {
                if (gameState.money >= 10) {
                    gameState.money -= 10;
                    gameState.comfort = Math.min(100, gameState.comfort + 5);
                    if (gameState.autoCountsAsClicks) {
                        gameState.clicks++;
                    }
                }
            }
            updateDisplay();
        }, 2000);

        // Debt and crisis management
        setInterval(() => {
            handleDebt();
            checkCrises();
            updateDisplay();
        }, 5000);

    </script>
</body>
</html>
