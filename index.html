<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Looop v1.26.5 – Événements Aléatoires</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body { background: #f3f3f3; font-family: sans-serif; margin:0; padding:0; }
    h1 { text-align: center; margin: 25px 0 10px; }
    .container { display: flex; justify-content: center; align-items: flex-start; margin: 0 auto 18px auto; max-width: 950px; gap: 24px;}
    .category { background: #fff; border-radius: 18px; box-shadow: 0 4px 24px #0001; flex: 1; padding: 32px 18px 18px 18px; margin: 0 6px; min-width: 250px; max-width: 320px; min-height: 250px; display: flex; flex-direction: column; align-items: center;}
    .cat-title { font-size: 1.25em; margin-bottom: 20px; font-weight: bold; letter-spacing: 1px;}
    .stock { font-size: 1.1em; margin-bottom: 10px;}
    .products-box { background: #f7f7fa; border: 2px solid #dde1eb; border-radius: 10px; color: #333; margin-bottom: 10px; padding: 10px 28px; font-size: 1.2em; font-weight: bold; letter-spacing: 1px; box-shadow: 0 1px 4px #ddd5; min-width: 110px; text-align: center;}
    .message-box { border-radius: 10px; margin: 8px 0 14px 0; padding: 11px 14px 11px 14px; font-weight: bold; font-size: 1.08em; box-shadow: 0 1px 4px #0002; text-align: center; min-width: 130px; max-width: 260px; word-break: break-word; line-height: 1.25em;}
    .msg-orange { background: #ffe9cf; color: #d2691e; border: 2px solid #f5c387;}
    .msg-blue { background: #e7f4ff; color: #0978c6; border: 2px solid #7cc8fa;}
    .msg-red { background: #ffe3e3; color: #c00; border: 2px solid #e48888;}
    .msg-brown { background: #fff4d6; color: #be8c00; border: 2px solid #e2c071;}
    .msg-green { background: #e8f5e8; color: #2e7d32; border: 2px solid #81c784;}
    .msg-purple { background: #f3e5f5; color: #7b1fa2; border: 2px solid #ba68c8;}
    .btn-row { margin: 18px 0 0 0;}
    button { font-size: 1em; padding: 10px 18px; margin: 5px 0; border-radius: 14px; border: none; background: #ededed; color: #111; cursor: pointer; transition: background 0.2s;}
    .btn-yellow { background: #FFD600; color: #222; font-weight: bold;}
    .btn-annuler { background: #aaa; color: #fff; }
    .btn-credit { background: #ff6b35; color: #fff; font-weight: bold;}
    .btn-evolution { background: #4CAF50; color: #fff; font-weight: bold;}
    .debug-row { margin: 0 0 32px 0; display: flex; justify-content: center; gap: 10px;}
    .message { font-weight: bold; min-height: 24px; margin: 10px 0;}
    #clics-container { text-align: center; margin: 25px 0 0 0; font-size: 1.2em; font-weight: bold; color: #333;}
    #don-btn { margin-top: 10px; background: #FFD600; color: #222; font-weight: bold; border: none; border-radius: 8px; font-size: 1.1em; padding: 14px 20px;}
    #triche-sep { border: none; border-top: 3px solid #222; margin: 38px auto 12px auto; width: 94vw; max-width: 1000px;}
    #triche-label { text-align: left; font-size:1.13em; font-weight:normal; letter-spacing:1px; margin: 0 0 12px 0; color:#111; width: 95vw; max-width: 1000px; margin-left: auto; margin-right: auto;}
    #event-display { margin: 20px auto; max-width: 600px; padding: 0 20px; text-align: center; }
    .automatisms-controls { margin: 15px auto 15px auto; max-width: 950px; display: none; justify-content: center; gap: 20px; flex-wrap: wrap; padding: 15px; background: #fff; border-radius: 12px; box-shadow: 0 2px 12px #0001;}
    .control-btn { font-size: 0.9em; padding: 8px 12px; border-radius: 8px; border: none; cursor: pointer; transition: all 0.2s; min-width: 80px;}
    .control-btn.active { background: #4CAF50; color: white; }
    .control-btn.inactive { background: #f44336; color: white; }
    .control-btn.disabled { background: #ccc; color: #888; cursor: not-allowed; }
    .jauge-bottom-barre { margin: 0 auto 6px auto; display: flex; flex-direction: row; align-items: center; gap: 8px; max-width: 600px;}
    .jauge-bottom-label { min-width: 70px; font-size: .99em; color: #888; text-align: right;}
    .jauge-bottom-bar { background: #eee; border-radius: 8px; height: 13px; flex: 1; overflow: hidden; position: relative;}
    .jauge-bottom-fill { height: 100%; border-radius: 8px; transition: width 0.19s;}
    #jauge-nature { background: #86e08e;}
    #jauge-confort { background: #86b6ea;}
    #jauge-money { background: #ffb3b3;}
    #jauge-achat-auto { background: #ffa726;}
    #jauge-ia { background: #ab47bc;}
    #jauge-trader { background: #26c6da;}
    #jauge-centre { background: #66bb6a;}
    #jauge-budget-etat { background: #ff9800;}
    #jauge-tech { background: #9c27b0;}
    .hidden { display: none; }
  </style>
</head>
<body>
  <h1>🌍 Looop <span style="font-size:0.7em;color:#777;">v1.26.2 avec Événements Aléatoires</span></h1>
  <div id="event-display">
    <div id="event-message" class="message-box" style="display: none;"></div>
  </div>
  <div class="automatisms-controls" id="automatisms-controls">
    <button class="control-btn disabled" id="control-ia" onclick="toggleAutomatism('ia')">🤖 IA: OFF</button>
    <button class="control-btn disabled" id="control-trader" onclick="toggleAutomatism('trader')">💰 Trader: OFF</button>
    <button class="control-btn disabled" id="control-confort" onclick="toggleAutomatism('confort')">🛋️ Confort: OFF</button>
    <button class="control-btn disabled" id="control-centre" onclick="toggleAutomatism('centre')">🏬 Centre: OFF</button>
  </div>
  <div class="container">
    <div class="category">
      <div class="cat-title">🌱 Environnement</div>
      <div class="stock">Ressources : <span id="nature">3000</span></div>
      <div id="alert-crise" class="message-box msg-orange" style="display:none;"></div>
      <div class="btn-row">
        <button id="produce-btn" onclick="produce()">🛠️ Produire</button>
      </div>
    </div>
    <div class="category">
      <div class="cat-title">🤖 Exosomatisation</div>
      <div class="stock">Confort : <span id="confort">0</span></div>
      <div class="products-box">
        Produits créés<br>
        <span id="production">0</span>
      </div>
      <div id="social-crise" class="message-box msg-brown" style="display:none;"></div>
      <div class="btn-row">
        <button id="comfort-btn" onclick="acheterConfort()" style="display:none;">🛋️ Achat (100 €)</button>
        <button id="sell-btn" onclick="sell()">💶 Vendre</button>
      </div>
    </div>
    <div class="category">
      <div class="cat-title">💶 Économie</div>
      <div class="stock" id="money-row" style="display:none;">
        Monnaie (€) : <span id="money">10</span>
      </div>
      <div class="stock" id="budget-etat-row" style="display:none;">
        Budget de l'État : <span id="budget-etat">0</span> €
      </div>
      <div class="products-box" id="price-indicator-box" style="display:none;">
        Prix de vente<br>
        <span id="current-price">1€</span>
      </div>
      <button id="don-btn" onclick="receiveDon()">Recevoir mon don</button>
      <button id="credit-btn" onclick="activateCredit()" style="display:none;" class="btn-credit">💳 Effectuer un crédit</button>
      <div id="eh-msg" class="message-box msg-blue" style="display:none;"></div>
      <div id="eh-success" class="message-box msg-green" style="display:none;"></div>
      <div id="game-over-resources" class="message-box msg-red" style="display:none;"></div>
      <div id="game-over-confort" class="message-box msg-red" style="display:none;"></div>
      <div class="btn-row">
        <button id="ouvrier-btn" onclick="acheterIA()" style="display:none;">🤖 Engager une IA (500 €)</button>
        <button id="trader-btn" onclick="acheterTrader()" style="display:none;">🤖 Trader automatique (1 000 €)</button>
        <button id="comfort-auto-btn" onclick="acheterConfortAuto()" style="display:none;">🔄 Achat auto confort (2 000 €)</button>
        <button id="upgrade-btn2" onclick="upgradeProd2()" style="display:none;">💠 Améliorer la production (2 000 €)</button>
        <button id="automatisms-btn" onclick="acheterAutomatismsClics()" style="display:none;">⚡ Automatismes = clics (10 000 €)</button>
        <button id="centre-commercial-btn" onclick="acheterCentreCommercial()" style="display:none;">🏬 Centre commercial (5 000 €)</button>
        <button id="price-indicator-btn" onclick="acheterIndicateurPrix()" style="display:none;">📊 Indicateur de prix (30 000 €)</button>
        <button id="evolution-btn" onclick="evolution()" style="display:none;" class="btn-evolution">🌱 Évolution économique</button>
        <button id="rescue-eh-btn" onclick="activateRescueEH()" style="display:none;" class="btn-evolution">🌱 Passer à l'économie homéostatique</button>
      </div>
    </div>
  </div>
  <div id="jauges-zone" style="margin: 0 auto 14px auto; max-width:620px;">
    <div class="jauge-bottom-barre">
      <div class="jauge-bottom-label">🌱 Ressources</div>
      <div class="jauge-bottom-bar"><div class="jauge-bottom-fill" id="jauge-nature"></div></div>
      <div class="jauge-bottom-val" id="jauge-nature-txt"></div>
    </div>
    <div class="jauge-bottom-barre" id="jauge-confort-container" style="display:none;">
      <div class="jauge-bottom-label">🤖 Confort</div>
      <div class="jauge-bottom-bar"><div class="jauge-bottom-fill" id="jauge-confort"></div></div>
      <div class="jauge-bottom-val" id="jauge-confort-txt"></div>
    </div>
    <div class="jauge-bottom-barre" id="jauge-money-container" style="display:none;">
      <div class="jauge-bottom-label">💶 Monnaie</div>
      <div class="jauge-bottom-bar"><div class="jauge-bottom-fill" id="jauge-money"></div></div>
      <div class="jauge-bottom-val" id="jauge-money-txt"></div>
    </div>
    <div class="jauge-bottom-barre" id="jauge-budget-etat-container" style="display:none;">
      <div class="jauge-bottom-label">🏛️ Budget État</div>
      <div class="jauge-bottom-bar"><div class="jauge-bottom-fill" id="jauge-budget-etat"></div></div>
      <div class="jauge-budget-etat-val" id="jauge-budget-etat-txt"></div>
    </div>
    <div class="jauge-bottom-barre" id="jauge-achat-auto-container" style="display:none;">
      <div class="jauge-bottom-label">🔄 Achat auto</div>
      <div class="jauge-bottom-bar"><div class="jauge-bottom-fill" id="jauge-achat-auto"></div></div>
      <div class="jauge-bottom-val" id="jauge-achat-auto-txt"></div>
    </div>
    <div class="jauge-bottom-barre" id="jauge-ia-container" style="display:none;">
      <div class="jauge-bottom-label">🤖 IA</div>
      <div class="jauge-bottom-bar"><div class="jauge-bottom-fill" id="jauge-ia"></div></div>
      <div class="jauge-bottom-val" id="jauge-ia-txt"></div>
    </div>
    <div class="jauge-bottom-barre" id="jauge-trader-container" style="display:none;">
      <div class="jauge-bottom-label">💰 Trader</div>
      <div class="jauge-bottom-bar"><div class="jauge-bottom-fill" id="jauge-trader"></div></div>
      <div class="jauge-bottom-val" id="jauge-trader-txt"></div>
    </div>
    <div class="jauge-bottom-barre" id="jauge-centre-container" style="display:none;">
      <div class="jauge-bottom-label">🏬 Centre</div>
      <div class="jauge-bottom-bar"><div class="jauge-bottom-fill" id="jauge-centre"></div></div>
      <div class="jauge-bottom-val" id="jauge-centre-txt"></div>
    </div>
    <div class="jauge-bottom-barre" id="jauge-tech-container" style="display:none;">
      <div class="jauge-bottom-label">💠 Niveau technologique</div>
      <div class="jauge-bottom-bar"><div class="jauge-bottom-fill" id="jauge-tech"></div></div>
      <div class="jauge-bottom-val" id="jauge-tech-txt"></div>
    </div>
  </div>
  <div class="message" id="message"></div>
  <div id="clics-container">Clics/actions : <span id="clicks">0</span></div>
  <hr id="triche-sep">
  <div id="triche-label">Triche / Debug</div>
  <div class="debug-row">
    <button class="btn-yellow" onclick="addMoney()">+1000 crédits (test)</button>
    <button class="btn-yellow" onclick="addOneNature()">+100 ressources (test)</button>
    <button class="btn-yellow" onclick="addClicks50()">Clics +50 (test)</button>
    <button class="btn-annuler" onclick="undoAction()">⏪ Annuler le clic précédent</button>
    <button class="btn-yellow" onclick="triggerTestEvent()">🎲 Déclencher événement test</button>
  </div>
<script>
/* ===== LOGIQUE COMPLETE DU JEU AVEC EVENEMENTS ALEATOIRES ===== */
// Variables globales
var gameState = {
  nature: 3000, confort: 0, production: 0, money: 10, clicks: 0,
  budgetEtat: 0, confortMaxAtteint: 0,
  monnaieActive: false, creditUnlocked: false, jeuBloque: false, criseSocialeActive: false, ehActivated: false,
  gameOver: false, gameOverCause: null,
  ia: 0, traderAuto: 0, confortAuto: 0, centreCommercial: 0,
  techLevel: 0, productionMultiplier: 1, automatismsGenerateClicks: false, priceIndicatorActive: false,
  nbAchatIA: 0, nbAchatTrader: 0, nbAchatConfortAuto: 0, nbAchatUpgradeProd: 0, nbAchatCentre: 0,
  paliersDebloque: {
    comfort: false, ia: false, trader: false, upgradeProd: false, confortAuto: false,
    automatismsClics: false, priceIndicator: false, centreCommercial: false
  }
};
var lastMsgTimeout = null;

// Événements aléatoires (exemples : tu peux en ajouter !)
const randomEvents = [
  { txt: "Découverte d'une source d'énergie renouvelable ! +250 ressources", eff: ()=>{ gameState.nature += 250; }},
  { txt: "Panne industrielle : -300 ressources", eff: ()=>{ gameState.nature = Math.max(0, gameState.nature-300); }},
  { txt: "Prime innovation : +1000 €", eff: ()=>{ gameState.money += 1000; }},
  { txt: "Grève : -5 confort", eff: ()=>{ gameState.confort = Math.max(0, gameState.confort-5); }},
  { txt: "Taxe carbone : -800 €", eff: ()=>{ gameState.money = Math.max(0, gameState.money-800); }},
  { txt: "Boom social : +20 confort", eff: ()=>{ gameState.confort += 20; }},
  { txt: "Inflation surprise : tous les prix augmentent !", eff: ()=>{ gameState.productionMultiplier *= 1.10; }},
  { txt: "Effondrement boursier : -1500 €", eff: ()=>{ gameState.money = Math.max(0, gameState.money-1500); }},
  { txt: "Avancée technologique : production +20 %", eff: ()=>{ gameState.productionMultiplier *= 1.2; }},
  { txt: "Pollution accidentelle : -600 ressources", eff: ()=>{ gameState.nature = Math.max(0, gameState.nature-600); }},
  { txt: "Aide européenne : +300 confort", eff: ()=>{ gameState.confort += 30; }},
  { txt: "Cyberattaque : -600 €", eff: ()=>{ gameState.money = Math.max(0, gameState.money-600); }},
  { txt: "Subvention publique : +2000 €", eff: ()=>{ gameState.money += 2000; }},
  { txt: "Innovation circulaire : +200 ressources", eff: ()=>{ gameState.nature += 200; }},
  { txt: "Catastrophe naturelle : -1200 ressources", eff: ()=>{ gameState.nature = Math.max(0, gameState.nature-1200); }},
  { txt: "Scandale social : -18 confort", eff: ()=>{ gameState.confort = Math.max(0, gameState.confort-18); }},
  { txt: "Réseau solidaire : +6 confort", eff: ()=>{ gameState.confort += 6; }},
  { txt: "Pénurie matières premières : -700 ressources", eff: ()=>{ gameState.nature = Math.max(0, gameState.nature-700); }},
  { txt: "Manifestation massive : -14 confort", eff: ()=>{ gameState.confort = Math.max(0, gameState.confort-14); }},
  { txt: "Dons citoyens : +600 €", eff: ()=>{ gameState.money += 600; }}
];

// Fonction pour tirer un événement aléatoire (1 chance sur 6 à chaque clic)
function triggerRandomEvent() {
  if (Math.random() < 1/6) {
    let evt = randomEvents[Math.floor(Math.random()*randomEvents.length)];
    evt.eff();
    showEvent(evt.txt);
    updateAll();
  }
}

// Affichage événement
function showEvent(txt) {
  let emsg = document.getElementById("event-message");
  emsg.textContent = txt;
  emsg.style.display = "block";
  setTimeout(()=>{ emsg.style.display = "none"; }, 4000);
}

// Debug bouton pour déclencher événement test
function triggerTestEvent() {
  let evt = randomEvents[Math.floor(Math.random()*randomEvents.length)];
  evt.eff(); showEvent(evt.txt); updateAll();
}

// Affichage message principal
function showMsg(type, txt) {
  let box = document.getElementById("message");
  if (!box) return;
  box.className = "message-box " + type;
  box.innerHTML = txt;
  if (lastMsgTimeout) clearTimeout(lastMsgTimeout);
  lastMsgTimeout = setTimeout(()=>{ box.innerHTML=""; }, 2700);
}

// ----- Fonctions de jeu principales (production, vente, achats, etc.) -----

function updateAll() {
  document.getElementById("nature").textContent = gameState.nature;
  document.getElementById("confort").textContent = gameState.confort;
  document.getElementById("production").textContent = gameState.production;
  document.getElementById("money").textContent = gameState.money;
  document.getElementById("budget-etat").textContent = gameState.budgetEtat;
  document.getElementById("clicks").textContent = gameState.clicks;

  // Mise à jour jauges
  let nmax = 6000, cmax = 300, mmax = 25000;
  setJauge("jauge-nature", gameState.nature / nmax, gameState.nature);
  setJauge("jauge-confort", gameState.confort / cmax, gameState.confort);
  setJauge("jauge-money", gameState.money / mmax, gameState.money);
  setJauge("jauge-budget-etat", gameState.budgetEtat / 10000, gameState.budgetEtat);

  document.getElementById("comfort-btn").style.display = (gameState.money >= 100) ? "" : "none";
  document.getElementById("money-row").style.display = "";
  document.getElementById("budget-etat-row").style.display = "";
  document.getElementById("jauge-confort-container").style.display = "";
  document.getElementById("jauge-money-container").style.display = "";
  document.getElementById("jauge-budget-etat-container").style.display = "";

  if (gameState.production >= 10) document.getElementById("sell-btn").disabled = false;
  else document.getElementById("sell-btn").disabled = true;
}
function setJauge(id, ratio, val) {
  let el = document.getElementById(id);
  if (!el) return;
  el.style.width = Math.max(5, Math.min(100, Math.round(ratio * 100))) + "%";
  let txt = document.getElementById(id + "-txt");
  if (txt) txt.textContent = val;
}
function produce() {
  if (gameState.jeuBloque) return;
  if (gameState.nature < 10) {
    showMsg("msg-red", "Pas assez de ressources !");
    return;
  }
  gameState.nature -= 10;
  let prod = Math.round(1 * gameState.productionMultiplier);
  gameState.production += prod;
  gameState.clicks++;
  triggerRandomEvent();
  updateAll();
}
function sell() {
  if (gameState.production < 10) {
    showMsg("msg-red", "Pas assez de produits à vendre !");
    return;
  }
  let nb = Math.min(10, gameState.production);
  gameState.production -= nb;
  let prix = 1 * nb;
  gameState.money += prix;
  showMsg("msg-blue", "Vente réussie (" + nb + " produits, +" + prix + " €)");
  updateAll();
}
function acheterConfort() {
  if (gameState.money < 100) {
    showMsg("msg-red", "Pas assez de monnaie !");
    return;
  }
  gameState.money -= 100;
  gameState.confort += 3;
  updateAll();
}
function acheterIA() {
  if (gameState.money < 500) { showMsg("msg-red", "Pas assez d'argent"); return; }
  gameState.money -= 500; gameState.ia++; showMsg("msg-green", "IA engagée !");
  updateAll();
}
function acheterTrader() {
  if (gameState.money < 1000) { showMsg("msg-red", "Pas assez d'argent"); return; }
  gameState.money -= 1000; gameState.traderAuto++; showMsg("msg-green", "Trader acheté !");
  updateAll();
}
function acheterConfortAuto() {
  if (gameState.money < 2000) { showMsg("msg-red", "Pas assez d'argent"); return; }
  gameState.money -= 2000; gameState.confortAuto++; showMsg("msg-green", "Achat auto confort !");
  updateAll();
}
function upgradeProd2() {
  if (gameState.money < 2000) { showMsg("msg-red", "Pas assez d'argent"); return; }
  gameState.money -= 2000; gameState.productionMultiplier *= 1.5; showMsg("msg-green", "Production améliorée !");
  updateAll();
}
function acheterAutomatismsClics() { showMsg("msg-blue", "Automatismes activés (simulation)."); }
function acheterCentreCommercial() { showMsg("msg-green", "Centre commercial ouvert !"); }
function acheterIndicateurPrix() { gameState.priceIndicatorActive = true; showMsg("msg-blue", "Indicateur prix activé"); updateAll(); }
function receiveDon() {
  let don = Math.max(20, Math.round(gameState.nature/100));
  gameState.money += don;
  showMsg("msg-green", "Vous recevez un don : +" + don + "€");
  updateAll();
}
function activateCredit() { showMsg("msg-orange", "Crédit simulé (fonction à implémenter)."); }
function evolution() { showMsg("msg-purple", "Évolution économique !"); }
function activateRescueEH() { showMsg("msg-purple", "Économie homéostatique activée !"); }

function addMoney() { gameState.money += 1000; updateAll(); }
function addOneNature() { gameState.nature += 100; updateAll(); }
function addClicks50() { gameState.clicks += 50; updateAll(); }
function undoAction() { showMsg("msg-brown", "Annulation : non implémentée."); }

window.onload = function() { updateAll(); };
</script>
</body>
</html>

