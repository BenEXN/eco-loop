<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Looop v1.12.0 â€“ CorrectionÂ Ã©conomie et boutons uniques</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- [Styles copiÃ© de ta version, inchangÃ© pour la clartÃ©] -->
  <style>
    /* ...[reprends tout ton CSS ici, identique Ã  l'original]... */
    /* Pour gain de place, tout ton style inchangÃ© ! */
  </style>
</head>
<body>
  <h1>ğŸŒ Looop <span style="font-size:0.7em;color:#777;">v1.12.0</span></h1>
  <div class="container">
    <!-- ... [copie tes DIV d'origine identique] ... -->
    <!-- (pas de changement dans le HTML structurel) -->
    <div class="category">
      <div class="cat-title">ğŸŒ± Environnement</div>
      <div class="stock">Ressources : <span id="nature">300</span></div>
      <div id="alert-crise" class="message-box msg-orange" style="display:none;"></div>
      <div class="btn-row">
        <button id="produce-btn" onclick="produce()">ğŸ› ï¸ Produire</button>
      </div>
    </div>
    <div class="category">
      <div class="cat-title">ğŸ¤– Exosomatisation</div>
      <div class="stock">Confort : <span id="confort">0</span></div>
      <div class="products-box">
        Produits crÃ©Ã©s<br>
        <span id="production">0</span>
      </div>
      <div class="stock" id="tech-level"></div>
      <div class="stock" id="ia-info"></div>
      <div id="venteauto-info"></div>
      <div id="social-crise" class="message-box msg-brown" style="display:none;"></div>
      <div class="btn-row">
        <button id="sell-btn" onclick="sell()">ğŸ’¶ Vente</button>
      </div>
    </div>
    <div class="category">
      <div class="cat-title">ğŸ’¶ Ã‰conomie</div>
      <div class="stock" id="money-row" style="display:none;">
        Monnaie (â‚¬) : <span id="money">10</span>
      </div>
      <div id="taux-info" style="display:none;"></div>
      <!-- Indicateur de prix -->
      <div id="price-indicator" class="price-indicator hidden">
        <strong>ğŸ“Š Prix: <span id="current-price">0</span>â‚¬/unitÃ© de production</strong>
      </div>
      <button id="don-btn" onclick="receiveDon()">Recevoir mon don</button>
      <div id="eh-msg" class="message-box msg-blue" style="display:none;"></div>
      <div class="btn-row">
        <button id="ouvrier-btn" onclick="acheterIA()">ğŸ¤– Engager une IA (500 â‚¬)</button>
        <button id="trading-btn" class="btn-trading" onclick="acheterTrader()">ğŸª Acheter un trader auto (1000 â‚¬)</button>
        <button id="upgrade-btn2" onclick="upgradeProd2()">ğŸ’  AmÃ©liorer la production (2 000 â‚¬)</button>
        <!-- Nouvelles fonctionnalitÃ©s -->
        <button id="factory-btn" class="btn-factory hidden" onclick="acheterUsine()">ğŸ­ Usine de Production (Ã—10) - 20 000 â‚¬</button>
        <button id="trading-market-btn" class="btn-trading-market hidden" onclick="acheterMarcheTrading()">ğŸ“ˆ MarchÃ© de Trading (Ã—10 vente) - 20 000 â‚¬</button>
        <button id="price-indicator-btn" class="btn-price-indicator hidden" onclick="acheterIndicateurPrix()">ğŸ“Š Indicateur de Prix - 30 000 â‚¬</button>
        <button id="auto-clicks-btn" class="btn-auto-clicks hidden" onclick="acheterAutoClicks()">âš™ï¸ Les automatismes comptent comme des clics - 10 000 â‚¬</button>
        <button id="negocier-btn" class="btn-negocier" onclick="negocierTaux()" style="display:none;">
          ğŸ“‰ NÃ©gocier son taux d'intÃ©rÃªt
          <span id="negocier-cost"></span>
        </button>
        <button id="evolution-btn" onclick="evolution()" style="display:none;">ğŸŒ± Ã‰volution Ã©conomique</button>
      </div>
    </div>
  </div>
  
  <div id="prodauto-row">
    <div id="venteauto-wrapper" style="display:none;">
      <button id="venteauto-btn" class="btn-venteauto">Vente auto : ON</button>
    </div>
    <div id="prodauto-wrapper" style="display:none;">
      <button id="prodauto-btn" class="btn-prodauto on">Production auto : ON</button>
    </div>
    <div id="prixrelatif-wrapper" style="display:none;">
      <button id="prixrelatif-btn" class="btn-prixrelatif on">Prix relatif : ON</button>
    </div>
  </div>
  <!-- ... [tout le reste de tes jauges, triche etc, inchangÃ©] ... -->

  <script>
    // --- Variables globales [inchangÃ© sauf ajouts ci-dessous]
    let nature = 300, confort = 0, production = 0, money = 10, clicks = 0;
    let prodCost = 5, techLevel = 0;
    let upgradeCount = 0, upgradeAvailable = false, lastUpgradePalier = 0;
    let monnaieActive = false, ia = 0, prixIA = 500, iaProdTimer = null, iaProdOn = true;
    let venteAutoActive = true, venteAutoCount = 0, venteAutoTimers = [];
    let tauxInteret = 5, clicksEnDette = 0, premierPrelevement = false, nbNegociations = 0, lastNegociationClick = 0;
    const maxNegociations = 4, delaiNegociation = 200;
    let budgetEtat = 0, taxeActive = true, clicksTaxe = 0, taxeActivee = false;
    let productionMultiplier = 1, salesMultiplier = 1;
    let factoryUnlocked = false, tradingMarketUnlocked = false, priceIndicatorUnlocked = false, autoClicksUnlocked = false;
    let factoryLastUsed = 0, tradingMarketLastUsed = 0, priceIndicatorLastUsed = 0, autoClicksLastUsed = 0;
    let priceIndicatorActive = false, autoClicksActive = false, prixRelatifActive = true;
    let priceIndicatorBought = false, autoClicksBought = false;

    // ----------- Fonctions principales (MODIFIÃ‰ES) ------------
    function checkUnlocks() {
      // Usine de production (1500 clics, peut revenir)
      if (clicks >= 1500 && Math.floor(clicks / 1500) > Math.floor(factoryLastUsed / 1500)) {
        document.getElementById('factory-btn').classList.remove('hidden');
      }
      // MarchÃ© de trading (1600 clics, peut revenir)
      if (clicks >= 1600 && Math.floor(clicks / 1600) > Math.floor(tradingMarketLastUsed / 1600)) {
        document.getElementById('trading-market-btn').classList.remove('hidden');
      }
      // Indicateur de prixâ€¯: n'apparaÃ®t **qu'une seule fois** !
      if (!priceIndicatorUnlocked && !priceIndicatorBought && clicks >= 1000) {
        document.getElementById('price-indicator-btn').classList.remove('hidden');
        priceIndicatorUnlocked = true;
      }
      // Automatisme = clics : n'apparaÃ®t **qu'une seule fois** !
      if (!autoClicksUnlocked && !autoClicksBought && clicks >= 750) {
        document.getElementById('auto-clicks-btn').classList.remove('hidden');
        autoClicksUnlocked = true;
      }
    }

    function acheterIndicateurPrix() {
      if (jeuBloque || !monnaieActive) return;
      saveState();
      money -= 30000;
      priceIndicatorActive = true;
      priceIndicatorBought = true;
      document.getElementById('price-indicator-btn').classList.add('hidden');
      document.getElementById('price-indicator').classList.remove('hidden');
      document.getElementById('prixrelatif-wrapper').style.display = 'flex';
      gererInterets();
      updateUI("Indicateur de prix achetÃ© !" + (money < 0 ? " (Ã  crÃ©dit)" : ""));
    }

    function acheterAutoClicks() {
      if (jeuBloque || !monnaieActive) return;
      saveState();
      money -= 10000;
      autoClicksActive = true;
      autoClicksBought = true;
      document.getElementById('auto-clicks-btn').classList.add('hidden');
      gererInterets();
      updateUI("Automatisation complÃ¨te activÃ©eâ€¯! Les automatismes comptent maintenant comme des clics" + (money < 0 ? " (Ã  crÃ©dit)" : ""));
    }

    // --- Correction TAXE ETAT ---
    function gererTaxeEtat() {
      if (monnaieActive) {
        clicksTaxe++;
        if (clicksTaxe % 20 === 0 && taxeActive) {
          // On applique 20% sur le solde absolu, positif ou nÃ©gatif
          const base = Math.abs(money);
          const taxe = Math.round(base * 0.2);
          money -= taxe;
          budgetEtat += taxe;
          nature += 1;
          confort += 1;
          if (!taxeActivee) taxeActivee = true;
          updateUI("La collectivitÃ© vous remercie. (Taxe prÃ©levÃ©e : " + taxe + " â‚¬) (+1 ressource, +1 confort)");
          return true;
        }
      }
      return false;
    }

    // --- [Le reste de tes fonctions inchangÃ©, Ã  part vÃ©rification/placement de checkUnlocks et updateUI] ---

    // AprÃ¨s chaque action importante, on met Ã  jour
    function updateUI(message = "") {
      // ... [toutes tes mises Ã  jour d'interface, inchangÃ©es] ...
      if (priceIndicatorActive) {
        document.getElementById("current-price").textContent = calculatePrice();
      }
      // -- dÃ©sactivation permanente des boutons achetÃ©s
      if (priceIndicatorBought) document.getElementById('price-indicator-btn').classList.add('hidden');
      if (autoClicksBought) document.getElementById('auto-clicks-btn').classList.add('hidden');
      // ... [le reste inchangÃ©]
      updateJauges();
      updateButtons();
      checkUnlocks();
    }

    // [Le reste de ton JS inchangÃ©, dont les IA, triche, annuler, etc.]

    document.addEventListener('DOMContentLoaded', function() { initGame(); });
    if (document.readyState === 'loading') document.addEventListener('DOMContentLoaded', initGame);
    else initGame();
  </script>
</body>
</html>

