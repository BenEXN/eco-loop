<!--
Changelog
- v1.11.0 (28/07/2025) : Budget de lâ€™Ã‰tat ajoutÃ©â€¯: taxe 20% tous les 20 clics/actions, bouton ON/OFF (â€œğŸ’¶appeler Bercyâ€), +1 ressource et +1 confort Ã  chaque taxe, jauge jaune pÃ¢le sous la monnaie, design conforme Ã  la version stable, message â€œLa collectivitÃ© vous remercie.â€
- v1.10.0 : NÃ©gociation du taux cliquable, coÃ»t 1/3 confort entier, limite 5 fois, tous les 200 clics, affichage coÃ»t sous bouton.
- v1.9.0 : Version ultra-stable.
-->
<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Looop v1.11.0 â€“ Budget de lâ€™Ã‰tat</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    /* ... (tout ton CSS dâ€™origine, voir prÃ©cÃ©dents codes) ... */
    #jauge-budgetetat { background: #ffe973; }
    .btn-etatauto { background: #ffe973; color: #b7a200; font-weight: bold; border-radius: 8px; margin-left: 18px; }
    .btn-etatauto.on { background: #ffe44c; color: #444;}
  </style>
</head>
<body>
  <h1>ğŸŒ Looop <span style="font-size:0.7em;color:#777;">v1.11.0</span></h1>
  <div class="container">
    <!-- 1. ENVIRONNEMENT -->
    <div class="category">
      <div class="cat-title">ğŸŒ± Environnement</div>
      <div class="stock">Ressources : <span id="nature">300</span></div>
      <div id="alert-crise" class="message-box msg-orange" style="display:none;"></div>
      <div class="btn-row">
        <button id="produce-btn" onclick="produce()">ğŸ› ï¸ Produire</button>
      </div>
    </div>
    <!-- 2. EXOSOMATISATION -->
    <div class="category">
      <div class="cat-title">ğŸ¤– Exosomatisation</div>
      <div class="stock">Confort : <span id="confort">0</span></div>
      <div class="products-box">
        Produits crÃ©Ã©s<br>
        <span id="production">0</span>
      </div>
      <div class="stock" id="tech-level"></div>
      <div class="stock" id="ia-info"></div>
      <div id="venteauto-info"></div>
      <div id="social-crise" class="message-box msg-brown" style="display:none;"></div>
      <div class="btn-row">
        <button id="sell-btn" onclick="sell()">ğŸ’¶ Vente</button>
      </div>
    </div>
    <!-- 3. ECONOMIE -->
    <div class="category">
      <div class="cat-title">ğŸ’¶ Ã‰conomie</div>
      <div class="stock" id="money-row" style="display:none;">
        Monnaie (â‚¬) : <span id="money">10</span>
      </div>
      <div id="taux-info" style="display:none;"></div>
      <button id="don-btn" onclick="receiveDon()">Recevoir mon don</button>
      <div id="eh-msg" class="message-box msg-blue" style="display:none;"></div>
      <div class="btn-row">
        <button id="ouvrier-btn" onclick="acheterIA()">ğŸ¤– Engager une IA (500 â‚¬)</button>
        <button id="trading-btn" class="btn-trading" onclick="acheterTrader()">ğŸª Acheter un trader auto (1000 â‚¬)</button>
        <button id="upgrade-btn2" onclick="upgradeProd2()">ğŸ’  AmÃ©liorer la production (2 000 â‚¬)</button>
        <button id="negocier-btn" class="btn-negocier" onclick="negocierTaux()" style="display:none;">
          ğŸ“‰ NÃ©gocier son taux d'intÃ©rÃªt
          <span id="negocier-cost"></span>
        </button>
        <button id="evolution-btn" onclick="evolution()" style="display:none;">ğŸŒ± Ã‰volution Ã©conomique</button>
      </div>
      <!-- Ligne Budget Ã‰tat + bouton ON/OFF sous la monnaie -->
      <div style="display: flex; align-items: center; justify-content: flex-start; width:100%;margin:10px 0 0 0;" id="etat-row-container">
        <div style="flex:1;">
          <span id="etat-label" style="font-size:1em;font-weight:bold;display:none;">
            Budget de lâ€™Ã‰tat : <span id="budgetetat-val">0</span> â‚¬
          </span>
        </div>
        <button id="etatauto-btn" class="btn-etatauto on" style="display:none;">ğŸ’¶appeler Bercy : ON</button>
      </div>
    </div>
  </div>
  <div id="prodauto-row">
    <div id="venteauto-wrapper" style="display:none;">
      <button id="venteauto-btn" class="btn-venteauto">Vente auto : ON</button>
    </div>
    <div id="prodauto-wrapper" style="display:none;">
      <button id="prodauto-btn" class="btn-prodauto on">Production auto : ON</button>
    </div>
  </div>
  <!-- Jauges sobres -->
  <div style="margin: 0 auto 14px auto; max-width:620px;">
    <div class="jauge-bottom-barre">
      <div class="jauge-bottom-label">ğŸŒ± Ressources</div>
      <div class="jauge-bottom-bar"><div class="jauge-bottom-fill" id="jauge-nature"></div></div>
      <div class="jauge-bottom-val" id="jauge-nature-txt"></div>
    </div>
    <div class="jauge-bottom-barre" id="jauge-confort-container" style="display:none;">
      <div class="jauge-bottom-label">ğŸ¤– Confort</div>
      <div class="jauge-bottom-bar"><div class="jauge-bottom-fill" id="jauge-confort"></div></div>
      <div class="jauge-bottom-val" id="jauge-confort-txt"></div>
    </div>
    <div class="jauge-bottom-barre" id="jauge-money-container" style="display:none;">
      <div class="jauge-bottom-label">ğŸ’¶ Monnaie</div>
      <div class="jauge-bottom-bar"><div class="jauge-bottom-fill" id="jauge-money"></div></div>
      <div class="jauge-bottom-val" id="jauge-money-txt"></div>
    </div>
    <div class="jauge-bottom-barre" id="jauge-budgetetat-container" style="display:none;">
      <div class="jauge-bottom-label">ğŸ’¶ Budget Ã‰tat</div>
      <div class="jauge-bottom-bar"><div class="jauge-bottom-fill" id="jauge-budgetetat"></div></div>
      <div class="jauge-bottom-val" id="jauge-budgetetat-txt"></div>
    </div>
    <div class="jauge-bottom-barre" id="jauge-taux-container" style="display:none;">
      <div class="jauge-bottom-label">ğŸ“‰ Taux intÃ©rÃªt</div>
      <div class="jauge-bottom-bar"><div class="jauge-bottom-fill" id="jauge-taux"></div></div>
      <div class="jauge-bottom-val" id="jauge-taux-txt"></div>
    </div>
    <div class="jauge-bottom-barre" id="jauge-ia-container" style="display:none;">
      <div class="jauge-bottom-label">ğŸ¤– IA</div>
      <div class="jauge-bottom-bar"><div class="jauge-bottom-fill" id="jauge-ia"></div></div>
      <div class="jauge-bottom-val" id="jauge-ia-txt"></div>
    </div>
    <div class="jauge-bottom-barre" id="jauge-venteauto-container" style="display:none;">
      <div class="jauge-bottom-label">ğŸª Vente auto</div>
      <div class="jauge-bottom-bar"><div class="jauge-bottom-fill" id="jauge-venteauto"></div></div>
      <div class="jauge-bottom-val" id="jauge-venteauto-txt"></div>
    </div>
    <div class="jauge-bottom-barre" id="jauge-tech-container" style="display:none;">
      <div class="jauge-bottom-label">ğŸ§ª Technologie</div>
      <div class="jauge-bottom-bar"><div class="jauge-bottom-fill" id="jauge-tech"></div></div>
      <div class="jauge-bottom-val" id="jauge-tech-txt"></div>
    </div>
  </div>
  <div id="revolution" class="message-box msg-red" style="display:none;"></div>
  <div class="message" id="message"></div>
  <div id="clics-container">Clics/actions : <span id="clicks">0</span></div>
  <hr id="triche-sep">
  <div id="triche-label">Triche</div>
  <div class="debug-row">
    <button class="btn-yellow" id="test-btn" onclick="addMoney()">+1000 crÃ©dits (test)</button>
    <button class="btn-yellow" id="plus1-btn" onclick="addOneNature()">+1 ressource</button>
    <button class="btn-yellow" id="test-clics-btn" onclick="addClicks50()">Clics +50 (test)</button>
    <button class="btn-annuler" id="undo-btn" onclick="undoAction()">âª Annuler le clic prÃ©cÃ©dent</button>
  </div>
  <script>
    // ... variables inchangÃ©es ...
    let nature = 300, confort = 0, production = 0, money = 10, clicks = 0;
    let prodCost = 5, techLevel = 0;
    let upgradeCount = 0;
    let upgradeAvailable = false;
    let lastUpgradePalier = 0;
    let lastCrisisResource = 20, criseSocialeActive = false, jeuBloque = false, lastState = null;
    let monnaieActive = false;
    let ia = 0, prixIA = 500;
    let iaProdTimer = null, iaProdOn = true;
    let venteAutoActive = true;
    let venteAutoCount = 0;
    let venteAutoTimers = [];
    let tauxInteret = 5; let clicksEnDette = 0; let premierPrelevement = false; let dernierPrelevement = 0;
    let nbNegociations = 0; let lastNegociationClick = 0;
    const maxNegociations = 5; const delaiNegociation = 200;
    // --- Budget de l'Ã‰tat
    let budgetEtat = 0;
    let taxeEtatActive = true;
    let clicksTaxeEtat = 0;
    let budgetEtatVisible = false;

    document.addEventListener('DOMContentLoaded', function() {
      document.getElementById("etatauto-btn").onclick = function() {
        taxeEtatActive = !taxeEtatActive;
        this.className = "btn-etatauto" + (taxeEtatActive ? " on" : "");
        this.textContent = "ğŸ’¶appeler Bercy : " + (taxeEtatActive ? "ON" : "OFF");
        updateUI(taxeEtatActive ? "Collecte activÃ©e." : "Collecte dÃ©sactivÃ©e.");
      };
    });

    function updateJauges() {
      const budgetetatContainer = document.getElementById("jauge-budgetetat-container");
      if (budgetEtatVisible) {
        budgetetatContainer.style.display = "flex";
        let maxBudget = Math.max(5000, budgetEtat);
        document.getElementById("jauge-budgetetat").style.width = (100 * Math.max(0, Math.min(budgetEtat, maxBudget)) / maxBudget) + "%";
        document.getElementById("jauge-budgetetat-txt").textContent = budgetEtat + " â‚¬";
      } else {
        budgetetatContainer.style.display = "none";
      }
      // ... autres jauges inchangÃ©es ...
    }

    function updateUI(message = "") {
      // ... tous tes updates d'origine ...
      document.getElementById("nature").textContent = nature;
      document.getElementById("confort").textContent = confort;
      document.getElementById("production").textContent = production;
      document.getElementById("tech-level").textContent = techLevel > 0 ? "Niveau technologique : " + techLevel : "";
      document.getElementById("clicks").textContent = clicks;
      document.getElementById("ia-info").textContent = ia > 0 ? "IA : " + ia + " (production automatique)" : "";

      // Affichage taux d'intÃ©rÃªt
      const tauxInfo = document.getElementById("taux-info");
      if (monnaieActive && money < 0) {
        tauxInfo.style.display = "block";
        tauxInfo.textContent = `Taux d'intÃ©rÃªt : ${tauxInteret} %`;
      } else {
        tauxInfo.style.display = "none";
      }

      // ... autres updates inchangÃ©s ...

      // Affichage Budget Ã‰tat et bouton ON/OFF
      const etatRow = document.getElementById("etat-row-container");
      const etatLabel = document.getElementById("etat-label");
      const etatautoBtn = document.getElementById("etatauto-btn");
      if (budgetEtatVisible) {
        etatLabel.style.display = "inline";
        document.getElementById("budgetetat-val").textContent = budgetEtat;
        etatautoBtn.style.display = "inline-block";
        etatautoBtn.textContent = "ğŸ’¶appeler Bercy : " + (taxeEtatActive ? "ON" : "OFF");
        etatautoBtn.className = "btn-etatauto" + (taxeEtatActive ? " on" : "");
      } else {
        etatLabel.style.display = "none";
        etatautoBtn.style.display = "none";
      }

      updateJauges();
      updateButtons();
      document.getElementById("message").textContent = message;
    }

    function appliquerTaxeEtat() {
      if (!budgetEtatVisible) budgetEtatVisible = true;
      let taxe = Math.round(money * 0.2);
      money -= taxe;
      budgetEtat += taxe;
      nature += 1;
      confort += 1;
      updateUI("La collectivitÃ© vous remercie.");
    }

    function produce() {
      if (jeuBloque || !monnaieActive || nature < prodCost) return;
      saveState();
      nature -= prodCost;
      production += 1;
      money -= 1;
      clicks++;
      clicksTaxeEtat++;
      gererInterets();
      if (taxeEtatActive && clicksTaxeEtat % 20 === 0) appliquerTaxeEtat();
      updateUI("");
    }
    function sell() {
      if (jeuBloque || !monnaieActive || production < 1) return;
      saveState();
      production -= 1;
      money += 2;
      confort += 1;
      clicks++;
      clicksTaxeEtat++;
      gererInterets();
      if (taxeEtatActive && clicksTaxeEtat % 20 === 0) appliquerTaxeEtat();
      updateUI("");
    }

    function saveState() {
      lastState = JSON.stringify({
        // ... (tes autres variables) ...
        budgetEtat, taxeEtatActive, clicksTaxeEtat, budgetEtatVisible
      });
    }
    function undoAction() {
      if (lastState && !jeuBloque) {
        const s = JSON.parse(lastState);
        // ... (tes autres variables) ...
        budgetEtat = s.budgetEtat || 0;
        taxeEtatActive = (typeof s.taxeEtatActive !== "undefined") ? s.taxeEtatActive : true;
        clicksTaxeEtat = s.clicksTaxeEtat || 0;
        budgetEtatVisible = !!s.budgetEtatVisible;
        updateUI("DerniÃ¨re action annulÃ©e !");
      }
    }

    // ... (le reste de ton code, autres fonctions, debug, etc. inchangÃ©s) ...
  </script>
</body>
</html>
