<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Looop v1.12.0 – Correction économie et boutons uniques</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- [Styles copié de ta version, inchangé pour la clarté] -->
  <style>
    /* ...[reprends tout ton CSS ici, identique à l'original]... */
    /* Pour gain de place, tout ton style inchangé ! */
  </style>
</head>
<body>
  <h1>🌍 Looop <span style="font-size:0.7em;color:#777;">v1.12.0</span></h1>
  <div class="container">
    <!-- ... [copie tes DIV d'origine identique] ... -->
    <!-- (pas de changement dans le HTML structurel) -->
    <div class="category">
      <div class="cat-title">🌱 Environnement</div>
      <div class="stock">Ressources : <span id="nature">300</span></div>
      <div id="alert-crise" class="message-box msg-orange" style="display:none;"></div>
      <div class="btn-row">
        <button id="produce-btn" onclick="produce()">🛠️ Produire</button>
      </div>
    </div>
    <div class="category">
      <div class="cat-title">🤖 Exosomatisation</div>
      <div class="stock">Confort : <span id="confort">0</span></div>
      <div class="products-box">
        Produits créés<br>
        <span id="production">0</span>
      </div>
      <div class="stock" id="tech-level"></div>
      <div class="stock" id="ia-info"></div>
      <div id="venteauto-info"></div>
      <div id="social-crise" class="message-box msg-brown" style="display:none;"></div>
      <div class="btn-row">
        <button id="sell-btn" onclick="sell()">💶 Vente</button>
      </div>
    </div>
    <div class="category">
      <div class="cat-title">💶 Économie</div>
      <div class="stock" id="money-row" style="display:none;">
        Monnaie (€) : <span id="money">10</span>
      </div>
      <div id="taux-info" style="display:none;"></div>
      <!-- Indicateur de prix -->
      <div id="price-indicator" class="price-indicator hidden">
        <strong>📊 Prix: <span id="current-price">0</span>€/unité de production</strong>
      </div>
      <button id="don-btn" onclick="receiveDon()">Recevoir mon don</button>
      <div id="eh-msg" class="message-box msg-blue" style="display:none;"></div>
      <div class="btn-row">
        <button id="ouvrier-btn" onclick="acheterIA()">🤖 Engager une IA (500 €)</button>
        <button id="trading-btn" class="btn-trading" onclick="acheterTrader()">🏪 Acheter un trader auto (1000 €)</button>
        <button id="upgrade-btn2" onclick="upgradeProd2()">💠 Améliorer la production (2 000 €)</button>
        <!-- Nouvelles fonctionnalités -->
        <button id="factory-btn" class="btn-factory hidden" onclick="acheterUsine()">🏭 Usine de Production (×10) - 20 000 €</button>
        <button id="trading-market-btn" class="btn-trading-market hidden" onclick="acheterMarcheTrading()">📈 Marché de Trading (×10 vente) - 20 000 €</button>
        <button id="price-indicator-btn" class="btn-price-indicator hidden" onclick="acheterIndicateurPrix()">📊 Indicateur de Prix - 30 000 €</button>
        <button id="auto-clicks-btn" class="btn-auto-clicks hidden" onclick="acheterAutoClicks()">⚙️ Les automatismes comptent comme des clics - 10 000 €</button>
        <button id="negocier-btn" class="btn-negocier" onclick="negocierTaux()" style="display:none;">
          📉 Négocier son taux d'intérêt
          <span id="negocier-cost"></span>
        </button>
        <button id="evolution-btn" onclick="evolution()" style="display:none;">🌱 Évolution économique</button>
      </div>
    </div>
  </div>
  
  <div id="prodauto-row">
    <div id="venteauto-wrapper" style="display:none;">
      <button id="venteauto-btn" class="btn-venteauto">Vente auto : ON</button>
    </div>
    <div id="prodauto-wrapper" style="display:none;">
      <button id="prodauto-btn" class="btn-prodauto on">Production auto : ON</button>
    </div>
    <div id="prixrelatif-wrapper" style="display:none;">
      <button id="prixrelatif-btn" class="btn-prixrelatif on">Prix relatif : ON</button>
    </div>
  </div>
  <!-- ... [tout le reste de tes jauges, triche etc, inchangé] ... -->

  <script>
    // --- Variables globales [inchangé sauf ajouts ci-dessous]
    let nature = 300, confort = 0, production = 0, money = 10, clicks = 0;
    let prodCost = 5, techLevel = 0;
    let upgradeCount = 0, upgradeAvailable = false, lastUpgradePalier = 0;
    let monnaieActive = false, ia = 0, prixIA = 500, iaProdTimer = null, iaProdOn = true;
    let venteAutoActive = true, venteAutoCount = 0, venteAutoTimers = [];
    let tauxInteret = 5, clicksEnDette = 0, premierPrelevement = false, nbNegociations = 0, lastNegociationClick = 0;
    const maxNegociations = 4, delaiNegociation = 200;
    let budgetEtat = 0, taxeActive = true, clicksTaxe = 0, taxeActivee = false;
    let productionMultiplier = 1, salesMultiplier = 1;
    let factoryUnlocked = false, tradingMarketUnlocked = false, priceIndicatorUnlocked = false, autoClicksUnlocked = false;
    let factoryLastUsed = 0, tradingMarketLastUsed = 0, priceIndicatorLastUsed = 0, autoClicksLastUsed = 0;
    let priceIndicatorActive = false, autoClicksActive = false, prixRelatifActive = true;
    let priceIndicatorBought = false, autoClicksBought = false;

    // ----------- Fonctions principales (MODIFIÉES) ------------
    function checkUnlocks() {
      // Usine de production (1500 clics, peut revenir)
      if (clicks >= 1500 && Math.floor(clicks / 1500) > Math.floor(factoryLastUsed / 1500)) {
        document.getElementById('factory-btn').classList.remove('hidden');
      }
      // Marché de trading (1600 clics, peut revenir)
      if (clicks >= 1600 && Math.floor(clicks / 1600) > Math.floor(tradingMarketLastUsed / 1600)) {
        document.getElementById('trading-market-btn').classList.remove('hidden');
      }
      // Indicateur de prix : n'apparaît **qu'une seule fois** !
      if (!priceIndicatorUnlocked && !priceIndicatorBought && clicks >= 1000) {
        document.getElementById('price-indicator-btn').classList.remove('hidden');
        priceIndicatorUnlocked = true;
      }
      // Automatisme = clics : n'apparaît **qu'une seule fois** !
      if (!autoClicksUnlocked && !autoClicksBought && clicks >= 750) {
        document.getElementById('auto-clicks-btn').classList.remove('hidden');
        autoClicksUnlocked = true;
      }
    }

    function acheterIndicateurPrix() {
      if (jeuBloque || !monnaieActive) return;
      saveState();
      money -= 30000;
      priceIndicatorActive = true;
      priceIndicatorBought = true;
      document.getElementById('price-indicator-btn').classList.add('hidden');
      document.getElementById('price-indicator').classList.remove('hidden');
      document.getElementById('prixrelatif-wrapper').style.display = 'flex';
      gererInterets();
      updateUI("Indicateur de prix acheté !" + (money < 0 ? " (à crédit)" : ""));
    }

    function acheterAutoClicks() {
      if (jeuBloque || !monnaieActive) return;
      saveState();
      money -= 10000;
      autoClicksActive = true;
      autoClicksBought = true;
      document.getElementById('auto-clicks-btn').classList.add('hidden');
      gererInterets();
      updateUI("Automatisation complète activée ! Les automatismes comptent maintenant comme des clics" + (money < 0 ? " (à crédit)" : ""));
    }

    // --- Correction TAXE ETAT ---
    function gererTaxeEtat() {
      if (monnaieActive) {
        clicksTaxe++;
        if (clicksTaxe % 20 === 0 && taxeActive) {
          // On applique 20% sur le solde absolu, positif ou négatif
          const base = Math.abs(money);
          const taxe = Math.round(base * 0.2);
          money -= taxe;
          budgetEtat += taxe;
          nature += 1;
          confort += 1;
          if (!taxeActivee) taxeActivee = true;
          updateUI("La collectivité vous remercie. (Taxe prélevée : " + taxe + " €) (+1 ressource, +1 confort)");
          return true;
        }
      }
      return false;
    }

    // --- [Le reste de tes fonctions inchangé, à part vérification/placement de checkUnlocks et updateUI] ---

    // Après chaque action importante, on met à jour
    function updateUI(message = "") {
      // ... [toutes tes mises à jour d'interface, inchangées] ...
      if (priceIndicatorActive) {
        document.getElementById("current-price").textContent = calculatePrice();
      }
      // -- désactivation permanente des boutons achetés
      if (priceIndicatorBought) document.getElementById('price-indicator-btn').classList.add('hidden');
      if (autoClicksBought) document.getElementById('auto-clicks-btn').classList.add('hidden');
      // ... [le reste inchangé]
      updateJauges();
      updateButtons();
      checkUnlocks();
    }

    // [Le reste de ton JS inchangé, dont les IA, triche, annuler, etc.]

    document.addEventListener('DOMContentLoaded', function() { initGame(); });
    if (document.readyState === 'loading') document.addEventListener('DOMContentLoaded', initGame);
    else initGame();
  </script>
</body>
</html>

