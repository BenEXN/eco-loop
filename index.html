<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>Looop â€“ Build propre (IA/Trader paliers & disparition OK)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root{
      --bg:#f3f3f3; --card:#fff; --ink:#222; --muted:#667; --accent:#0a7; --warn:#d2691e; --bad:#c00; --ok:#0978c6;
      --shadow:0 4px 24px #0001;
    }
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Arial,sans-serif;color:var(--ink)}
    h1{margin:24px 0 8px;text-align:center}
    .container{max-width:980px;margin:0 auto 24px;display:grid;gap:18px;padding:0 12px}
    @media(min-width:860px){.container{grid-template-columns:1fr 1fr 1fr}}
    .card{background:var(--card);border-radius:18px;box-shadow:var(--shadow);padding:20px}
    .title{font-weight:700;letter-spacing:.3px;margin:0 0 12px}
    .stocks{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:8px}
    .stat{padding:10px 12px;border:1px solid #e7e7ee;border-radius:10px;background:#fafbff}
    .stat b{display:block;font-size:.9rem;color:var(--muted)}
    .big{font-size:1.25rem;font-weight:700}
    .actions button,.shop button,.ctrls button{width:100%;padding:12px 14px;margin:6px 0;border:0;border-radius:12px;cursor:pointer;font-weight:700}
    .actions button{background:#111;color:#fff}
    .shop button{background:#0b7bdc;color:#fff}
    .shop button[disabled]{opacity:.45;cursor:not-allowed}
    .ctrls{display:none;gap:8px}
    .ctrls button{background:#efefef}
    .ctrls button.on{background:#18a957;color:#fff}
    .msg{margin-top:8px;padding:10px 12px;border-radius:10px;background:#fff4d6;border:1px solid #f0d38c;color:#b07a00;font-weight:700;min-height:40px}
    .hint{margin-top:6px;color:var(--muted);font-size:.92rem}
    .hidden{display:none !important}
    .ok{background:#e7f4ff;border:1px solid #7cc8fa;color:var(--ok)}
    .bad{background:#ffe3e3;border:1px solid #e48888;color:var(--bad)}
  </style>
</head>
<body>
  <h1>Looop â€“ build correctif (IA/Trader & paliers)</h1>

  <div class="container">
    <!-- Ã‰tat / Jauges -->
    <section class="card">
      <h2 class="title">Ã‰tat du systÃ¨me</h2>
      <div class="stocks">
        <div class="stat"><b>Capital naturel</b><span class="big" id="nature">40</span></div>
        <div class="stat"><b>Capital social</b><span class="big" id="social">30</span></div>
        <div class="stat"><b>Production</b><span class="big" id="prod">0</span></div>
        <div class="stat"><b>Monnaie (â‚¬)</b><span class="big" id="money">0</span></div>
        <div class="stat"><b>Clics</b><span class="big" id="clicks">0</span></div>
      </div>
      <div class="hint" id="status-hint">Atteins les paliers pour dÃ©bloquer IA, Trader et AmÃ©lioration.</div>
      <div class="msg" id="message"></div>
    </section>

    <!-- Actions -->
    <section class="card">
      <h2 class="title">Actions</h2>
      <div class="actions">
        <button id="btn-produce" onclick="produce()">Produire (coÃ»t nature 5)</button>
        <button id="btn-sell"    onclick="sell()">Vendre (gagne 2â‚¬)</button>
      </div>

      <div class="title" style="margin-top:14px">Automatismes</div>
      <!-- Achats (apparaissent / disparaissent selon paliers) -->
      <div class="shop">
        <button id="btn-buy-ia"     class="hidden" onclick="buyIA()">ðŸ¤– Engager une IA (500â‚¬)</button>
        <button id="btn-buy-trader" class="hidden" onclick="buyTrader()">ðŸ’° Acheter un Trader auto (1000â‚¬)</button>
        <button id="btn-upgrade"    class="hidden" onclick="buyUpgrade()">ðŸ’  AmÃ©liorer la production (2000â‚¬)</button>
      </div>

      <!-- Panneau de contrÃ´le (appairait uniquement si l'automatisme a Ã©tÃ© achetÃ©) -->
      <div class="ctrls" id="controls">
        <button id="ctrl-ia"     onclick="toggleIA()">ðŸ¤– IA: OFF</button>
        <button id="ctrl-trader" onclick="toggleTrader()">ðŸ’° Trader: OFF</button>
      </div>

      <div class="hint">
        â€¢ IA et Trader se dÃ©bloquent par <b>paliers de clics</b> (configurable).<br/>
        â€¢ Lâ€™AmÃ©lioration nâ€™apparaÃ®t quâ€™aux <b>multiples de 600</b>, et une seule fois par palier.
      </div>
    </section>

    <!-- Journal (utile pour dÃ©bogage simple) -->
    <section class="card">
      <h2 class="title">Journal</h2>
      <div class="msg ok" id="log" style="min-height:220px;overflow:auto;white-space:pre-wrap"></div>
      <div class="hint">Le journal liste les dÃ©blocages, achats et changements dâ€™Ã©tat importants.</div>
    </section>
  </div>

  <script>
    /* ================================
       CONFIG â€“ paliers & coÃ»ts
       ================================ */
    const CFG = {
      thresholds: {
        iaClicks: 100,           // palier dâ€™apparition du bouton IA
        traderClicks: 150,       // palier dâ€™apparition du bouton Trader
        upgradeEvery: 600        // palier cyclique pour l'amÃ©lioration
      },
      costs: {
        ia: 500,
        trader: 1000,
        upgrade: 2000
      },
      prod: {
        natureCost: 5,          // coÃ»t en capital naturel pour 1 production
        sellGain: 2,            // â‚¬ par vente
        minProdCost: 1          // plancher si plus tard tu veux rÃ©duire un coÃ»t de prod
      }
    };

    /* ================================
       Ã‰TAT DU JEU
       ================================ */
    const S = {
      nature: 40,
      social: 30,
      production: 0,
      money: 0,
      clicks: 0,

      // AmÃ©lioration progressive (compte combien ont Ã©tÃ© achetÃ©es)
      upgradeCount: 0,

      // Automatismes achetÃ©s ?
      iaOwned: false,
      traderOwned: false,

      // Automatismes actifs (ON/OFF)
      iaOn: false,
      traderOn: false,

      // FenÃªtre dâ€™achat â€œouverteâ€ pour lâ€™upgrade Ã  ce palier ?
      upgradeWindow: false,

      // Intervalles
      tIA: null,
      tTrader: null
    };

    /* ================================
       UTILITAIRES
       ================================ */
    const $ = id => document.getElementById(id);
    function log(msg){ const el=$('log'); el.textContent += (el.textContent?'\n':'') + msg; el.scrollTop = el.scrollHeight; }
    function clamp(v,min,max){ return Math.max(min, Math.min(max, v)); }

    /* ================================
       ACTIONS DE BASE
       ================================ */
    function produce(){
      if (S.nature < CFG.prod.natureCost){ ui("âŒ Pas assez de capital naturel."); return; }
      S.nature -= CFG.prod.natureCost;
      S.production += 1;
      S.clicks += 1;
      ui("ðŸ› ï¸ Production +1 (nature -5).");
    }

    function sell(){
      if (S.production <= 0){ ui("âŒ Rien Ã  vendre."); return; }
      S.production -= 1;
      S.money += CFG.prod.sellGain;
      S.clicks += 1;
      ui("ðŸ’µ Vente +2â‚¬.");
    }

    /* ================================
       ACHATS / AUTOMATISMES
       ================================ */
    function buyIA(){
      if (S.iaOwned){ return; }
      if (S.money < CFG.costs.ia){ ui("ðŸ’³ Pas assez dâ€™argent pour lâ€™IA."); return; }
      S.money -= CFG.costs.ia;
      S.iaOwned = true;
      $('btn-buy-ia').classList.add('hidden');    // disparaÃ®t aprÃ¨s achat
      $('controls').style.display = 'grid';
      S.iaOn = true;
      startIA();
      log("âœ… IA achetÃ©e et activÃ©e.");
      ui("ðŸ¤– IA engagÃ©e.");
    }

    function buyTrader(){
      if (S.traderOwned){ return; }
      if (S.money < CFG.costs.trader){ ui("ðŸ’³ Pas assez dâ€™argent pour le Trader."); return; }
      S.money -= CFG.costs.trader;
      S.traderOwned = true;
      $('btn-buy-trader').classList.add('hidden'); // disparaÃ®t aprÃ¨s achat
      $('controls').style.display = 'grid';
      S.traderOn = true;
      startTrader();
      log("âœ… Trader auto achetÃ© et activÃ©.");
      ui("ðŸ’° Trader automatique engagÃ©.");
    }

    function buyUpgrade(){
      // Achat autorisÃ© une seule fois par palier cyclique
      if (!S.upgradeWindow){ ui("â³ AmÃ©lioration disponible seulement au palier actuel."); return; }
      if (S.money < CFG.costs.upgrade){ ui("ðŸ’³ Pas assez dâ€™argent pour lâ€™amÃ©lioration."); return; }

      S.money -= CFG.costs.upgrade;
      S.upgradeCount += 1;
      S.upgradeWindow = false;
      $('btn-upgrade').classList.add('hidden'); // disparaÃ®t aprÃ¨s achat
      log(`ðŸ’  AmÃ©lioration achetÃ©e (palier #${S.upgradeCount}).`);
      ui("ðŸ’  AmÃ©lioration appliquÃ©e.");
      // Exemple d'effet : on rÃ©duit lÃ©gÃ¨rement le coÃ»t nature de la production, sans passer sous le plancher
      CFG.prod.natureCost = Math.max(CFG.prod.minProdCost, CFG.prod.natureCost - 1);
    }

    /* ================================
       AUTOMATISMES â€“ ON/OFF + INTERVALLES
       ================================ */
    function toggleIA(){
      if (!S.iaOwned) return;
      S.iaOn = !S.iaOn;
      $('ctrl-ia').textContent = S.iaOn ? "ðŸ¤– IA: ON" : "ðŸ¤– IA: OFF";
      $('ctrl-ia').classList.toggle('on', S.iaOn);
      if (S.iaOn) startIA(); else stopIA();
    }
    function startIA(){
      stopIA();
      S.tIA = setInterval(()=>{
        if (!S.iaOn) return;
        // IA = produit automatiquement quand la nature est suffisante
        if (S.nature >= CFG.prod.natureCost){
          produce(); // produit -> incrÃ©mente clics via produce()
        }
      }, 1200);
    }
    function stopIA(){ if (S.tIA){ clearInterval(S.tIA); S.tIA = null; } }

    function toggleTrader(){
      if (!S.traderOwned) return;
      S.traderOn = !S.traderOn;
      $('ctrl-trader').textContent = S.traderOn ? "ðŸ’° Trader: ON" : "ðŸ’° Trader: OFF";
      $('ctrl-trader').classList.toggle('on', S.traderOn);
      if (S.traderOn) startTrader(); else stopTrader();
    }
    function startTrader(){
      stopTrader();
      S.tTrader = setInterval(()=>{
        if (!S.traderOn) return;
        if (S.production > 0){
          sell(); // vend -> incrÃ©mente clics via sell()
        }
      }, 1500);
    }
    function stopTrader(){ if (S.tTrader){ clearInterval(S.tTrader); S.tTrader = null; } }

    /* ================================
       DÃ‰BLOCAGES â€“ apparition / disparition
       ================================ */
    function checkUnlocks(){
      // IA â€“ nâ€™apparaÃ®t quâ€™au franchissement du palier, puis disparaÃ®t aprÃ¨s achat
      if (!S.iaOwned){
        if (S.clicks >= CFG.thresholds.iaClicks) $('btn-buy-ia').classList.remove('hidden');
        else $('btn-buy-ia').classList.add('hidden');
      }

      // Trader â€“ idem
      if (!S.traderOwned){
        if (S.clicks >= CFG.thresholds.traderClicks) $('btn-buy-trader').classList.remove('hidden');
        else $('btn-buy-trader').classList.add('hidden');
      }

      // AmÃ©lioration â€“ fenÃªtre cyclique Ã  chaque multiple de 600 (600, 1200, 1800â€¦)
      const upgradesShouldExist = Math.floor(S.clicks / CFG.thresholds.upgradeEvery);
      if (upgradesShouldExist > S.upgradeCount){
        // un nouveau palier est atteint â†’ on ouvre une fenÃªtre dâ€™achat
        S.upgradeWindow = true;
        $('btn-upgrade').classList.remove('hidden');
      } else {
        // palier consommÃ© (aprÃ¨s achat) â†’ on masque jusquâ€™au prochain multiple
        if (!S.upgradeWindow) $('btn-upgrade').classList.add('hidden');
      }

      // Afficher le panneau de contrÃ´les si au moins un automatisme est possÃ©dÃ©
      $('controls').style.display = (S.iaOwned || S.traderOwned) ? 'grid' : 'none';
      // Mettre Ã  jour lâ€™Ã©tat visuel des interrupteurs
      $('ctrl-ia').textContent     = S.iaOn     ? "ðŸ¤– IA: ON"     : "ðŸ¤– IA: OFF";
      $('ctrl-ia').classList.toggle('on', S.iaOn);
      $('ctrl-trader').textContent = S.traderOn ? "ðŸ’° Trader: ON" : "ðŸ’° Trader: OFF";
      $('ctrl-trader').classList.toggle('on', S.traderOn);
    }

    /* ================================
       UI
       ================================ */
    function ui(msg){
      // clamp Ã©ventuel (Ã©vite valeurs nÃ©gatives folles)
      S.nature = clamp(S.nature, 0, 999999);
      S.social = clamp(S.social, 0, 999999);
      S.production = clamp(S.production, 0, 999999);

      $('nature').textContent = Math.floor(S.nature);
      $('social').textContent = Math.floor(S.social);
      $('prod').textContent   = Math.floor(S.production);
      $('money').textContent  = Math.floor(S.money);
      $('clicks').textContent = S.clicks;

      if (msg) $('message').textContent = msg;
      checkUnlocks();
    }

    // init
    ui("Bienvenue. Clique pour produire / vendre, et dÃ©bloque les paliers.");
  </script>
</body>
</html>

