<!--
Changelog
- v1.11.0 (28/07/2025) : Ajout du budget de l‚Äô√âtat, pr√©l√®vement taxe 20% tous les 20 clics (affich√© d√®s le premier pr√©l√®vement), ON/OFF (‚Äúüí∂appeler Bercy‚Äù), +1 ressource et +1 confort √† chaque pr√©l√®vement, message ‚ÄúLa collectivit√© vous remercie.‚Äù
- v1.10.0 : N√©gociation du taux cliquable, co√ªt 1/3 confort entier, limite 5 fois, tous les 200 clics, affichage co√ªt sous bouton.
- v1.9.0 : Version ultra-stable.
-->
<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Looop v1.11.0 ‚Äì Budget de l‚Äô√âtat</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    /* ... (tout ton CSS d‚Äôorigine) ... */
    /* On ajoute seulement : */
    #jauge-budgetetat { background: #ffe973; }
    .btn-etatauto { background: #ffe973; color: #ab8c19; font-weight: bold; border-radius: 8px; margin-left: 16px; }
    .btn-etatauto.on { background: #ffd600; color: #333;}
    /* Le reste est inchang√© */
  </style>
</head>
<body>
  <h1>üåç Looop <span style="font-size:0.7em;color:#777;">v1.11.0</span></h1>
  <div class="container">
    <!-- ... cat√©gories inchang√©es ... -->
    <div class="category">
      <div class="cat-title">üí∂ √âconomie</div>
      <div class="stock" id="money-row" style="display:none;">
        Monnaie (‚Ç¨) : <span id="money">10</span>
      </div>
      <div id="taux-info" style="display:none;"></div>
      <button id="don-btn" onclick="receiveDon()">Recevoir mon don</button>
      <div id="eh-msg" class="message-box msg-blue" style="display:none;"></div>
      <div class="btn-row">
        <button id="ouvrier-btn" onclick="acheterIA()">ü§ñ Engager une IA (500 ‚Ç¨)</button>
        <button id="trading-btn" class="btn-trading" onclick="acheterTrader()">üè™ Acheter un trader auto (1000 ‚Ç¨)</button>
        <button id="upgrade-btn2" onclick="upgradeProd2()">üí† Am√©liorer la production (2 000 ‚Ç¨)</button>
        <button id="negocier-btn" class="btn-negocier" onclick="negocierTaux()" style="display:none;">
          üìâ N√©gocier son taux d'int√©r√™t
          <span id="negocier-cost"></span>
        </button>
        <button id="evolution-btn" onclick="evolution()" style="display:none;">üå± √âvolution √©conomique</button>
      </div>
      <!-- Ligne Budget √âtat + bouton ON/OFF -->
      <div id="budgetetat-row" style="display:none;margin-top:8px;">
        <span style="font-size:1em;font-weight:bold;">Budget de l‚Äô√âtat : <span id="budgetetat-val">0</span> ‚Ç¨</span>
        <button id="etatauto-btn" class="btn-etatauto on" style="margin-left:16px;">üí∂appeler Bercy : ON</button>
      </div>
    </div>
  </div>
  <!-- ... le reste inchang√© ... -->
  <div id="prodauto-row">
    <!-- ... inchang√© ... -->
  </div>
  <div style="margin: 0 auto 14px auto; max-width:620px;">
    <!-- ... autres jauges ... -->
    <div class="jauge-bottom-barre" id="jauge-budgetetat-container" style="display:none;">
      <div class="jauge-bottom-label">üí∂ Budget √âtat</div>
      <div class="jauge-bottom-bar"><div class="jauge-bottom-fill" id="jauge-budgetetat"></div></div>
      <div class="jauge-bottom-val" id="jauge-budgetetat-txt"></div>
    </div>
    <!-- ... le reste inchang√© ... -->
  </div>
  <div id="revolution" class="message-box msg-red" style="display:none;"></div>
  <div class="message" id="message"></div>
  <div id="clics-container">Clics/actions : <span id="clicks">0</span></div>
  <hr id="triche-sep">
  <div id="triche-label">Triche</div>
  <div class="debug-row">
    <!-- ... inchang√© ... -->
  </div>
  <script>
    // ... Variables d‚Äôorigine ...
    let nature = 300, confort = 0, production = 0, money = 10, clicks = 0;
    let prodCost = 5, techLevel = 0;
    let upgradeCount = 0;
    let upgradeAvailable = false;
    let lastUpgradePalier = 0;
    let lastCrisisResource = 20, criseSocialeActive = false, jeuBloque = false, lastState = null;
    let monnaieActive = false;
    let ia = 0, prixIA = 500;
    let iaProdTimer = null, iaProdOn = true;
    let venteAutoActive = true;
    let venteAutoCount = 0;
    let venteAutoTimers = [];
    let tauxInteret = 5; let clicksEnDette = 0; let premierPrelevement = false; let dernierPrelevement = 0;
    let nbNegociations = 0; let lastNegociationClick = 0;
    const maxNegociations = 5; const delaiNegociation = 200;
    // VARIABLES TAXE √âTAT
    let budgetEtat = 0;
    let taxeEtatActive = true;
    let clicksTaxeEtat = 0;
    let budgetEtatActive = false; // jauge affich√©e ou non

    // PATCH BOUTON BERCY
    document.addEventListener('DOMContentLoaded', function() {
      document.getElementById("etatauto-btn").onclick = function() {
        taxeEtatActive = !taxeEtatActive;
        this.className = "btn-etatauto" + (taxeEtatActive ? " on" : "");
        this.textContent = "üí∂appeler Bercy : " + (taxeEtatActive ? "ON" : "OFF");
        updateUI(taxeEtatActive ? "Collecte activ√©e." : "Collecte d√©sactiv√©e.");
      }
    });

    // PATCH JAUAGE BUDGET ETAT DANS UPDATEJAUGES
    function updateJauges() {
      // ... autres jauges d‚Äôorigine ...
      // Jauge Budget √âtat (nouvelle jauge)
      const budgetetatContainer = document.getElementById("jauge-budgetetat-container");
      if (budgetEtatActive) {
        budgetetatContainer.style.display = "flex";
        let maxBudget = Math.max(5000, budgetEtat); // jauge toujours pleine
        document.getElementById("jauge-budgetetat").style.width = (100 * Math.max(0, Math.min(budgetEtat, maxBudget)) / maxBudget) + "%";
        document.getElementById("jauge-budgetetat-txt").textContent = budgetEtat + " ‚Ç¨";
      } else {
        budgetetatContainer.style.display = "none";
      }
      // ... autres jauges ...
    }

    // PATCH UPDATEUI¬†POUR AFFICHAGE JAUGE ET BOUTON
    function updateUI(message = "") {
      // ... ton updateUI d‚Äôorigine ...
      // Affichage Budget √âtat
      const budgetRow = document.getElementById("budgetetat-row");
      const budgetVal = document.getElementById("budgetetat-val");
      if (budgetEtatActive) {
        budgetRow.style.display = "flex";
        budgetVal.textContent = budgetEtat;
        const etatautoBtn = document.getElementById("etatauto-btn");
        etatautoBtn.textContent = "üí∂appeler Bercy : " + (taxeEtatActive ? "ON" : "OFF");
        etatautoBtn.className = "btn-etatauto" + (taxeEtatActive ? " on" : "");
      } else {
        budgetRow.style.display = "none";
      }
      // ... le reste inchang√© ...
      updateJauges();
      updateButtons();
      document.getElementById("message").textContent = message;
    }

    // PATCH PR√âL√àVEMENT TAXE DANS PRODUCE & SELL
    function appliquerTaxeEtat() {
      if (!budgetEtatActive) budgetEtatActive = true; // Affiche jauge/bouton d√®s le premier pr√©l√®vement
      let taxe = Math.round(money * 0.2);
      money -= taxe;
      budgetEtat += taxe;
      nature += 1;
      confort += 1;
      updateUI("La collectivit√© vous remercie.");
    }

    // PATCH INCR√âMENT CLICS TAXE DANS PRODUCE/SELL
    function produce() {
      if (jeuBloque || !monnaieActive || nature < prodCost) return;
      saveState();
      nature -= prodCost;
      production += 1;
      money -= 1;
      clicks++;
      clicksTaxeEtat++;
      gererInterets();
      if (taxeEtatActive && clicksTaxeEtat % 20 === 0) appliquerTaxeEtat();
      updateUI("");
    }
    function sell() {
      if (jeuBloque || !monnaieActive || production < 1) return;
      saveState();
      production -= 1;
      money += 2;
      confort += 1;
      clicks++;
      clicksTaxeEtat++;
      gererInterets();
      if (taxeEtatActive && clicksTaxeEtat % 20 === 0) appliquerTaxeEtat();
      updateUI("");
    }

    // PATCH SAVE/UNDO POUR NOUVELLES VARS
    function saveState() {
      lastState = JSON.stringify({
        /* ... autres vars ... */
        budgetEtat, taxeEtatActive, clicksTaxeEtat, budgetEtatActive
      });
    }
    function undoAction() {
      if (lastState && !jeuBloque) {
        const s = JSON.parse(lastState);
        /* ... autres vars ... */
        budgetEtat = s.budgetEtat || 0;
        taxeEtatActive = (typeof s.taxeEtatActive !== "undefined") ? s.taxeEtatActive : true;
        clicksTaxeEtat = s.clicksTaxeEtat || 0;
        budgetEtatActive = !!s.budgetEtatActive;
        /* ... relancer timers si besoin ... */
        updateUI("Derni√®re action annul√©e !");
      }
    }

    // ... le reste de ton code inchang√© ...
  </script>
</body>
</html>
