<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Looop v1.25.0 ‚Äì base √©conomique (manque √©lements al√©atoires)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body { background: #f3f3f3; font-family: sans-serif; margin:0; padding:0; }
    h1 { text-align: center; margin: 25px 0 10px; }
    .container { display: flex; justify-content: center; align-items: flex-start; margin: 0 auto 18px auto; max-width: 950px; gap: 24px;}
    .category { background: #fff; border-radius: 18px; box-shadow: 0 4px 24px #0001; flex: 1; padding: 32px 18px 18px 18px; margin: 0 6px; min-width: 250px; max-width: 320px; min-height: 250px; display: flex; flex-direction: column; align-items: center;}
    .cat-title { font-size: 1.25em; margin-bottom: 20px; font-weight: bold; letter-spacing: 1px;}
    .stock { font-size: 1.1em; margin-bottom: 10px;}
    .products-box { background: #f7f7fa; border: 2px solid #dde1eb; border-radius: 10px; color: #333; margin-bottom: 10px; padding: 10px 28px; font-size: 1.2em; font-weight: bold; letter-spacing: 1px; box-shadow: 0 1px 4px #ddd5; min-width: 110px; text-align: center;}
    .message-box { border-radius: 10px; margin: 8px 0 14px 0; padding: 11px 14px 11px 14px; font-weight: bold; font-size: 1.08em; box-shadow: 0 1px 4px #0002; text-align: center; min-width: 130px; max-width: 260px; word-break: break-word; line-height: 1.25em;}
    .msg-orange { background: #ffe9cf; color: #d2691e; border: 2px solid #f5c387;}
    .msg-blue { background: #e7f4ff; color: #0978c6; border: 2px solid #7cc8fa;}
    .msg-red { background: #ffe3e3; color: #c00; border: 2px solid #e48888;}
    .msg-brown { background: #fff4d6; color: #be8c00; border: 2px solid #e2c071;}
    .msg-green { background: #e8f5e8; color: #2e7d32; border: 2px solid #81c784;}
    .btn-row { margin: 18px 0 0 0;}
    button { font-size: 1em; padding: 10px 18px; margin: 5px 0; border-radius: 14px; border: none; background: #ededed; color: #111; cursor: pointer; transition: background 0.2s;}
    .btn-yellow { background: #FFD600; color: #222; font-weight: bold;}
    .btn-annuler { background: #aaa; color: #fff; }
    .btn-credit { background: #ff6b35; color: #fff; font-weight: bold;}
    .btn-evolution { background: #4CAF50; color: #fff; font-weight: bold;}
    .debug-row { margin: 0 0 32px 0; display: flex; justify-content: center; gap: 10px;}
    .message { font-weight: bold; min-height: 24px; margin: 10px 0;}
    #clics-container { text-align: center; margin: 25px 0 0 0; font-size: 1.2em; font-weight: bold; color: #333;}
    #don-btn { margin-top: 10px; background: #FFD600; color: #222; font-weight: bold; border: none; border-radius: 8px; font-size: 1.1em; padding: 14px 20px;}
    #triche-sep { border: none; border-top: 3px solid #222; margin: 38px auto 12px auto; width: 94vw; max-width: 1000px;}
    #triche-label { text-align: left; font-size:1.13em; font-weight:normal; letter-spacing:1px; margin: 0 0 12px 0; color:#111; width: 95vw; max-width: 1000px; margin-left: auto; margin-right: auto;}
    
    /* Contr√¥les automatismes */
    .automatisms-controls { 
      margin: 15px auto 15px auto; 
      max-width: 950px; 
      display: none;
      justify-content: center; 
      gap: 20px; 
      flex-wrap: wrap;
      padding: 15px;
      background: #fff;
      border-radius: 12px;
      box-shadow: 0 2px 12px #0001;
    }
    .control-btn { font-size: 0.9em; padding: 8px 12px; border-radius: 8px; border: none; cursor: pointer; transition: all 0.2s; min-width: 80px;}
    .control-btn.active { background: #4CAF50; color: white; }
    .control-btn.inactive { background: #f44336; color: white; }
    .control-btn.disabled { background: #ccc; color: #888; cursor: not-allowed; }
    
    /* Jauges */
    .jauge-bottom-barre { margin: 0 auto 6px auto; display: flex; flex-direction: row; align-items: center; gap: 8px; max-width: 600px;}
    .jauge-bottom-label { min-width: 70px; font-size: .99em; color: #888; text-align: right;}
    .jauge-bottom-bar { background: #eee; border-radius: 8px; height: 13px; flex: 1; overflow: hidden; position: relative;}
    .jauge-bottom-fill { height: 100%; border-radius: 8px; transition: width 0.19s;}
    #jauge-nature { background: #86e08e;}
    #jauge-confort { background: #86b6ea;}
    #jauge-money { background: #ffb3b3;}
    #jauge-achat-auto { background: #ffa726;}
    #jauge-ia { background: #ab47bc;}
    #jauge-trader { background: #26c6da;}
    #jauge-centre { background: #66bb6a;}
    #jauge-budget-etat { background: #ff9800;}
    #jauge-tech { background: #9c27b0;} /* ================== AJOUT : COULEUR JAUGE TECH ================== */
    .hidden { display: none; }
  </style>
</head>
<body>
  <h1>üåç Looop <span style="font-size:0.7em;color:#777;">v1.24.3 avec Syst√®me d'Alerte et Fin de Jeu</span></h1>
  
  <div class="automatisms-controls" id="automatisms-controls">
    <button class="control-btn disabled" id="control-ia" onclick="toggleAutomatism('ia')">ü§ñ IA: OFF</button>
    <button class="control-btn disabled" id="control-trader" onclick="toggleAutomatism('trader')">üí∞ Trader: OFF</button>
    <button class="control-btn disabled" id="control-confort" onclick="toggleAutomatism('confort')">üõãÔ∏è Confort: OFF</button>
    <button class="control-btn disabled" id="control-centre" onclick="toggleAutomatism('centre')">üè¨ Centre: OFF</button>
  </div>
  
  <div class="container">
    <div class="category">
      <div class="cat-title">üå± Environnement</div>
      <div class="stock">Ressources : <span id="nature">3000</span></div>
      <div id="alert-crise" class="message-box msg-orange" style="display:none;"></div>
      <div class="btn-row">
        <button id="produce-btn" onclick="produce()">üõ†Ô∏è Produire</button>
      </div>
    </div>
    
    <div class="category">
      <div class="cat-title">ü§ñ Exosomatisation</div>
      <div class="stock">Confort : <span id="confort">0</span></div>
      <div class="products-box">
        Produits cr√©√©s<br>
        <span id="production">0</span>
      </div>
      <div id="social-crise" class="message-box msg-brown" style="display:none;"></div>
      <div class="btn-row">
        <button id="comfort-btn" onclick="acheterConfort()" style="display:none;">üõãÔ∏è Achat (100 ‚Ç¨)</button>
        <button id="sell-btn" onclick="sell()">üí∂ Vendre</button>
      </div>
    </div>
    
    <div class="category">
      <div class="cat-title">üí∂ √âconomie</div>
      <div class="stock" id="money-row" style="display:none;">
        Monnaie (‚Ç¨) : <span id="money">10</span>
      </div>
      <!-- ================== AJOUT : BUDGET DE L'√âTAT ================== -->
      <div class="stock" id="budget-etat-row" style="display:none;">
        Budget de l'√âtat : <span id="budget-etat">0</span> ‚Ç¨
      </div>
      <!-- =============================================================== -->
      <div class="products-box" id="price-indicator-box" style="display:none;">
        Prix de vente<br>
        <span id="current-price">1‚Ç¨</span>
      </div>
      
      <button id="don-btn" onclick="receiveDon()">Recevoir mon don</button>
      <button id="credit-btn" onclick="activateCredit()" style="display:none;" class="btn-credit">üí≥ Effectuer un cr√©dit</button>
      <div id="eh-msg" class="message-box msg-blue" style="display:none;"></div>
      <div id="eh-success" class="message-box msg-green" style="display:none;"></div>
      <!-- ================== AJOUT : MESSAGES DE FIN DE JEU ================== -->
      <div id="game-over-resources" class="message-box msg-red" style="display:none;"></div>
      <div id="game-over-confort" class="message-box msg-red" style="display:none;"></div>
      <!-- ===================================================================== -->
      <div class="btn-row">
        <button id="ouvrier-btn" onclick="acheterIA()" style="display:none;">ü§ñ Engager une IA (500 ‚Ç¨)</button>
        <button id="trader-btn" onclick="acheterTrader()" style="display:none;">ü§ñ Trader automatique (1 000 ‚Ç¨)</button>
        <button id="comfort-auto-btn" onclick="acheterConfortAuto()" style="display:none;">üîÑ Achat auto confort (2 000 ‚Ç¨)</button>
        <button id="upgrade-btn2" onclick="upgradeProd2()" style="display:none;">üí† Am√©liorer la production (2 000 ‚Ç¨)</button>
        <button id="automatisms-btn" onclick="acheterAutomatismsClics()" style="display:none;">‚ö° Automatismes = clics (10 000 ‚Ç¨)</button>
        <button id="centre-commercial-btn" onclick="acheterCentreCommercial()" style="display:none;">üè¨ Centre commercial (5 000 ‚Ç¨)</button>
        <button id="price-indicator-btn" onclick="acheterIndicateurPrix()" style="display:none;">üìä Indicateur de prix (30 000 ‚Ç¨)</button>
        <button id="evolution-btn" onclick="evolution()" style="display:none;" class="btn-evolution">üå± √âvolution √©conomique</button>
        <button id="rescue-eh-btn" onclick="activateRescueEH()" style="display:none;" class="btn-evolution">üå± Passer √† l'√©conomie hom√©ostatique</button>
      </div>
    </div>
  </div>
  
  <!-- Jauges -->
  <div id="jauges-zone" style="margin: 0 auto 14px auto; max-width:620px;">
    <div class="jauge-bottom-barre">
      <div class="jauge-bottom-label">üå± Ressources</div>
      <div class="jauge-bottom-bar"><div class="jauge-bottom-fill" id="jauge-nature"></div></div>
      <div class="jauge-bottom-val" id="jauge-nature-txt"></div>
    </div>
    <div class="jauge-bottom-barre" id="jauge-confort-container" style="display:none;">
      <div class="jauge-bottom-label">ü§ñ Confort</div>
      <div class="jauge-bottom-bar"><div class="jauge-bottom-fill" id="jauge-confort"></div></div>
      <div class="jauge-bottom-val" id="jauge-confort-txt"></div>
    </div>
    <div class="jauge-bottom-barre" id="jauge-money-container" style="display:none;">
      <div class="jauge-bottom-label">üí∂ Monnaie</div>
      <div class="jauge-bottom-bar"><div class="jauge-bottom-fill" id="jauge-money"></div></div>
      <div class="jauge-bottom-val" id="jauge-money-txt"></div>
    </div>
    <!-- ================== AJOUT : JAUGE BUDGET D'√âTAT ================== -->
    <div class="jauge-bottom-barre" id="jauge-budget-etat-container" style="display:none;">
      <div class="jauge-bottom-label">üèõÔ∏è Budget √âtat</div>
      <div class="jauge-bottom-bar"><div class="jauge-bottom-fill" id="jauge-budget-etat"></div></div>
      <div class="jauge-budget-etat-val" id="jauge-budget-etat-txt"></div>
    </div>
    <!-- ================================================================== -->
    <div class="jauge-bottom-barre" id="jauge-achat-auto-container" style="display:none;">
      <div class="jauge-bottom-label">üîÑ Achat auto</div>
      <div class="jauge-bottom-bar"><div class="jauge-bottom-fill" id="jauge-achat-auto"></div></div>
      <div class="jauge-bottom-val" id="jauge-achat-auto-txt"></div>
    </div>
    <div class="jauge-bottom-barre" id="jauge-ia-container" style="display:none;">
      <div class="jauge-bottom-label">ü§ñ IA</div>
      <div class="jauge-bottom-bar"><div class="jauge-bottom-fill" id="jauge-ia"></div></div>
      <div class="jauge-bottom-val" id="jauge-ia-txt"></div>
    </div>
    <div class="jauge-bottom-barre" id="jauge-trader-container" style="display:none;">
      <div class="jauge-bottom-label">üí∞ Trader</div>
      <div class="jauge-bottom-bar"><div class="jauge-bottom-fill" id="jauge-trader"></div></div>
      <div class="jauge-bottom-val" id="jauge-trader-txt"></div>
    </div>
    <div class="jauge-bottom-barre" id="jauge-centre-container" style="display:none;">
      <div class="jauge-bottom-label">üè¨ Centre</div>
      <div class="jauge-bottom-bar"><div class="jauge-bottom-fill" id="jauge-centre"></div></div>
      <div class="jauge-bottom-val" id="jauge-centre-txt"></div>
    </div>
    <!-- ================== AJOUT : JAUGE NIVEAU TECHNOLOGIQUE ================== -->
    <div class="jauge-bottom-barre" id="jauge-tech-container" style="display:none;">
      <div class="jauge-bottom-label">üí† Niveau technologique</div>
      <div class="jauge-bottom-bar"><div class="jauge-bottom-fill" id="jauge-tech"></div></div>
      <div class="jauge-bottom-val" id="jauge-tech-txt"></div>
    </div>
    <!-- ======================================================================== -->
  </div>
  
  <div class="message" id="message"></div>
  <div id="clics-container">Clics/actions : <span id="clicks">0</span></div>
  
  <hr id="triche-sep">
  <div id="triche-label">Triche</div>
  <div class="debug-row">
    <button class="btn-yellow" onclick="addMoney()">+1000 cr√©dits (test)</button>
    <button class="btn-yellow" onclick="addOneNature()">+100 ressources (test)</button>
    <button class="btn-yellow" onclick="addClicks50()">Clics +50 (test)</button>
    <button class="btn-annuler" onclick="undoAction()">‚è™ Annuler le clic pr√©c√©dent</button>
  </div>
  
  <script>
    // ==================== VARIABLES PRINCIPALES ====================
    
    var gameState = {
      // Variables de base
      nature: 3000,
      confort: 0,
      production: 0,
      money: 10,
      clicks: 0,
      
      // ================== AJOUT : BUDGET DE L'√âTAT ==================
      budgetEtat: 0,  // Nouvelle variable pour le budget de l'√âtat
      // ===============================================================
      
      // ================== AJOUT : SUIVI DU CONFORT MAXIMUM ==================
      confortMaxAtteint: 0,  // M√©morise le niveau de confort le plus √©lev√© atteint
      // =======================================================================
      
      // √âtats des syst√®mes
      monnaieActive: false,
      creditUnlocked: false,
      jeuBloque: false,
      criseSocialeActive: false,
      ehActivated: false,
      
      // ================== AJOUT : √âTATS DE FIN DE JEU ==================
      gameOver: false,        // Indique si le jeu est termin√©
      gameOverCause: null,    // 'resources' ou 'confort'
      // ==================================================================
      
      // Automatismes
      ia: 0,
      traderAuto: 0,
      confortAuto: 0,
      centreCommercial: 0,
      
      // Am√©liorations
      techLevel: 0,
      productionMultiplier: 1,
      automatismsGenerateClicks: false,
      priceIndicatorActive: false,
      
      // ================== AJOUT : COMPTEURS D'ACHATS CYCLIQUES ==================
      // Chaque compteur trace combien de fois chaque am√©lioration a √©t√© achet√©e
      nbAchatIA: 0,           // Nombre d'achats IA effectu√©s
      nbAchatTrader: 0,       // Nombre d'achats Trader effectu√©s
      nbAchatConfortAuto: 0,  // Nombre d'achats Confort Auto effectu√©s
      nbAchatUpgradeProd: 0,  // Nombre d'achats Upgrade Production effectu√©s
      nbAchatCentre: 0,       // Nombre d'achats Centre Commercial effectu√©s
      // ==========================================================================
      
      // Paliers - pour √©viter les r√©activations (obsol√®te avec syst√®me cyclique)
      paliersDebloque: {
        comfort: false,
        ia: false,
        trader: false,
        upgradeProd: false,
        confortAuto: false,
        automatismsClics: false,
        priceIndicator: false,
        centreCommercial: false
      }
    };
    
    // √âtats des automatismes (ON/OFF)
    var automatismsActive = {
      ia: true,
      trader: true,
      confort: true,
      centre: true
    };
    
    // Gestion des intervalles s√©curis√©s
    var intervals = {
      ia: null,
      trader: null,
      confortAuto: null,
      centreCommercial: null
    };
    
    // SYST√àME DE CR√âDIT CENTRALIS√â
    // Le bouton cr√©dit appara√Æt uniquement dans le bloc √âconomie
    // quand un achat est impossible faute de solde ET que le cr√©dit n'a jamais √©t√© activ√©
    var pendingPurchase = null; // Achat en attente lors de la demande de cr√©dit
    
    // Sauvegarde pour l'annulation
    var lastState = null;
    
    // ==================== SYST√àME D'IMP√îT AUTOMATIQUE ET BUDGET D'√âTAT ====================
    
    /**
     * V√©rifie et applique l'imp√¥t automatique selon les r√®gles :
     * - Tous les 10 clics (√† chaque multiple de 10)
     * - Pr√©lever 20% de la valeur absolue du solde (arrondi sup√©rieur)
     * - Ajouter au budget de l'√âtat
     * - Cons√©quences √©conomiques : +10% ressources, -20% confort (d√®s confort ‚â• 1)
     * - Le confort peut descendre jusqu'√† 0 (fin de jeu par r√©volution)
     */
    function checkAndApplyTax() {
      // V√©rification : tous les 10 clics (peu importe le signe du solde)
      if (gameState.clicks % 10 === 0 && gameState.clicks > 0) {
        // Calcul de l'imp√¥t : 20% de la valeur absolue, arrondi sup√©rieur
        var tax = Math.ceil(Math.abs(gameState.money) * 0.2);
        
        // Application de l'imp√¥t
        gameState.money -= tax;               // Soustraction du montant d'imp√¥t
        gameState.budgetEtat += tax;          // Ajout au budget de l'√âtat
        
        // ================== CONS√âQUENCES √âCONOMIQUES √âQUILIBR√âES ==================
        // L'√âtat investit l'imp√¥t dans les ressources naturelles (+10%)
        var ressourcesBonus = Math.ceil(gameState.nature * 0.1);
        gameState.nature += ressourcesBonus;
        
        // R√©duction du confort par l'imp√¥t (d√®s confort ‚â• 1, jusqu'√† fin de jeu)
        var confortReduction = 0;
        if (gameState.confort >= 1) {
          confortReduction = Math.ceil(gameState.confort * 0.2);
          // Le confort peut descendre jusqu'√† 0 (fin de jeu)
          gameState.confort -= confortReduction;
        }
        // ===========================================================================
        
        // Mise √† jour de l'interface
        updateBudgetEtatUI();
        showTaxMessage(tax, ressourcesBonus, confortReduction);
        
        console.log("Imp√¥t appliqu√©:", tax, "‚Ç¨ - Ressources +" + ressourcesBonus + " - Confort -" + confortReduction + " - Budget √âtat:", gameState.budgetEtat, "‚Ç¨");
      }
    }
    
    /**
     * Met √† jour l'affichage du budget de l'√âtat dans l'interface
     */
    function updateBudgetEtatUI() {
      document.getElementById("budget-etat").textContent = gameState.budgetEtat;
      
      // Afficher la ligne budget d'√âtat si elle existe
      if (gameState.budgetEtat > 0) {
        document.getElementById("budget-etat-row").style.display = "block";
        document.getElementById("jauge-budget-etat-container").style.display = "flex";
      }
    }
    
    /**
     * Affiche un message temporaire lors du pr√©l√®vement d'imp√¥t
     * @param {number} tax - Montant de l'imp√¥t pr√©lev√©
     * @param {number} ressourcesBonus - Bonus de ressources (+20%)
     * @param {number} confortReduction - R√©duction de confort (-20% si > 5)
     */
    function showTaxMessage(tax, ressourcesBonus, confortReduction) {
      var messageElement = document.getElementById("message");
      var message = "üí∏ Imp√¥t pr√©lev√© : " + tax + " ‚Ç¨ (Budget √âtat : " + gameState.budgetEtat + " ‚Ç¨)";
      
      // Ajouter les cons√©quences √©conomiques au message
      if (ressourcesBonus > 0) {
        message += " - Ressources +" + ressourcesBonus;
      }
      if (confortReduction > 0) {
        message += " - Confort -" + confortReduction;
      }
      
      messageElement.textContent = message;
      
      // Effacer le message apr√®s 4 secondes (plus long car plus d'infos)
      setTimeout(function() {
        if (messageElement.textContent.includes("Imp√¥t pr√©lev√©")) {
          messageElement.textContent = "";
        }
      }, 4000);
    }
    
    // ==================== CONFIGURATION DES PALIERS CYCLIQUES ====================
    
    // ================== AJOUT : LOGIQUE CYCLIQUE POUR TOUS LES ACHATS ==================
    // Configuration des paliers cycliques selon le cahier des charges
    var paliersConfig = {
      comfort: { 
        palierBase: 120, 
        cycle: 0, // Non cyclique (achat simple)
        coutBase: 100,
        multiplicateurCout: 1, // Pas d'augmentation
        name: "Acheter confort",
        emoji: "üõãÔ∏è",
        description: "Conversion ‚Ç¨ ‚Üí Confort"
      },
      ia: { 
        palierBase: 200, 
        cycle: 200, // Tous les 200 clics (400, 600, 800...)
        coutBase: 500,
        multiplicateurCout: 1.5, // Co√ªt √ó1.5 √† chaque achat
        name: "Engager une IA",
        emoji: "ü§ñ",
        description: "Production automatique (5s)"
      },
      trader: { 
        palierBase: 500, 
        cycle: 500, // Tous les 500 clics (1000, 1500...)
        coutBase: 1000,
        multiplicateurCout: 1.5, // Co√ªt √ó1.5 √† chaque achat
        name: "Trader automatique",
        emoji: "ü§ñ",
        description: "Vente auto (3s)"
      },
      upgradeProd: { 
        palierBase: 600, 
        cycle: 600, // Tous les 600 clics (1200, 1800...)
        coutBase: 2000,
        multiplicateurCout: 1.5, // Co√ªt √ó1.5 √† chaque achat
        name: "Am√©liorer la production",
        emoji: "üí†",
        description: "Multiplie prod √ó1.5"
      },
      confortAuto: { 
        palierBase: 700, 
        cycle: 700, // Tous les 700 clics (1400, 2100...)
        coutBase: 2000,
        multiplicateurCout: 1.5, // Co√ªt √ó1.5 √† chaque achat
        name: "Achat auto confort",
        emoji: "üîÑ",
        description: "Achat confort auto (15s)"
      },
      automatismsClics: { 
        palierBase: 750, 
        cycle: 0, // Non cyclique (achat unique)
        coutBase: 10000,
        multiplicateurCout: 1, // Pas d'augmentation
        name: "Automatismes = clics",
        emoji: "‚ö°",
        description: "Actions auto = clics (score)",
        condition: () => !gameState.automatismsGenerateClicks
      },
      priceIndicator: { 
        palierBase: 1000, 
        cycle: 0, // Non cyclique (achat unique)
        coutBase: 30000,
        multiplicateurCout: 1, // Pas d'augmentation
        name: "Indicateur de prix",
        emoji: "üìä",
        description: "Affiche dynamique du prix",
        condition: () => !gameState.priceIndicatorActive
      },
      centreCommercial: { 
        palierBase: 1100, 
        cycle: 1100, // Tous les 1100 clics (2200, 3300...)
        coutBase: 5000,
        multiplicateurCout: 1.5, // Co√ªt √ó1.5 √† chaque achat
        name: "Centre commercial",
        emoji: "üè¨",
        description: "Achat confort 10√ó (15s)"
      }
    };
    
    /**
     * Calcule si un palier cyclique est d√©bloqu√© et le co√ªt actuel
     * @param {string} type - Type de palier (ia, trader, etc.)
     * @returns {Object} - {disponible: boolean, cout: number, prochainPalier: number}
     */
    function calculerEtatPalierCyclique(type) {
      var config = paliersConfig[type];
      if (!config) return {disponible: false, cout: 0, prochainPalier: 0};
      
      // Pour les achats non cycliques
      if (config.cycle === 0) {
        var disponible = gameState.clicks >= config.palierBase;
        return {
          disponible: disponible,
          cout: config.coutBase,
          prochainPalier: config.palierBase
        };
      }
      
      // ================== CORRECTION : CONSTRUCTION CORRECTE DU NOM DE VARIABLE ==================
      // Pour les achats cycliques - Correction du mapping des noms de variables
      var nbAchats = 0;
      if (type === 'ia') {
        nbAchats = gameState.nbAchatIA || 0;
      } else if (type === 'trader') {
        nbAchats = gameState.nbAchatTrader || 0;
      } else if (type === 'confortAuto') {
        nbAchats = gameState.nbAchatConfortAuto || 0;
      } else if (type === 'upgradeProd') {
        nbAchats = gameState.nbAchatUpgradeProd || 0;
      } else if (type === 'centreCommercial') {
        nbAchats = gameState.nbAchatCentre || 0;
      }
      // ===========================================================================================
      
      var prochainPalier = config.palierBase + (config.cycle * nbAchats);
      
      console.log("üîß DEBUG calculerEtatPalierCyclique(" + type + "):");
      console.log("   - nbAchats:", nbAchats);
      console.log("   - palierBase:", config.palierBase);
      console.log("   - cycle:", config.cycle);
      console.log("   - calcul: " + config.palierBase + " + (" + config.cycle + " √ó " + nbAchats + ") = " + prochainPalier);
      console.log("   - clics actuels:", gameState.clicks);
      
      // Le bouton est disponible SEULEMENT si on a atteint le prochain palier
      var disponible = gameState.clicks >= prochainPalier;
      console.log("   - disponible:", gameState.clicks + " >= " + prochainPalier + " = " + disponible);
      
      var cout = Math.round(config.coutBase * Math.pow(config.multiplicateurCout, nbAchats));
      
      return {
        disponible: disponible,
        cout: cout,
        prochainPalier: prochainPalier
      };
    }
    
    /**
     * Met √† jour le texte d'un bouton cyclique avec le co√ªt actuel
     * @param {string} buttonId - ID du bouton HTML
     * @param {string} type - Type de palier
     */
    function updateButtonText(buttonId, type) {
      var config = paliersConfig[type];
      var etat = calculerEtatPalierCyclique(type);
      var button = document.getElementById(buttonId);
      
      if (button && config) {
        var texte = config.emoji + " " + config.name + " (" + etat.cout.toLocaleString() + " ‚Ç¨)";
        button.textContent = texte;
      }
    }
    // ===================================================================================
    
    // ==================== FONCTIONS UTILITAIRES ====================
    
    function saveState() {
      lastState = {
        gameState: JSON.parse(JSON.stringify(gameState)),
        automatismsActive: {...automatismsActive},
        pendingPurchase: pendingPurchase ? {...pendingPurchase} : null
      };
    }
    
    function undoAction() {
      if (lastState) {
        // Correction Claude : Arr√™ter tous les intervalles avant de restaurer l'√©tat
        clearAllIntervals();
        
        gameState = JSON.parse(JSON.stringify(lastState.gameState));
        automatismsActive = {...lastState.automatismsActive};
        pendingPurchase = lastState.pendingPurchase ? {...lastState.pendingPurchase} : null;
        
        // Correction Claude : Red√©marrer les intervalles apr√®s restauration selon l'√©tat restaur√©
        restartIntervalsAfterUndo();
        
        updateUI("Action annul√©e");
      }
    }
    
    // Correction Claude : Nouvelle fonction pour arr√™ter tous les intervalles proprement
    function clearAllIntervals() {
      Object.keys(intervals).forEach(key => {
        if (intervals[key]) {
          clearInterval(intervals[key]);
          intervals[key] = null;
        }
      });
    }
    
    // Correction Claude : Nouvelle fonction pour red√©marrer les intervalles apr√®s annulation
    function restartIntervalsAfterUndo() {
      if (gameState.ia > 0 && automatismsActive.ia) {
        startIAInterval();
      }
      if (gameState.traderAuto > 0 && automatismsActive.trader) {
        startTraderInterval();
      }
      if (gameState.confortAuto > 0 && automatismsActive.confort) {
        startConfortAutoInterval();
      }
      if (gameState.centreCommercial > 0 && automatismsActive.centre) {
        startCentreCommercialInterval();
      }
    }
    
    function calculatePrice() {
      if (gameState.nature === 0) return 1;
      var price = Math.max(1, Math.abs(gameState.money) / gameState.nature);
      return Math.round(price * 100) / 100;
    }
    
    // ==================== SYST√àME DE CR√âDIT ====================
    
    // R√àGLE : Le cr√©dit fonctionne sur le solde de monnaie
    // Si solde insuffisant ET cr√©dit jamais activ√© -> bouton cr√©dit
    // Une fois cr√©dit activ√© -> tous achats possibles, bouton dispara√Æt d√©finitivement
    
    function needsCreditActivation(amount) {
      return gameState.money < amount && !gameState.creditUnlocked;
    }
    
    function showCreditButton(purchaseType, amount) {
      // Ne pas afficher si cr√©dit d√©j√† activ√©
      if (gameState.creditUnlocked) return false;
      
      // Ne pas r√©afficher si d√©j√† visible
      if (document.getElementById("credit-btn").style.display === "block") return false;
      
      // Enregistrer l'achat en attente
      pendingPurchase = { type: purchaseType, amount: amount };
      
      // Afficher le bouton cr√©dit dans le bloc √âconomie
      document.getElementById("credit-btn").style.display = "block";
      return true;
    }
    
    function activateCredit() {
      // Activer le cr√©dit de mani√®re PERMANENTE
      gameState.creditUnlocked = true;
      
      // Masquer d√©finitivement le bouton cr√©dit
      document.getElementById("credit-btn").style.display = "none";
      
      // Ex√©cuter l'achat en attente
      if (pendingPurchase) {
        executePendingPurchase();
        pendingPurchase = null;
      }
      
      updateUI("üí≥ Cr√©dit activ√© ! Tous les achats sont maintenant possibles");
    }
    
    function executePendingPurchase() {
      // Ex√©cuter l'achat qui √©tait en attente
      switch(pendingPurchase.type) {
        case 'comfort': acheterConfort(); break;
        case 'ia': acheterIA(); break;
        case 'trader': acheterTrader(); break;
        case 'confortAuto': acheterConfortAuto(); break;
        case 'centreCommercial': acheterCentreCommercial(); break;
        case 'upgradeProd': upgradeProd2(); break;
        case 'automatismsClics': acheterAutomatismsClics(); break;
        case 'priceIndicator': acheterIndicateurPrix(); break;
      }
    }
    
    function canAffordPurchase(amount) {
      // Si cr√©dit activ√©, tous les achats sont autoris√©s
      if (gameState.creditUnlocked) return true;
      // Sinon, v√©rifier le solde
      return gameState.money >= amount;
    }
    
    function debitMoney(amount) {
      gameState.money -= amount;
    }
    
    // ==================== ACTIONS DE BASE ====================
    
    function produce() {
      if (gameState.jeuBloque) return;
      saveState();
      
      var cost = 5;
      if (gameState.nature >= cost) {
        gameState.nature -= cost;
        var prodAmount = Math.floor(gameState.productionMultiplier);
        gameState.production += prodAmount;
        gameState.clicks++;
        
        // ================== AJOUT : V√âRIFICATION IMP√îT ==================
        checkAndApplyTax(); // V√©rifie et applique l'imp√¥t si n√©cessaire
        // =================================================================
        
        updateUI("Production : +" + prodAmount + " produits cr√©√©s");
      } else {
        updateUI("Pas assez de ressources pour produire");
      }
    }
    
    function sell() {
      if (gameState.jeuBloque || gameState.production <= 0) {
        if (gameState.production <= 0) updateUI("Aucun produit √† vendre");
        return;
      }
      
      saveState();
      var price = calculatePrice();
      var saleAmount = Math.min(gameState.production, 1);
      var totalEarnings = price * saleAmount;
      
      gameState.money += totalEarnings;
      gameState.production -= saleAmount;
      gameState.clicks++;
      
      // ================== AJOUT : V√âRIFICATION IMP√îT ==================
      checkAndApplyTax(); // V√©rifie et applique l'imp√¥t si n√©cessaire
      // =================================================================
      
      // Activer la monnaie si premi√®re vente
      if (!gameState.monnaieActive) {
        gameState.monnaieActive = true;
        document.getElementById("money-row").style.display = "block";
        document.getElementById("jauge-money-container").style.display = "flex";
      }
      
      updateUI("Vente : +" + totalEarnings.toFixed(2) + "‚Ç¨");
    }
    
    function receiveDon() {
      if (gameState.jeuBloque) return;
      saveState();
      
      gameState.money = 1000;
      gameState.clicks++;
      
      // ================== AJOUT : V√âRIFICATION IMP√îT ==================
      checkAndApplyTax(); // V√©rifie et applique l'imp√¥t si n√©cessaire
      // =================================================================
      
      // Activer la monnaie
      if (!gameState.monnaieActive) {
        gameState.monnaieActive = true;
        document.getElementById("money-row").style.display = "block";
        document.getElementById("jauge-money-container").style.display = "flex";
      }
      
      document.getElementById("don-btn").style.display = "none";
      updateUI("Don re√ßu : 1000‚Ç¨");
    }
    
    // ==================== ACHATS ET AM√âLIORATIONS CYCLIQUES ====================
    
    function acheterConfort() {
      if (gameState.jeuBloque || !gameState.monnaieActive) return;
      
      var cost = 100;
      
      // V√©rifier si le cr√©dit est n√©cessaire
      if (needsCreditActivation(cost)) {
        if (showCreditButton('comfort', cost)) {
          updateUI("Solde insuffisant pour acheter du confort - Cr√©dit disponible");
          return;
        }
      }
      
      // Proc√©der √† l'achat
      saveState();
      debitMoney(cost);
      gameState.confort += 1;
      gameState.clicks++;
      
      // ================== AJOUT : V√âRIFICATION IMP√îT ==================
      checkAndApplyTax(); // V√©rifie et applique l'imp√¥t si n√©cessaire
      // =================================================================
      
      // Afficher la jauge confort si premier achat
      if (gameState.confort === 1) {
        document.getElementById("jauge-confort-container").style.display = "flex";
      }
      
      var message = "Confort achet√© : +1 confort";
      if (gameState.money < 0) {
        message += " - Solde : " + gameState.money + "‚Ç¨";
      }
      updateUI(message);
    }
    
    // ================== DEBUG : FONCTION IA AVEC TRA√áAGE COMPLET ==================
    function acheterIA() {
      if (gameState.jeuBloque || !gameState.monnaieActive) return;
      
      console.log("ü§ñ ACHAT IA - D√âBUT:");
      console.log("   - Clics avant achat:", gameState.clicks);
      console.log("   - nbAchatIA avant achat:", gameState.nbAchatIA);
      
      var etat = calculerEtatPalierCyclique('ia');
      var cost = etat.cout;
      
      // V√©rifier si le cr√©dit est n√©cessaire
      if (needsCreditActivation(cost)) {
        if (showCreditButton('ia', cost)) {
          updateUI("Solde insuffisant pour engager une IA - Cr√©dit disponible");
          return;
        }
      }
      
      // Proc√©der √† l'achat
      saveState();
      debitMoney(cost);
      
      if (gameState.ia === 0) {
        // Premi√®re IA
        gameState.ia = 1;
        document.getElementById("jauge-ia-container").style.display = "flex";
        startIAInterval(); // D√©marrer l'automatisme
        console.log("ü§ñ Premi√®re IA engag√©e - Automatisme d√©marr√©");
      } else {
        // Doubler la capacit√©
        gameState.ia *= 2;
        // Red√©marrer l'intervalle avec la nouvelle capacit√©
        if (intervals.ia) {
          clearInterval(intervals.ia);
        }
        startIAInterval();
        console.log("ü§ñ IA am√©lior√©e - Nouvelle capacit√©:", gameState.ia);
      }
      
      // Incr√©menter le compteur d'achats IA
      gameState.nbAchatIA++;
      gameState.clicks++;
      
      console.log("ü§ñ ACHAT IA - APR√àS INCR√âMENTATION:");
      console.log("   - Clics apr√®s achat:", gameState.clicks);
      console.log("   - nbAchatIA apr√®s achat:", gameState.nbAchatIA);
      
      // ================== AJOUT : V√âRIFICATION IMP√îT ==================
      checkAndApplyTax(); // V√©rifie et applique l'imp√¥t si n√©cessaire
      // =================================================================
      
      // ================== MASQUAGE AVEC LOGS ==================
      console.log("ü§ñ MASQUAGE - Bouton IA masqu√© manuellement");
      document.getElementById("ouvrier-btn").style.display = "none";
      console.log("ü§ñ MASQUAGE - √âtat du bouton:", document.getElementById("ouvrier-btn").style.display);
      // ========================================================
      
      console.log("ü§ñ ACHAT IA - AVANT updateUI()");
      updateUI("IA engag√©e ! Production automatique √ó" + gameState.ia + " (toutes les 5s)");
      console.log("ü§ñ ACHAT IA - APR√àS updateUI()");
    }
    // ===================================================================
    
    // ================== AJOUT : FONCTION TRADER CYCLIQUE ==================
    function acheterTrader() {
      if (gameState.jeuBloque || !gameState.monnaieActive) return;
      
      var etat = calculerEtatPalierCyclique('trader');
      var cost = etat.cout;
      
      // V√©rifier si le cr√©dit est n√©cessaire
      if (needsCreditActivation(cost)) {
        if (showCreditButton('trader', cost)) {
          updateUI("Solde insuffisant pour engager un trader - Cr√©dit disponible");
          return;
        }
      }
      
      // Proc√©der √† l'achat
      saveState();
      debitMoney(cost);
      
      if (gameState.traderAuto === 0) {
        // Premier trader
        gameState.traderAuto = 1;
        document.getElementById("jauge-trader-container").style.display = "flex";
        startTraderInterval(); // D√©marrer l'automatisme
      } else {
        // Doubler la capacit√©
        gameState.traderAuto *= 2;
        // Red√©marrer l'intervalle avec la nouvelle capacit√©
        if (intervals.trader) {
          clearInterval(intervals.trader);
        }
        startTraderInterval();
      }
      
      // Incr√©menter le compteur d'achats Trader
      gameState.nbAchatTrader++;
      gameState.clicks++;
      
      // ================== AJOUT : V√âRIFICATION IMP√îT ==================
      checkAndApplyTax(); // V√©rifie et applique l'imp√¥t si n√©cessaire
      // =================================================================
      
      // Masquer le bouton temporairement (il r√©appara√Ætra au prochain cycle)
      document.getElementById("trader-btn").style.display = "none";
      
      updateUI("Trader automatique √ó" + gameState.traderAuto + " engag√© ! Vente automatique (toutes les 3s)");
    }
    // ======================================================================
    
    // ================== AJOUT : FONCTION CONFORT AUTO CYCLIQUE ==================
    function acheterConfortAuto() {
      if (gameState.jeuBloque || !gameState.monnaieActive) return;
      
      var etat = calculerEtatPalierCyclique('confortAuto');
      var cost = etat.cout;
      
      // V√©rifier si le cr√©dit est n√©cessaire
      if (needsCreditActivation(cost)) {
        if (showCreditButton('confortAuto', cost)) {
          updateUI("Solde insuffisant pour l'achat automatique de confort - Cr√©dit disponible");
          return;
        }
      }
      
      // Proc√©der √† l'achat
      saveState();
      debitMoney(cost);
      
      if (gameState.confortAuto === 0) {
        // Premier achat auto
        gameState.confortAuto = 1;
        document.getElementById("jauge-achat-auto-container").style.display = "flex";
        startConfortAutoInterval(); // D√©marrer l'automatisme
      } else {
        // Doubler la capacit√©
        gameState.confortAuto *= 2;
        // Red√©marrer l'intervalle avec la nouvelle capacit√©
        if (intervals.confortAuto) {
          clearInterval(intervals.confortAuto);
        }
        startConfortAutoInterval();
      }
      
      // Incr√©menter le compteur d'achats Confort Auto
      gameState.nbAchatConfortAuto++;
      gameState.clicks++;
      
      // ================== AJOUT : V√âRIFICATION IMP√îT ==================
      checkAndApplyTax(); // V√©rifie et applique l'imp√¥t si n√©cessaire
      // =================================================================
      
      // Masquer le bouton temporairement (il r√©appara√Ætra au prochain cycle)
      document.getElementById("comfort-auto-btn").style.display = "none";
      
      updateUI("Achat automatique de confort activ√© ! +" + gameState.confortAuto + " confort toutes les 15s");
    }
    // ============================================================================
    
    // ================== AJOUT : FONCTION CENTRE COMMERCIAL CYCLIQUE AVEC DEBUG ==================
    function acheterCentreCommercial() {
      if (gameState.jeuBloque || !gameState.monnaieActive) return;
      
      var etat = calculerEtatPalierCyclique('centreCommercial');
      var cost = etat.cout;
      
      // V√©rifier si le cr√©dit est n√©cessaire
      if (needsCreditActivation(cost)) {
        if (showCreditButton('centreCommercial', cost)) {
          updateUI("Solde insuffisant pour le centre commercial - Cr√©dit disponible");
          return;
        }
      }
      
      // Proc√©der √† l'achat
      saveState();
      debitMoney(cost);
      
      if (gameState.centreCommercial === 0) {
        // Premier centre commercial
        gameState.centreCommercial = 1;
        document.getElementById("jauge-centre-container").style.display = "flex";
        startCentreCommercialInterval(); // D√©marrer l'automatisme
        console.log("üè¨ Premier Centre Commercial achet√© - Automatisme d√©marr√©");
      } else {
        // Doubler la capacit√©
        gameState.centreCommercial *= 2;
        // Red√©marrer l'intervalle avec la nouvelle capacit√©
        if (intervals.centreCommercial) {
          clearInterval(intervals.centreCommercial);
        }
        startCentreCommercialInterval();
        console.log("üè¨ Centre Commercial am√©lior√© - Nouvelle capacit√©:", gameState.centreCommercial);
      }
      
      // Incr√©menter le compteur d'achats Centre Commercial
      gameState.nbAchatCentre++;
      gameState.clicks++;
      
      // ================== AJOUT : V√âRIFICATION IMP√îT ==================
      checkAndApplyTax(); // V√©rifie et applique l'imp√¥t si n√©cessaire
      // =================================================================
      
      // ================== CORRECTION : MASQUAGE AVEC D√âLAI ==================
      // Masquer le bouton imm√©diatement et emp√™cher la r√©-activation temporaire
      document.getElementById("centre-commercial-btn").style.display = "none";
      console.log("üè¨ Bouton Centre Commercial masqu√© apr√®s achat");
      // =======================================================================
      
      updateUI("Centre commercial activ√© ! +" + (10 * gameState.centreCommercial) + " confort toutes les 15s");
    }
    // =================================================================================
    
    // ================== AJOUT : FONCTION UPGRADE PRODUCTION CYCLIQUE ==================
    function upgradeProd2() {
      if (gameState.jeuBloque || !gameState.monnaieActive) return;
      
      var etat = calculerEtatPalierCyclique('upgradeProd');
      var cost = etat.cout;
      
      // V√©rifier si le cr√©dit est n√©cessaire
      if (needsCreditActivation(cost)) {
        if (showCreditButton('upgradeProd', cost)) {
          updateUI("Solde insuffisant pour am√©liorer la production - Cr√©dit disponible");
          return;
        }
      }
      
      // Proc√©der √† l'achat
      saveState();
      debitMoney(cost);
      gameState.techLevel++;
      gameState.productionMultiplier *= 1.5;
      
      // Incr√©menter le compteur d'achats Upgrade Production
      gameState.nbAchatUpgradeProd++;
      gameState.clicks++;
      
      // ================== AJOUT : V√âRIFICATION IMP√îT ==================
      checkAndApplyTax(); // V√©rifie et applique l'imp√¥t si n√©cessaire
      // =================================================================
      
      // ================== AJOUT : AFFICHAGE JAUGE TECH ==================
      // Afficher la jauge technologique d√®s le premier upgrade
      if (gameState.techLevel === 1) {
        document.getElementById("jauge-tech-container").style.display = "flex";
      }
      // ==================================================================
      
      // Masquer le bouton temporairement (il r√©appara√Ætra au prochain cycle)
      document.getElementById("upgrade-btn2").style.display = "none";
      
      updateUI("Production am√©lior√©e ! Multiplicateur √ó" + gameState.productionMultiplier.toFixed(1));
    }
    // ==================================================================================
    
    function acheterAutomatismsClics() {
      if (gameState.jeuBloque || !gameState.monnaieActive) return;
      
      var cost = 10000;
      
      // V√©rifier si le cr√©dit est n√©cessaire
      if (needsCreditActivation(cost)) {
        if (showCreditButton('automatismsClics', cost)) {
          updateUI("Solde insuffisant pour les automatismes = clics - Cr√©dit disponible");
          return;
        }
      }
      
      // Proc√©der √† l'achat
      saveState();
      debitMoney(cost);
      gameState.automatismsGenerateClicks = true;
      gameState.clicks++;
      
      // ================== AJOUT : V√âRIFICATION IMP√îT ==================
      checkAndApplyTax(); // V√©rifie et applique l'imp√¥t si n√©cessaire
      // =================================================================
      
      gameState.paliersDebloque.automatismsClics = true;
      document.getElementById("automatisms-btn").style.display = "none";
      
      updateUI("Automatismes activ√©s ! Chaque action automatique compte comme un clic");
    }
    
    function acheterIndicateurPrix() {
      if (gameState.jeuBloque || !gameState.monnaieActive) return;
      
      var cost = 30000;
      
      // V√©rifier si le cr√©dit est n√©cessaire
      if (needsCreditActivation(cost)) {
        if (showCreditButton('priceIndicator', cost)) {
          updateUI("Solde insuffisant pour l'indicateur de prix - Cr√©dit disponible");
          return;
        }
      }
      
      // Proc√©der √† l'achat
      saveState();
      debitMoney(cost);
      gameState.priceIndicatorActive = true;
      gameState.clicks++;
      
      // ================== AJOUT : V√âRIFICATION IMP√îT ==================
      checkAndApplyTax(); // V√©rifie et applique l'imp√¥t si n√©cessaire
      // =================================================================
      
      gameState.paliersDebloque.priceIndicator = true;
      document.getElementById("price-indicator-btn").style.display = "none";
      
      updateUI("Indicateur de prix activ√© ! Le prix varie selon : |Monnaie| √∑ Ressources");
    }
    
    function evolution() {
      if (gameState.jeuBloque || !gameState.monnaieActive || gameState.ehActivated) return;
      
      saveState();
      gameState.ehActivated = true;
      gameState.jeuBloque = true;
      gameState.clicks++;
      
      // ================== AJOUT : V√âRIFICATION IMP√îT ==================
      checkAndApplyTax(); // V√©rifie et applique l'imp√¥t si n√©cessaire
      // =================================================================
      
      // Arr√™ter tous les automatismes
      Object.keys(automatismsActive).forEach(key => {
        automatismsActive[key] = false;
      });
      
      // Correction Claude : Arr√™ter tous les intervalles lors de l'√©volution EH
      clearAllIntervals();
      
      // Masquer les contr√¥les d'automatismes
      document.getElementById("automatisms-controls").style.display = "none";
      
      // Afficher le message de succ√®s
      var successBox = document.getElementById("eh-success");
      successBox.style.display = "block";
      successBox.textContent = "üå± Transition vers l'√âconomie Hom√©ostatique r√©ussie ! Le syst√®me entre en √©quilibre...";
      
      // Masquer le bouton d'√©volution
      document.getElementById("evolution-btn").style.display = "none";
      
      updateUI("üå± √âvolution vers l'√âconomie Hom√©ostatique - Syst√®me stabilis√© !");
    }
    
    // ==================== SYST√àME DE FIN DE JEU ET SECOURS ====================
    
    /**
     * D√©clenche la fin de jeu selon la cause
     * @param {string} cause - 'resources' ou 'confort'
     */
    function triggerGameOver(cause) {
      gameState.gameOver = true;
      gameState.gameOverCause = cause;
      gameState.jeuBloque = true;
      
      // Arr√™ter tous les automatismes
      clearAllIntervals();
      
      // Masquer tous les boutons d'action
      hideAllActionButtons();
      
      // Afficher le message de d√©faite appropri√©
      if (cause === 'resources') {
        var gameOverBox = document.getElementById("game-over-resources");
        gameOverBox.style.display = "block";
        gameOverBox.textContent = "üåç La plan√®te n'est plus habitable : Perdu !";
        updateUI("üåç D√©faite : La plan√®te n'est plus habitable");
      } else if (cause === 'confort') {
        var gameOverBox = document.getElementById("game-over-confort");
        gameOverBox.style.display = "block";
        gameOverBox.textContent = "‚öîÔ∏è R√©volution de la soci√©t√© : Perdu !";
        updateUI("‚öîÔ∏è D√©faite : R√©volution de la soci√©t√©");
      }
      
      // Proposer le bouton de secours apr√®s 3 secondes
      setTimeout(function() {
        document.getElementById("rescue-eh-btn").style.display = "block";
        updateUI("üå± Solution de secours disponible : √âconomie Hom√©ostatique");
      }, 3000);
    }
    
    /**
     * Masque tous les boutons d'action lors de la fin de jeu
     */
    function hideAllActionButtons() {
      // Boutons principaux
      document.getElementById("produce-btn").style.display = "none";
      document.getElementById("sell-btn").style.display = "none";
      document.getElementById("comfort-btn").style.display = "none";
      document.getElementById("don-btn").style.display = "none";
      document.getElementById("credit-btn").style.display = "none";
      
      // Boutons d'am√©lioration
      document.getElementById("ouvrier-btn").style.display = "none";
      document.getElementById("trader-btn").style.display = "none";
      document.getElementById("comfort-auto-btn").style.display = "none";
      document.getElementById("upgrade-btn2").style.display = "none";
      document.getElementById("automatisms-btn").style.display = "none";
      document.getElementById("centre-commercial-btn").style.display = "none";
      document.getElementById("price-indicator-btn").style.display = "none";
      document.getElementById("evolution-btn").style.display = "none";
      
      // Masquer les contr√¥les d'automatismes
      document.getElementById("automatisms-controls").style.display = "none";
    }
    
    /**
     * Active l'√©conomie hom√©ostatique de secours
     */
    function activateRescueEH() {
      // Sauvegarder l'√©tat avant le secours
      saveState();
      
      // Appliquer les bonus de secours
      gameState.nature += 100;      // +100 ressources
      gameState.confort += 50;      // +50 confort
      
      // Mettre √† jour le maximum de confort atteint
      if (gameState.confort > gameState.confortMaxAtteint) {
        gameState.confortMaxAtteint = gameState.confort;
      }
      
      // Activer l'√©conomie hom√©ostatique
      gameState.ehActivated = true;
      gameState.gameOver = false;    // Sortir de l'√©tat de d√©faite
      gameState.jeuBloque = true;    // Mais garder le jeu en mode EH (bloqu√©)
      
      // Masquer les messages de d√©faite
      document.getElementById("game-over-resources").style.display = "none";
      document.getElementById("game-over-confort").style.display = "none";
      document.getElementById("rescue-eh-btn").style.display = "none";
      
      // Afficher le message de succ√®s EH
      var successBox = document.getElementById("eh-success");
      successBox.style.display = "block";
      successBox.textContent = "üå± Transition d'urgence vers l'√âconomie Hom√©ostatique r√©ussie ! Le syst√®me entre en √©quilibre...";
      
      updateUI("üå± Secours EH activ√© : +100 ressources, +50 confort - Syst√®me stabilis√© !");
    }
    
    // ==================== AUTOMATISMES - CORRECTION EXACTE CAHIER DES CHARGES ====================
    
    function startIAInterval() {
      // Nettoyer l'ancien interval si il existe
      if (intervals.ia) {
        clearInterval(intervals.ia);
      }
      
      intervals.ia = setInterval(function() {
        if (gameState.ia > 0 && !gameState.jeuBloque && automatismsActive.ia) {
          // CAHIER DES CHARGES : "Production automatique (5s)"
          // L'IA produit automatiquement, PAS doubler la production manuelle
          var cost = 5; // Co√ªt en ressources naturelles
          var totalCost = cost * gameState.ia;
          
          if (gameState.nature >= totalCost) {
            gameState.nature -= totalCost;
            // L'IA produit 1 produit par IA, multipli√© par le multiplicateur de production
            var prodAmount = gameState.ia * gameState.productionMultiplier;
            gameState.production += Math.floor(prodAmount);
            
            // Si "Automatismes = clics" activ√©, compter comme des clics
            if (gameState.automatismsGenerateClicks) {
              gameState.clicks += Math.floor(prodAmount);
            }
            
            // Mise √† jour silencieuse
            updateUIValues();
          }
        }
      }, 5000); // Toutes les 5 secondes
    }
    
    function startTraderInterval() {
      // Nettoyer l'ancien interval si il existe
      if (intervals.trader) {
        clearInterval(intervals.trader);
      }
      
      intervals.trader = setInterval(function() {
        if (gameState.traderAuto > 0 && gameState.production > 0 && !gameState.jeuBloque && automatismsActive.trader) {
          // CAHIER DES CHARGES : "Vente auto (3s)"
          var price = calculatePrice();
          var saleAmount = Math.min(gameState.production, gameState.traderAuto);
          var totalEarnings = price * saleAmount;
          
          gameState.money += totalEarnings;
          gameState.production -= saleAmount;
          
          // Si "Automatismes = clics" activ√©, compter comme des clics
          if (gameState.automatismsGenerateClicks) {
            gameState.clicks += saleAmount;
          }
          
          // Mise √† jour silencieuse
          updateUIValues();
        }
      }, 3000); // Toutes les 3 secondes
    }
    
    function startConfortAutoInterval() {
      // Nettoyer l'ancien interval si il existe
      if (intervals.confortAuto) {
        clearInterval(intervals.confortAuto);
      }
      
      console.log("üîÑ D√âMARRAGE Confort Auto - Intervalle cr√©√©");
      
      intervals.confortAuto = setInterval(function() {
        console.log("üîÑ Confort Auto - Cycle d'ex√©cution:");
        console.log("   - gameState.confortAuto:", gameState.confortAuto);
        console.log("   - gameState.jeuBloque:", gameState.jeuBloque);
        console.log("   - automatismsActive.confort:", automatismsActive.confort);
        
        if (gameState.confortAuto > 0 && !gameState.jeuBloque && automatismsActive.confort) {
          // CAHIER DES CHARGES : "Achat confort auto (15s)"
          var prixConfort = 100; // Prix unitaire selon cahier des charges
          var totalCost = prixConfort * gameState.confortAuto;
          
          console.log("üîÑ Confort Auto - Tentative achat:");
          console.log("   - Unit√©s √† acheter:", gameState.confortAuto);
          console.log("   - Co√ªt total:", totalCost, "‚Ç¨");
          console.log("   - Solde actuel:", gameState.money, "‚Ç¨");
          console.log("   - Cr√©dit activ√©:", gameState.creditUnlocked);
          
          // Correction Claude : V√©rifier si on peut d√©biter (cr√©dit activ√© ou solde suffisant)
          if (gameState.creditUnlocked || gameState.money >= totalCost) {
            gameState.money -= totalCost;
            gameState.confort += gameState.confortAuto;
            
            console.log("‚úÖ Confort Auto - Achat r√©ussi:", gameState.confortAuto, "confort pour", totalCost, "‚Ç¨");
            
            // Si "Automatismes = clics" activ√©, compter comme des clics
            if (gameState.automatismsGenerateClicks) {
              gameState.clicks += gameState.confortAuto;
            }
            
            // Mise √† jour silencieuse
            updateUIValues();
          } else {
            console.log("‚ùå Confort Auto - Fonds insuffisants:", gameState.money, "‚Ç¨ <", totalCost, "‚Ç¨");
          }
        } else {
          console.log("üîÑ Confort Auto - Conditions non remplies:");
          console.log("   - confortAuto > 0:", gameState.confortAuto > 0);
          console.log("   - !jeuBloque:", !gameState.jeuBloque);
          console.log("   - automatisme actif:", automatismsActive.confort);
        }
      }, 15000); // Toutes les 15 secondes
    }
    
    function startCentreCommercialInterval() {
      // Nettoyer l'ancien interval si il existe
      if (intervals.centreCommercial) {
        clearInterval(intervals.centreCommercial);
      }
      
      intervals.centreCommercial = setInterval(function() {
        if (gameState.centreCommercial > 0 && !gameState.jeuBloque && automatismsActive.centre) {
          // CAHIER DES CHARGES : "Achat confort 10√ó (15s)"
          var prixConfort = 100; // Prix unitaire
          var confortParCentre = 10; // 10√ó confort par centre selon cahier des charges
          var achatsQuantite = confortParCentre * gameState.centreCommercial;
          var totalCost = prixConfort * achatsQuantite;
          
          // ================== AJOUT : DEBUG CENTRE COMMERCIAL ==================
          console.log("üè¨ Centre Commercial - Tentative achat:");
          console.log("   - Centres:", gameState.centreCommercial);
          console.log("   - Confort √† acheter:", achatsQuantite);
          console.log("   - Co√ªt total:", totalCost, "‚Ç¨");
          console.log("   - Solde actuel:", gameState.money, "‚Ç¨");
          console.log("   - Cr√©dit activ√©:", gameState.creditUnlocked);
          console.log("   - Automatisme actif:", automatismsActive.centre);
          // =====================================================================
          
          // Correction Claude : V√©rifier si on peut d√©biter (cr√©dit activ√© ou solde suffisant)
          if (gameState.creditUnlocked || gameState.money >= totalCost) {
            gameState.money -= totalCost;
            gameState.confort += achatsQuantite;
            
            console.log("‚úÖ Centre Commercial - Achat r√©ussi:", achatsQuantite, "confort pour", totalCost, "‚Ç¨");
            
            // Si "Automatismes = clics" activ√©, compter comme des clics
            if (gameState.automatismsGenerateClicks) {
              gameState.clicks += achatsQuantite;
            }
            
            // Mise √† jour silencieuse
            updateUIValues();
          } else {
            console.log("‚ùå Centre Commercial - Fonds insuffisants:", gameState.money, "‚Ç¨ <", totalCost, "‚Ç¨");
          }
        } else {
          console.log("üè¨ Centre Commercial - Conditions non remplies:");
          console.log("   - Centres:", gameState.centreCommercial);
          console.log("   - Jeu bloqu√©:", gameState.jeuBloque);
          console.log("   - Automatisme actif:", automatismsActive.centre);
        }
      }, 15000); // Toutes les 15 secondes
    }
    
    // Fonction de mise √† jour silencieuse pour les automatismes
    function updateUIValues() {
      // Mettre √† jour les valeurs affich√©es
      document.getElementById("nature").textContent = Math.floor(gameState.nature);
      document.getElementById("confort").textContent = Math.floor(gameState.confort);
      document.getElementById("production").textContent = Math.floor(gameState.production);
      document.getElementById("money").textContent = Math.floor(gameState.money);
      document.getElementById("clicks").textContent = gameState.clicks;
      
      // ================== AJOUT : MISE √Ä JOUR BUDGET √âTAT ==================
      document.getElementById("budget-etat").textContent = Math.floor(gameState.budgetEtat);
      // ======================================================================
      
      // ================== AJOUT : SUIVI DU CONFORT MAXIMUM ==================
      // Mettre √† jour le niveau de confort maximum atteint
      if (gameState.confort > gameState.confortMaxAtteint) {
        gameState.confortMaxAtteint = gameState.confort;
      }
      // =======================================================================
      
      // ================== V√âRIFICATION FIN DE JEU (D√âPLAC√âE) ==================
      // V√©rifier les conditions de fin de jeu APR√àS mise √† jour des valeurs
      if (!gameState.gameOver && !gameState.ehActivated) {
        if (gameState.nature <= 0) {
          triggerGameOver('resources');
          return; // Arr√™ter apr√®s d√©clenchement
        }
        // Fin de jeu confort : seulement si le confort a exist√© puis disparu
        if (gameState.confort <= 0 && gameState.confortMaxAtteint > 0) {
          triggerGameOver('confort');
          return; // Arr√™ter apr√®s d√©clenchement
        }
      }
      // =========================================================================
      
      // Mettre √† jour les jauges
      updateJauges();
      
      // Mettre √† jour les crises
      updateCrises();
      
      // ================== AJOUT : V√âRIFICATION PALIERS CYCLIQUES ==================
      // V√©rifier si de nouveaux paliers cycliques sont d√©bloqu√©s
      checkAndUnlockPaliersCycliques();
      // ============================================================================
      
      // Mettre √† jour les contr√¥les d'automatismes
      updateAutomatismControls();
      
      // Indicateur de prix si activ√©
      if (gameState.priceIndicatorActive) {
        document.getElementById("price-indicator-box").style.display = "block";
        var currentPrice = calculatePrice();
        document.getElementById("current-price").textContent = currentPrice.toFixed(2) + "‚Ç¨";
      }
    }
    
    // ==================== CONTR√îLES AUTOMATISMES ====================
    
    function toggleAutomatism(type) {
      if (gameState.ehActivated) return; // Bloqu√© en mode EH
      
      // V√©rifier si l'automatisme existe
      if (type === 'ia' && gameState.ia === 0) return;
      if (type === 'trader' && gameState.traderAuto === 0) return;
      if (type === 'confort' && gameState.confortAuto === 0) return;
      if (type === 'centre' && gameState.centreCommercial === 0) return;
      
      automatismsActive[type] = !automatismsActive[type];
      updateUI("Automatisme " + type + " : " + (automatismsActive[type] ? "ON" : "OFF"));
    }
    
    function updateAutomatismControls() {
      var hasAnyAutomatism = (gameState.ia > 0 || gameState.traderAuto > 0 || gameState.confortAuto > 0 || gameState.centreCommercial > 0);
      
      if (hasAnyAutomatism && !gameState.ehActivated) {
        document.getElementById("automatisms-controls").style.display = "flex";
      } else {
        document.getElementById("automatisms-controls").style.display = "none";
      }
      
      // Bouton IA
      var iaBtn = document.getElementById("control-ia");
      if (gameState.ia > 0) {
        iaBtn.style.display = "inline-block";
        iaBtn.className = automatismsActive.ia ? "control-btn active" : "control-btn inactive";
        iaBtn.textContent = "ü§ñ IA: " + (automatismsActive.ia ? "ON" : "OFF");
      } else {
        iaBtn.style.display = "none";
      }
      
      // Bouton Trader
      var traderBtn = document.getElementById("control-trader");
      if (gameState.traderAuto > 0) {
        traderBtn.style.display = "inline-block";
        traderBtn.className = automatismsActive.trader ? "control-btn active" : "control-btn inactive";
        traderBtn.textContent = "üí∞ Trader: " + (automatismsActive.trader ? "ON" : "OFF");
      } else {
        traderBtn.style.display = "none";
      }
      
      // Bouton Confort Auto
      var confortBtn = document.getElementById("control-confort");
      if (gameState.confortAuto > 0) {
        confortBtn.style.display = "inline-block";
        confortBtn.className = automatismsActive.confort ? "control-btn active" : "control-btn inactive";
        confortBtn.textContent = "üõãÔ∏è Confort: " + (automatismsActive.confort ? "ON" : "OFF");
      } else {
        confortBtn.style.display = "none";
      }
      
      // Bouton Centre Commercial
      var centreBtn = document.getElementById("control-centre");
      if (gameState.centreCommercial > 0) {
        centreBtn.style.display = "inline-block";
        centreBtn.className = automatismsActive.centre ? "control-btn active" : "control-btn inactive";
        centreBtn.textContent = "üè¨ Centre: " + (automatismsActive.centre ? "ON" : "OFF");
      } else {
        centreBtn.style.display = "none";
      }
    }
    
    // ==================== GESTION DES PALIERS CYCLIQUES ====================
    
    // ================== AJOUT : FONCTION PRINCIPALE DE V√âRIFICATION CYCLIQUE ==================
    /**
     * V√©rifie et d√©bloque les paliers cycliques selon les clics actuels
     * Remplace l'ancienne fonction checkAndUnlockPaliers avec la logique cyclique
     */
    function checkAndUnlockPaliersCycliques() {
      if (!gameState.monnaieActive) return;
      
      // === PALIER CONFORT (120 clics, non cyclique) ===
      if (gameState.clicks >= paliersConfig.comfort.palierBase && !gameState.paliersDebloque.comfort) {
        document.getElementById("comfort-btn").style.display = "block";
        updateButtonText("comfort-btn", "comfort");
      }
      
      // ================== DEBUG : LOGIQUE IA AVEC TRA√áAGE COMPLET ==================
      // === PALIER IA (cyclique tous les 200 clics) ===
      var etatIA = calculerEtatPalierCyclique('ia');
      var buttonIA = document.getElementById("ouvrier-btn");
      
      // LOGS DE DEBUG D√âTAILL√âS
      console.log("ü§ñ DEBUG IA - √âtat actuel:");
      console.log("   - Clics:", gameState.clicks);
      console.log("   - nbAchatIA:", gameState.nbAchatIA);
      console.log("   - etatIA.disponible:", etatIA.disponible);
      console.log("   - etatIA.prochainPalier:", etatIA.prochainPalier);
      console.log("   - buttonIA.style.display:", buttonIA.style.display);
      console.log("   - Condition compl√®te:", etatIA.disponible && buttonIA.style.display !== "block");
      
      // Utiliser la m√™me logique simple que les autres boutons
      if (etatIA.disponible && buttonIA.style.display !== "block") {
        console.log("ü§ñ IA - CONDITIONS REMPLIES ‚Üí Affichage du bouton");
        buttonIA.style.display = "block";
        updateButtonText("ouvrier-btn", "ia");
        console.log("ü§ñ IA disponible au clic", gameState.clicks, "- Co√ªt:", etatIA.cout);
      } else {
        console.log("ü§ñ IA - CONDITIONS NON REMPLIES ‚Üí Bouton reste masqu√©");
      }
      // ====================================================================================
      
      // ================== CORRECTION : LOGIQUE TRADER (maintenue identique) ==================
      // === PALIER TRADER (cyclique tous les 500 clics) ===
      var etatTrader = calculerEtatPalierCyclique('trader');
      var buttonTrader = document.getElementById("trader-btn");
      if (etatTrader.disponible && buttonTrader.style.display !== "block") {
        buttonTrader.style.display = "block";
        updateButtonText("trader-btn", "trader");
        console.log("üí∞ Trader disponible au clic", gameState.clicks, "- Co√ªt:", etatTrader.cout);
      }
      // ========================================================================================
      
      // === PALIER UPGRADE PRODUCTION (cyclique tous les 600 clics) ===
      var etatUpgrade = calculerEtatPalierCyclique('upgradeProd');
      var buttonUpgrade = document.getElementById("upgrade-btn2");
      if (etatUpgrade.disponible && buttonUpgrade.style.display !== "block") {
        buttonUpgrade.style.display = "block";
        updateButtonText("upgrade-btn2", "upgradeProd");
      }
      
      // === PALIER CONFORT AUTO (cyclique tous les 700 clics) ===
      var etatConfortAuto = calculerEtatPalierCyclique('confortAuto');
      var buttonConfortAuto = document.getElementById("comfort-auto-btn");
      if (etatConfortAuto.disponible && buttonConfortAuto.style.display !== "block") {
        buttonConfortAuto.style.display = "block";
        updateButtonText("comfort-auto-btn", "confortAuto");
      }
      
      // === PALIER AUTOMATISMES = CLICS (750 clics, non cyclique) ===
      if (gameState.clicks >= paliersConfig.automatismsClics.palierBase && 
          !gameState.automatismsGenerateClicks && 
          !gameState.paliersDebloque.automatismsClics) {
        document.getElementById("automatisms-btn").style.display = "block";
        updateButtonText("automatisms-btn", "automatismsClics");
      }
      
      // === PALIER INDICATEUR PRIX (1000 clics, non cyclique) ===
      if (gameState.clicks >= paliersConfig.priceIndicator.palierBase && 
          !gameState.priceIndicatorActive && 
          !gameState.paliersDebloque.priceIndicator) {
        document.getElementById("price-indicator-btn").style.display = "block";
        updateButtonText("price-indicator-btn", "priceIndicator");
      }
      
      // ================== CORRECTION : LOGIQUE CENTRE ALIGN√âE SUR LES AUTRES ==================
      // === PALIER CENTRE COMMERCIAL (cyclique tous les 1100 clics) ===
      var etatCentre = calculerEtatPalierCyclique('centreCommercial');
      var buttonCentre = document.getElementById("centre-commercial-btn");
      // Utiliser la m√™me logique simple que les autres boutons
      if (etatCentre.disponible && buttonCentre.style.display !== "block") {
        buttonCentre.style.display = "block";
        updateButtonText("centre-commercial-btn", "centreCommercial");
        console.log("üè¨ Centre disponible au clic", gameState.clicks, "- Co√ªt:", etatCentre.cout);
      }
      // ======================================================================================
    }
    // ===========================================================================================
    
    // Fonction de compatibilit√© (appelle la nouvelle fonction cyclique)
    function checkAndUnlockPaliers() {
      checkAndUnlockPaliersCycliques();
    }
    
    // ==================== JAUGES DYNAMIQUES ====================
    
    function updateJauges() {
      // Calcul des valeurs maximales pour les jauges
      var maxVals = {
        nature: Math.max(3000, gameState.nature * 1.2),
        confort: Math.max(100, gameState.confort * 1.2),
        money: Math.max(10000, Math.abs(gameState.money) * 1.2),
        budgetEtat: Math.max(1000, gameState.budgetEtat * 1.2), // ================== AJOUT : JAUGE BUDGET √âTAT ==================
        achatAuto: Math.max(10, gameState.confortAuto * 1.2),
        ia: Math.max(10, gameState.ia * 1.2),
        trader: Math.max(10, gameState.traderAuto * 1.2),
        centre: Math.max(10, gameState.centreCommercial * 1.2),
        tech: Math.max(5, gameState.techLevel * 1.2) // ================== AJOUT : JAUGE TECH ==================
      };
      
      // Jauge Nature (toujours visible)
      var naturePercent = Math.min(100, Math.max(0, (gameState.nature / maxVals.nature) * 100));
      document.getElementById("jauge-nature").style.width = naturePercent + "%";
      document.getElementById("jauge-nature-txt").textContent = Math.floor(gameState.nature);
      
      // Jauge Confort (visible si confort > 0)
      if (gameState.confort > 0) {
        document.getElementById("jauge-confort-container").style.display = "flex";
        var confortPercent = Math.min(100, Math.max(0, (gameState.confort / maxVals.confort) * 100));
        document.getElementById("jauge-confort").style.width = confortPercent + "%";
        document.getElementById("jauge-confort-txt").textContent = Math.floor(gameState.confort);
      }
      
      // Jauge Monnaie (visible si monnaie active)
      if (gameState.monnaieActive) {
        var moneyPercent = Math.min(100, Math.max(0, (Math.abs(gameState.money) / maxVals.money) * 100));
        document.getElementById("jauge-money").style.width = moneyPercent + "%";
        document.getElementById("jauge-money-txt").textContent = Math.floor(gameState.money) + "‚Ç¨";
      }
      
      // ================== AJOUT : JAUGE BUDGET DE L'√âTAT ==================
      // Jauge Budget √âtat (visible si budgetEtat > 0)
      if (gameState.budgetEtat > 0) {
        document.getElementById("jauge-budget-etat-container").style.display = "flex";
        var budgetPercent = Math.min(100, Math.max(0, (gameState.budgetEtat / maxVals.budgetEtat) * 100));
        document.getElementById("jauge-budget-etat").style.width = budgetPercent + "%";
        document.getElementById("jauge-budget-etat-txt").textContent = Math.floor(gameState.budgetEtat) + "‚Ç¨";
      }
      // ====================================================================
      
      // Jauge Achat Auto (visible si confortAuto > 0)
      if (gameState.confortAuto > 0) {
        var achatPercent = Math.min(100, Math.max(0, (gameState.confortAuto / maxVals.achatAuto) * 100));
        document.getElementById("jauge-achat-auto").style.width = achatPercent + "%";
        document.getElementById("jauge-achat-auto-txt").textContent = "√ó" + gameState.confortAuto;
      }
      
      // Jauge IA (visible si ia > 0)
      if (gameState.ia > 0) {
        var iaPercent = Math.min(100, Math.max(0, (gameState.ia / maxVals.ia) * 100));
        document.getElementById("jauge-ia").style.width = iaPercent + "%";
        document.getElementById("jauge-ia-txt").textContent = "√ó" + gameState.ia;
      }
      
      // Jauge Trader (visible si traderAuto > 0)
      if (gameState.traderAuto > 0) {
        var traderPercent = Math.min(100, Math.max(0, (gameState.traderAuto / maxVals.trader) * 100));
        document.getElementById("jauge-trader").style.width = traderPercent + "%";
        document.getElementById("jauge-trader-txt").textContent = "√ó" + gameState.traderAuto;
      }
      
      // Jauge Centre Commercial (visible si centreCommercial > 0)
      if (gameState.centreCommercial > 0) {
        var centrePercent = Math.min(100, Math.max(0, (gameState.centreCommercial / maxVals.centre) * 100));
        document.getElementById("jauge-centre").style.width = centrePercent + "%";
        document.getElementById("jauge-centre-txt").textContent = "√ó" + gameState.centreCommercial;
      }
      
      // ================== AJOUT : JAUGE NIVEAU TECHNOLOGIQUE ==================
      // Jauge Tech (visible si techLevel > 0)
      if (gameState.techLevel > 0) {
        var techPercent = Math.min(100, Math.max(0, (gameState.techLevel / maxVals.tech) * 100));
        document.getElementById("jauge-tech").style.width = techPercent + "%";
        document.getElementById("jauge-tech-txt").textContent = "Niv." + gameState.techLevel + " (√ó" + gameState.productionMultiplier.toFixed(1) + ")";
      }
      // ========================================================================
    }
    
    // ==================== CRISES ET ALERTES ====================
    
    function updateCrises() {
      // Crise √©cologique (ressources < 300)
      var criseBox = document.getElementById("alert-crise");
      if (gameState.nature < 300) {
        criseBox.style.display = "block";
        criseBox.textContent = "Crise √©cologique : risque sur l'habitabilit√© humaine de la plan√®te";
      } else {
        criseBox.style.display = "none";
      }
      
      // Message √©volution EH (nature ‚â§ 100)
      var ehBox = document.getElementById("eh-msg");
      if (gameState.monnaieActive && gameState.nature <= 100 && !gameState.ehActivated && !gameState.gameOver) {
        ehBox.style.display = "block";
        ehBox.textContent = "Une √©volution est possible : passer √† l'√©conomie hom√©ostatique (EH)";
        document.getElementById("evolution-btn").style.display = "block";
      } else {
        ehBox.style.display = "none";
        if (!gameState.ehActivated && !gameState.gameOver) {
          document.getElementById("evolution-btn").style.display = "none";
        }
      }
      
      // ================== ALERTE SOCIALE AM√âLIOR√âE ==================
      // Alerte crise sociale (confort ‚â§ 5 ET d√©gradation depuis un niveau > 5)
      var socialBox = document.getElementById("social-crise");
      if (gameState.confort <= 5 && gameState.confortMaxAtteint > 5 && !gameState.gameOver) {
        socialBox.style.display = "block";
        socialBox.textContent = "Attention : risque de crise sociale majeure";
        socialBox.className = "message-box msg-red"; // Rouge pour l'urgence
      } else {
        socialBox.style.display = "none";
        socialBox.className = "message-box msg-brown"; // Restaurer la classe par d√©faut
      }
      // ==============================================================
      
      // Ancienne crise sociale (obsol√®te - remplac√©e par l'alerte ci-dessus)
      // Conserver le syst√®me d'activation pour compatibilit√©
      if (gameState.confort > 5) {
        gameState.criseSocialeActive = true;
      }
      if (gameState.confort === 0) {
        gameState.criseSocialeActive = false;
      }
    }
    
    // ==================== INTERFACE UTILISATEUR ====================
    
    function updateUI(message) {
      // ================== AJOUT : V√âRIFICATION PALIERS CYCLIQUES ==================
      // V√©rifier et d√©bloquer les paliers cycliques
      checkAndUnlockPaliersCycliques();
      // ============================================================================
      
      // Mettre √† jour les contr√¥les d'automatismes
      updateAutomatismControls();
      
      // Mettre √† jour les valeurs affich√©es
      updateUIValues();
      
      // ================== AJOUT : MISE √Ä JOUR BUDGET √âTAT UI ==================
      updateBudgetEtatUI();
      // =========================================================================
      
      // Afficher le message si fourni
      if (message) {
        document.getElementById("message").textContent = message;
      }
    }
    
    // ==================== FONCTIONS DE TRICHE/DEBUG ====================
    
    function addMoney() {
      saveState();
      gameState.money += 1000;
      updateUI("Test : +1000‚Ç¨");
    }
    
    function addOneNature() {
      saveState();
      gameState.nature += 100;
      updateUI("Test : +100 ressources");
    }
    
    function addClicks50() {
      saveState();
      gameState.clicks += 50;
      updateUI("Test : +50 clics - Total : " + gameState.clicks + " clics");
    }
    
    // ==================== INITIALISATION ====================
    
    // D√©marrage du jeu
    updateUI("");
  </script>
</body>
</html>
